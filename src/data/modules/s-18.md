# Malware Analysis: Dynamic Behavior

## 1. Orientation

### What this module covers
When Static Analysis fails (due to packing/obfuscation), we move to **Basic Dynamic Analysis**. We run the malware in a controlled, isolated environment and observe its behavior.

### Learning Objectives
*   Set up a safe **Sandbox** (Host-Only Network).
*   Monitor **Process Activity** (ProcMon).
*   Monitor **Network Traffic** (Wireshark/Fiddler).
*   Monitor **DNS Queries** (FakeNet).

---

## 2. Core Content

### The Golden Rule of Dynamic Analysis
**NEVER** run malware on your host or a machine with internet access (unless specifically engineered to do so via a Dirty Line). Use a VM with snapshots.

### The Toolset
1.  **Sysinternals Process Monitor (ProcMon):** Records file system, registry, and process activity. "Did it write to `C:\Windows\System32`?"
2.  **Process Explorer:** Visually view parent-child process relationships. "Why did `calc.exe` spawn `powershell.exe`?"
3.  **Wireshark:** Capture packets. "Is it beaconing to a C2 server?"
4.  **RegShot:** Compare Registry before and after execution (Snapshot A vs Snapshot B).

### Indicators of Compromise (IOCs)
Dynamic analysis generates the IOCs we discussed in Module s-14: 
*   New Files created.
*   Registry Keys for Persistence (`Run` keys).
*   C2 Domains/IPs contacted.

---

## 3. Lab: Bursting the Bubble

### Scenario
You run `malware.exe` in your lab.

1.  **ProcMon:** Shows writes to `HKCU\Software\Microsoft\Windows\CurrentVersion\Run\Updater`. (Persistence established).
2.  **Wireshark:** Shows a DNS query for `update-checker-secure.com` followed by HTTP POST requests.
3.  **Process Explorer:** Shows `malware.exe` spawned `cmd.exe`.

**Analysis:** The malware installs persistence, attempts C2 communication, and opens a command shell.

---

## 4. Reflection
1.  What is "Anti-VM"? (Malware checks if it's in a VM—e.g., checking MAC address or drivers—and quits if detected to fool analysts).
2.  Why use a "Host-Only" network adapter? (To prevent the malware from reaching the real internet while still allowing you to route traffic to a fake internet simulator like INetSim).
