# Network Segmentation and Zones

## 1. Orientation

### What this module covers
This module covers network segmentation—the practice of dividing networks into isolated zones to contain attacks and limit lateral movement. Segmentation is one of the most effective defenses against modern attacks.

### Fit in the Learning Path
Flat networks allow attackers to move freely once inside. Segmentation compartmentalizes the network so compromising one system doesn't grant access to everything. This is fundamental to limiting breach impact.

### Learning Objectives
By the end of this module, you will:
*   Design network zones and DMZ architecture
*   Implement VLANs for segmentation
*   Apply micro-segmentation principles
*   Prevent lateral movement

---

## 2. Core Content

### Mental Model: The Submarine

**How professionals think about this:**
A submarine has compartments—if one compartment floods, the others remain sealed. Network segmentation works the same way. If one zone is compromised, the damage is contained.

```
FLAT vs SEGMENTED NETWORK:

FLAT NETWORK (DANGEROUS):
┌─────────────────────────────────────────────────────────────────────┐
│                                                                     │
│  ┌──────┐  ┌──────┐  ┌──────┐  ┌──────┐  ┌──────┐  ┌──────┐       │
│  │ User │  │Server│  │  DB  │  │ IoT  │  │Printer│  │ Dev  │       │
│  └──┬───┘  └──┬───┘  └──┬───┘  └──┬───┘  └──┬────┘  └──┬───┘       │
│     │         │         │         │         │          │           │
│     └─────────┴─────────┴─────────┴─────────┴──────────┘           │
│                         │                                          │
│              ALL ON SAME NETWORK                                   │
│                                                                     │
│  Attacker compromises printer →                                    │
│     → Direct access to database                                    │
│     → Direct access to all servers                                 │
│     → Free lateral movement everywhere                             │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘

SEGMENTED NETWORK (SECURE):
┌─────────────────────────────────────────────────────────────────────┐
│                                                                     │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                 │
│  │ USER ZONE   │  │ SERVER ZONE │  │  DB ZONE    │                 │
│  │ ┌────┐┌────┐│  │ ┌────┐┌────┐│  │   ┌────┐    │                 │
│  │ │User││User││  │ │Web ││App ││  │   │ DB │    │                 │
│  │ └────┘└────┘│  │ └────┘└────┘│  │   └────┘    │                 │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘                 │
│         │                │                │                        │
│         └───────[FIREWALL]───────[FIREWALL]                        │
│                                                                     │
│  Attacker in User Zone:                                            │
│     → Cannot reach DB directly                                     │
│     → Must pass through multiple controls                          │
│     → Lateral movement blocked                                     │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### Standard Network Zones

**Common segmentation design:**

```
NETWORK ZONE ARCHITECTURE:

                    ┌────────────────────────────────────────┐
                    │           INTERNET (Untrusted)         │
                    └────────────────────┬───────────────────┘
                                         │
                                    [Edge Firewall]
                                         │
            ┌────────────────────────────┼────────────────────────────┐
            │                            │                            │
            ▼                            ▼                            ▼
┌───────────────────┐      ┌───────────────────┐      ┌───────────────────┐
│        DMZ        │      │    DMZ (Mail)     │      │    DMZ (VPN)      │
│   ┌───────────┐   │      │   ┌───────────┐   │      │   ┌───────────┐   │
│   │ Web Server│   │      │   │Mail Server│   │      │   │VPN Concen.│   │
│   └───────────┘   │      │   └───────────┘   │      │   └───────────┘   │
└─────────┬─────────┘      └─────────┬─────────┘      └─────────┬─────────┘
          │                          │                          │
          └──────────────────────────┼──────────────────────────┘
                                     │
                              [Internal Firewall]
                                     │
        ┌────────────────────────────┼────────────────────────────┐
        │                            │                            │
        ▼                            ▼                            ▼
┌───────────────────┐      ┌───────────────────┐      ┌───────────────────┐
│   USER NETWORK    │      │  SERVER NETWORK   │      │   MANAGEMENT      │
│                   │      │                   │      │                   │
│ ┌────┐ ┌────┐     │      │ ┌────┐ ┌────┐     │      │ ┌────┐ ┌────┐     │
│ │HR  │ │Fin │     │      │ │App │ │File│     │      │ │SIEM│ │Backup│   │
│ └────┘ └────┘     │      │ └────┘ └────┘     │      │ └────┘ └────┘     │
└─────────┬─────────┘      └─────────┬─────────┘      └─────────┬─────────┘
          │                          │                          │
          └──────────────────────────┼──────────────────────────┘
                                     │
                              [DB Firewall]
                                     │
                                     ▼
                        ┌───────────────────────┐
                        │     DATA ZONE         │
                        │    ┌───────────┐      │
                        │    │ Database  │      │
                        │    └───────────┘      │
                        └───────────────────────┘
```

**Zone definitions:**

| Zone | Purpose | Trust Level | Internet Access |
|------|---------|-------------|-----------------|
| **Internet** | External, untrusted | None | N/A |
| **DMZ** | Public-facing services | Low | Inbound limited |
| **User** | Employee workstations | Medium | Outbound via proxy |
| **Server** | Internal applications | Medium-High | Minimal |
| **Data** | Databases, sensitive data | High | None |
| **Management** | Security tools, backups | Highest | Very limited |

### VLAN Implementation

**Virtual LAN separation:**

```
VLAN BASICS:

Physical Switch Port 1 ──► VLAN 10 (Users)
Physical Switch Port 2 ──► VLAN 10 (Users)
Physical Switch Port 3 ──► VLAN 20 (Servers)
Physical Switch Port 4 ──► VLAN 30 (Printers)

Within VLAN 10: Devices can communicate freely
Between VLANs: Must go through router/firewall

VLAN ARCHITECTURE:
┌─────────────────────────────────────────────────────────────────────┐
│                                                                     │
│  VLAN 10 (Users)     VLAN 20 (Servers)    VLAN 30 (Printers)       │
│  192.168.10.0/24     192.168.20.0/24      192.168.30.0/24          │
│       │                    │                    │                  │
│       └────────────────────┼────────────────────┘                  │
│                            │                                       │
│                    [Layer 3 Switch/Router]                         │
│                    with ACLs between VLANs                         │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘

VLAN SECURITY CONSIDERATIONS:
─────────────────────────────
VLAN alone is NOT security boundary
- VLANs control broadcast domain
- Security requires inter-VLAN ACLs or firewall
- VLAN hopping attacks possible if misconfigured
```

### Traffic Flow Rules

**What talks to what:**

```
TRAFFIC FLOW MATRIX:

               TO:
FROM:          Internet  DMZ    User   Server  Data   Mgmt
─────────────────────────────────────────────────────────────
Internet         -       ✓      ✗       ✗       ✗      ✗
DMZ              ✓       -      ✗       ✓*      ✗      ✗
User            ✓**     ✓       -      ✓       ✗      ✗
Server           ✗      ✗       ✗       -      ✓      ✓**
Data             ✗      ✗       ✗       ✗       -      ✗
Mgmt            ✓**     ✓      ✓       ✓       ✓       -

Legend:
✓  = Allowed (with restrictions)
✓* = Limited to specific ports/services
✓** = Via proxy/jump box only
✗  = Blocked

COMMON ALLOWED FLOWS:
─────────────────────────────
Internet → DMZ Web Server : 443
User → DMZ Web Server : 443 (internal apps)
User → Server : Application ports
DMZ Web → Server App : Application ports
Server App → Data DB : 3306/5432
Mgmt → All : Management protocols (SSH, WMI)
```

### Micro-Segmentation

**Workload-level isolation:**

```
MICRO-SEGMENTATION CONCEPT:

TRADITIONAL SEGMENTATION:
All servers in "Server Zone" can talk to each other

MICRO-SEGMENTATION:
Each workload has its own policy

┌─────────────────────────────────────────────────────────────────────┐
│  DATA CENTER                                                       │
│                                                                     │
│  ┌─────────────┐                     ┌─────────────┐               │
│  │   Web App   │───── 443 only ─────►│  API Server │               │
│  │  Policy: A  │                     │  Policy: B  │               │
│  └─────────────┘                     └──────┬──────┘               │
│                                             │                      │
│                                        3306 only                   │
│                                             │                      │
│                                             ▼                      │
│                                      ┌─────────────┐               │
│  ┌─────────────┐                     │  Database   │               │
│  │  Legacy App │───── BLOCKED ──────►│  Policy: C  │               │
│  │  Policy: D  │                     └─────────────┘               │
│  └─────────────┘                                                   │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘

MICRO-SEGMENTATION BENEFITS:
- Even within same subnet, traffic is controlled
- Compromised server cannot reach other servers
- Zero Trust at workload level
- Works in cloud and containers
```

### Lateral Movement Prevention

**Stopping attackers:**

```
LATERAL MOVEMENT ATTACK PATTERN:

Attacker compromises User PC
    ↓
Scans network: "What can I reach?"
    ↓
Finds accessible servers (SMB, RDP, SSH)
    ↓
Uses stolen credentials to access servers
    ↓
Pivots through network to reach target

SEGMENTATION DEFENSE:

Attacker compromises User PC
    ↓
Scans network: "What can I reach?"
    ↓
User zone cannot reach other User PCs (BLOCKED)
User zone cannot reach Server zone directly (BLOCKED)
User zone cannot reach Data zone (BLOCKED)
    ↓
Only allowed: Specific app on port 443
    ↓
Attack contained to single workstation

ADDITIONAL CONTROLS:
─────────────────────────────
1. Workstation isolation (users can't talk to each other)
2. Jump boxes for admin access
3. Port restrictions (not just zone restrictions)
4. Authentication at zone boundaries
```

### Segmentation Design Principles

**Best practices:**

```
SEGMENTATION PRINCIPLES:

1. DEFAULT DENY
   ─────────────────────────────
   Start with nothing allowed
   Add only required flows
   Document every exception

2. LEAST PRIVILEGE
   ─────────────────────────────
   User only needs web app → Only allow port 443
   Not "User can reach anything in Server zone"

3. DEFENSE IN DEPTH
   ─────────────────────────────
   Multiple zone boundaries
   If one fails, others contain

4. MONITOR BETWEEN ZONES
   ─────────────────────────────
   Log all zone transitions
   Alert on unusual flows
   Block suspicious sources

5. SEPARATE MANAGEMENT
   ─────────────────────────────
   Admin access via jump box
   Management network isolated
   No direct admin from user network

6. CONTAIN IOT AND LEGACY
   ─────────────────────────────
   Unpatched/insecure devices in isolated zone
   Cannot reach sensitive resources
```

---

## 3. Guided Practice

### Exercise 1: Zone Design

Design zones for a company with:
- 200 employees
- E-commerce website
- Internal ERP
- 50 IoT sensors

| Zone | Purpose | Devices | Can Access |
|------|---------|---------|------------|
| ___ | ___ | ___ | ___ |
| ___ | ___ | ___ | ___ |
| ___ | ___ | ___ | ___ |
| ___ | ___ | ___ | ___ |

### Exercise 2: Traffic Flow

Web app architecture:
- Internet users → Web servers
- Web servers → API servers
- API servers → Database

Design the traffic flow rules:

| From | To | Port | Action |
|------|----|----|--------|
| ___ | ___ | ___ | ___ |
| ___ | ___ | ___ | ___ |
| ___ | ___ | ___ | ___ |
| All other | All | Any | ___ |

### Exercise 3: Lateral Movement

Attacker compromised a user workstation. They want to reach the database.

With your segmentation from Exercise 1, what barriers exist?

1. ___
2. ___
3. ___

---

## 4. Reflection Check

### Technical Understanding
1. VLAN 10 and VLAN 20 on the same switch. Can they communicate?

2. Why put printers in a separate zone?

3. Management network requires jump box. Why not direct access?

### Practical Application
1. Developer says "I need access to everything for testing." How do you handle?

2. Legacy system can't be segmented because "it breaks." What now?

3. You segment the network. Business complains of broken applications. Approach?

---

## 5. Key Misconceptions

**MYTH: "VLANs provide security"**
REALITY: VLANs separate broadcast domains. Inter-VLAN ACLs or firewalls provide security.

**MYTH: "Segmentation is too complex for us"**
REALITY: Start simple—DMZ, internal, data. Add granularity over time.

**MYTH: "We're segmented because we have VLANs"**
REALITY: Without enforced policies between VLANs, segmentation provides no security benefit.

**MYTH: "Flat networks are easier to manage"**
REALITY: Flat networks are easier until you're breached. Then you wish you had containment.

**MYTH: "Cloud doesn't need segmentation"**
REALITY: Cloud security groups and VPCs ARE segmentation. Same principles apply.

---

## 6. Completion Criteria

This module is complete when you can:

1. **Design** zone architecture for a given scenario
2. **Implement** VLAN-based segmentation
3. **Apply** traffic flow rules between zones
4. **Explain** micro-segmentation benefits
5. **Prevent** lateral movement through segmentation

---

## 7. Further Depth (Optional)

*   **Lab:** Set up VLANs with inter-VLAN routing and ACLs
*   **Cloud:** Study AWS VPCs and Security Groups
*   **Tool:** Explore VMware NSX or other microsegmentation platforms
*   **Reading:** NIST Zero Trust Architecture (SP 800-207)
