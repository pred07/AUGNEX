# Purple Teaming & Emulation

## 1. Orientation

### What this module covers
How do you know your detections work? You simulate the attack. **Purple Teaming** is the collaboration of Red (Attack) and Blue (Defend). We will use **Atomic Red Team** to execute controlled tests.

### Learning Objectives
*   Execute an **Atomic Test** (T1003 - OS Credential Dumping).
*   Validate **Log Coverage** and **Alert Triggering**.
*   Calculate **Detection Rate**.

---

## 2. Core Content

### The Cycle
1.  **Select Technique:** MITRE T1003 (Credential Dumping).
2.  **Execute (Red):** Run `vssadmin create shadow /for=C:` (Ways to steal SAM database).
3.  **Hunt (Blue):** Did the SIEM see it? Did the EDR block it?
4.  **Tune:** If missed, write a new correlation rule.
5.  **Repeat:** Run it again to verify the fix.

### Atomic Red Team
A library of simple, scripted attacks (YAML).
*   *Command:* `Invoke-AtomicTest T1003.002`
*   *Action:* It runs the specific command to dump registry hives.
*   *Cleanup:* It deletes the files it created.

### BAS (Breach and Attack Simulation)
Enterprise tools (like Caldera, Scythe) that automate this at scale, running thousands of attacks daily to detect regression.

---

## 3. Lab: Testing the Defense

### Scenario
You wrote a rule to detect `whoami` when run by `SYSTEM`.

1.  **Test:** Open CMD as Admin. Run `whoami`.
    *   *Result:* No Alert. (Because you ran it as Admin, not SYSTEM).
2.  **Refine Test:** Use `psexec -s -i cmd.exe` to get a SYSTEM shell. Run `whoami`.
    *   *Result:* Alert Fired.
3.  **Validation:** The rule works for the intended threat (Webshell/Service Exploit).

---

## 4. Reflection
1.  Why is this better than a real pentest? (A pentest is once a year. Purple Teaming is continuous. It specifically tests your *detections*, whereas a pentester just wants to get in).
2.  What is "Detection Drift"? (When a rule stops working because the environment changedâ€”e.g., logging was disabled during an upgrade and never turned back on. BAS detects this).
