# Persistence Mechanisms (Defensive View)

## 1. Unit Brief: The Unwanted Guest
Persistence is how malware survives a reboot. For defenders, finding persistence is 90% of the cleanup job.

## 2. Real-World Relevance
If you delete the malware.exe but leave the Scheduled Task that downloads it, you will be infected again in 1 hour. This is called "Re-infection".

## 3. Core Concepts

### Common Techniques
1.  **Registry Run Keys**: The classic.
2.  **Scheduled Tasks**: Flexible triggers (Time, Logon, Idle).
3.  **Services**: Running as SYSTEM.
4.  **Startup Folder**: Simple but effective.
5.  **WMI Event Subscriptions**: Advanced. Stored in the WMI repository, not as files. (Hard to find).

### Autoruns (Sysinternals)
The gold standard tool from Microsoft to check persistence.

## 4. Practical Examples

### Hunting with Autoruns
1.  Run `Autoruns64.exe` as Admin.
2.  Go to "Logon" tab.
3.  Look for "File not found" (Old malware) or unverified publishers in `%AppData%`.
4.  Uncheck to disable.

### WMI Persistence
*   **Filter**: Trigger (e.g., uptime > 5 mins).
*   **Consumer**: Action (Run PowerShell script).
*   **Binding**: Link Filter to Consumer.
*   **Detection**: Get-WMIObject.

## 5. Common Mistakes Beginners Make
*   **Formatting the drive**: "I can't find it, so I'll wipe the laptop." (Effective, but costly). Learning to clean persistence saves time.
*   **Missing the second backdoor**: Attackers often plant 2 or 3 persistence methods. Finding one doesn't mean you found them all.

## 6. Key Takeaways
*   **Layers**: Check Registry, Tasks, Services, WMI, and Bits.
*   **Verify Signatures**: Microsoft tech usually verifies. Malware usually doesn't.
