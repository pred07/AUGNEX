# The Pyramid of Pain (Deep Dive)

## 1. Orientation

### What this module covers
We introduced the Pyramid in S-14. Now we engineer it. This module focuses on the top of the pyramid: **Tools** and **TTPs**. How do you actually detect a "TTP"? It's harder than a regex.

### Learning Objectives
*   Analyze **Toolmarks** (Artifacts created by tools).
*   Deconstruct **TTPs** into observable events.
*   Understand the **Economic Impact** on the attacker at each level.

---

## 2. Core Content

### Level 5: Tools (The "Artifacts")
Attackers use software (Cobalt Strike, Mimikatz, Rubeus). Software leaves footprints.
*   **Memory:** Meaningless strings in RAM.
*   **Network:** Distinctive SSL certificates (Cobalt Strike default certs).
*   **Disk:** Specific pipe names (`\\.\pipe\msagent_`).
*   **Defense:** Writing signatures for the *Tool*, not the *File Hash*.

### Level 6: TTPs (The "Behavior")
The "How".
*   **Tactic:** Credential Access (The Goal).
*   **Technique:** LSASS Dumping (The Method).
*   **Procedure:** Using `procdump.exe` to dump `lsass.exe` to `C:\temp`.
*   **Detection:** "Process A (Any Name) accessing the memory of Process B (lsass.exe)".
*   **Why it's King:** Even if they write their own custom dumper in Rust, they still need to touch LSASS. The behavior remains.

### The Cost Equation
*   **Blocking an IP:** Cost to Attacker: $5 (New VPS). Time: 5 mins.
*   **Detecting a TTP:** Cost to Attacker: $100k+ (R&D to find a new way to dump creds without touching LSASS). Time: Months.

---

## 3. Lab: Climbing the Pyramid (Cobalt Strike)
*   **Hash:** `a1b2...` (Blockable).
*   **IP:** `1.2.3.4` (Blockable).
*   **Domain:** `updates.com` (Blockable).
*   **Tool:** Malleable C2 Profile "Amazon". (Detect the User-Agent).
*   **TTP:** Beaconing behavior (Jitter). (Detect communication intervals).

---

## 4. Completion Criteria
1.  **Explain** why detecting TTPs is "expensive" for the attacker.
2.  **Identify** a "Tool" level indicator vs a "Hash".
