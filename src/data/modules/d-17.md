# IDS vs IPS Explained

## 1. Orientation

### What this module covers
This module covers Intrusion Detection Systems (IDS) and Intrusion Prevention Systems (IPS)—technologies that analyze network traffic for malicious patterns and attacks. While firewalls filter by port, IDS/IPS inspects traffic content.

### Fit in the Learning Path
Firewalls allow or deny based on source, destination, and port. IDS/IPS examines the CONTENT of allowed traffic to detect attacks. Together, they provide layered network defense.

### Learning Objectives
By the end of this module, you will:
*   Understand IDS vs IPS deployment and capabilities
*   Recognize detection methods (signature vs behavioral)
*   Manage false positives and tuning
*   Understand evasion techniques

---

## 2. Core Content

### Mental Model: Detection vs Prevention

**How professionals think about this:**
IDS is a security camera—it sees everything and alerts you, but doesn't stop anything. IPS is a security guard—it stands at the door and physically blocks threats. Each has trade-offs.

```
IDS vs IPS COMPARISON:

IDS (Detection Only):
┌─────────────────────────────────────────────────────────────────────┐
│                                                                     │
│  TRAFFIC ──────────────────────────────► DESTINATION               │
│              │                                                     │
│              └─── (copy via TAP/SPAN) ───► IDS                     │
│                                             │                      │
│                                             ▼                      │
│                                          [ALERT]                   │
│                                             │                      │
│                                             ▼                      │
│                                          ANALYST                   │
│                                                                     │
│  IMPACT: Traffic flows uninterrupted                               │
│  RISK: Attack succeeds before response                             │
│  UPTIME: IDS failure = no alerts (still works)                     │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘

IPS (Prevention):
┌─────────────────────────────────────────────────────────────────────┐
│                                                                     │
│  TRAFFIC ──────► [IPS] ──────► DESTINATION                         │
│                    │                                               │
│                    ├── Good traffic: PASS                          │
│                    └── Bad traffic: DROP                           │
│                                                                     │
│  IMPACT: Blocks attacks in real-time                               │
│  RISK: False positives block legitimate traffic                    │
│  UPTIME: IPS failure = network outage (critical)                   │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### Detection Methods

**How IDS/IPS finds attacks:**

```
DETECTION METHODS:

1. SIGNATURE-BASED
   ─────────────────────────────
   Pattern matching against known attacks
   
   Example signature (Snort format):
   alert tcp any any -> any 80 (content:"' OR 1=1"; msg:"SQL Injection";)
   
   ADVANTAGES:
   - Fast and accurate for known attacks
   - Low false positive rate
   - Easy to understand
   
   LIMITATIONS:
   - Cannot detect unknown attacks (zero-day)
   - Attackers modify attacks to avoid signatures
   - Requires constant signature updates

2. ANOMALY-BASED (Behavioral)
   ─────────────────────────────
   Learns normal behavior, alerts on deviation
   
   Example:
   Baseline: Server sends 10MB/hour
   Alert: Server sends 10GB in 5 minutes
   
   ADVANTAGES:
   - Can detect unknown attacks
   - No signature updates needed
   - Catches insider threats
   
   LIMITATIONS:
   - Higher false positive rate
   - Requires learning period
   - "Normal" changes over time

3. PROTOCOL ANALYSIS
   ─────────────────────────────
   Verifies traffic follows protocol specifications
   
   Example:
   HTTP request with invalid method → Alert
   
   ADVANTAGES:
   - Catches protocol abuse and malformation
   - Language/attack independent
   
   LIMITATIONS:
   - Only catches protocol violations
   - Legitimate software may violate RFCs
```

### Signature Examples

**Real-world detection rules:**

```
SNORT/SURICATA SIGNATURE EXAMPLES:

SQLi Detection:
alert http any any -> $HOME_NET any (
  msg:"SQL Injection Attempt";
  content:"' OR "; nocase;
  content:"1=1"; nocase;
  sid:1000001;
)

XSS Detection:
alert http any any -> $HOME_NET any (
  msg:"XSS Attempt - Script Tag";
  content:"<script"; nocase;
  pcre:"/\<script[^>]*\>/i";
  sid:1000002;
)

Malware C2 (Command & Control):
alert dns any any -> any 53 (
  msg:"Known Malware C2 Domain";
  content:"evil-c2.com";
  sid:1000003;
)

Shellcode Detection:
alert ip any any -> $HOME_NET any (
  msg:"x86 NOP Sled Detected";
  content:"|90 90 90 90 90 90|";
  sid:1000004;
)
```

### Deployment Architecture

**Where to place IDS/IPS:**

```
NETWORK PLACEMENT:

┌─────────────────────────────────────────────────────────────────────┐
│                                                                     │
│  INTERNET                                                          │
│      │                                                             │
│      ▼                                                             │
│  [EDGE FIREWALL]                                                   │
│      │                                                             │
│      ▼                                                             │
│  [IPS #1] ──► DMZ                      ← Protects external-facing  │
│      │                                                             │
│      ▼                                                             │
│  [INTERNAL FIREWALL]                                               │
│      │                                                             │
│      ▼                                                             │
│  [IPS #2] ──► INTERNAL NETWORK         ← Protects internal systems │
│      │                                                             │
│      ├──► User Segment                                            │
│      ├──► Server Segment                                          │
│      └──► [IDS] ──► Full packet tap    ← Deep visibility          │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘

PLACEMENT CONSIDERATIONS:
- Before firewall: See all attacks (including blocked)
- After firewall: Only see allowed traffic (less noise)
- Segment boundaries: Detect lateral movement
- TAP vs SPAN: TAP is reliable, SPAN may drop packets
```

### False Positives and Tuning

**Managing alert accuracy:**

| Outcome | Definition | Impact |
|---------|------------|--------|
| **True Positive** | Alert on actual attack | Good ✓ |
| **True Negative** | No alert on normal traffic | Good ✓ |
| **False Positive** | Alert on normal traffic | Alert fatigue, wasted time |
| **False Negative** | No alert on actual attack | Missed attack, breach |

```
TUNING PROCESS:

1. DEPLOY IN DETECTION MODE
   ─────────────────────────────
   Run IPS as IDS first
   Collect alerts without blocking
   Identify false positives
   
2. ANALYZE ALERTS
   ─────────────────────────────
   True attack? → Keep enabled
   False positive? → Tune or disable
   Business application? → Whitelist
   
3. TUNE SIGNATURES
   ─────────────────────────────
   Options:
   - Disable noisy signatures
   - Add exceptions for known-good traffic
   - Adjust thresholds
   - Create custom signatures
   
4. GRADUALLY ENABLE BLOCKING
   ─────────────────────────────
   Start with high-confidence signatures
   Monitor for business impact
   Expand blocking coverage over time
   
5. CONTINUOUS IMPROVEMENT
   ─────────────────────────────
   Review weekly/monthly
   Update signatures
   Add new threat intelligence
```

### Evasion Techniques

**How attackers bypass IDS/IPS:**

```
EVASION TECHNIQUES:

1. FRAGMENTATION
   ─────────────────────────────
   Split attack across multiple packets
   IDS may not reassemble correctly
   
   Attack: "SELECT * FROM"
   Fragment 1: "SEL"
   Fragment 2: "ECT"
   Fragment 3: " * FROM"
   
   Defense: Proper packet reassembly

2. ENCODING
   ─────────────────────────────
   Encode payload differently
   
   Attack: <script>alert(1)</script>
   Encoded: %3Cscript%3Ealert(1)%3C/script%3E
   
   Defense: Decode before inspection

3. PROTOCOL ABUSE
   ─────────────────────────────
   Use unexpected protocols
   
   HTTP on port 8080 instead of 80
   DNS tunneling for C2
   ICMP for data exfiltration
   
   Defense: Protocol-aware inspection on all ports

4. ENCRYPTION
   ─────────────────────────────
   HTTPS traffic is opaque to IDS
   
   Defense: TLS interception (with privacy considerations)

5. SLOW ATTACKS
   ─────────────────────────────
   Attack below detection threshold
   
   Brute force: 1 attempt per minute
   Exfiltration: 1KB per hour
   
   Defense: Aggregate analysis over time

6. POLYMORPHISM
   ─────────────────────────────
   Change attack appearance each time
   
   Same SQLi, different encoding/padding each request
   
   Defense: Normalization before signature matching
```

### IDS/IPS vs NGFW

**Convergence of technologies:**

```
TECHNOLOGY CONVERGENCE:

TRADITIONAL:
┌──────────┐     ┌─────┐
│ Firewall │ ──► │ IPS │ ──► Network
└──────────┘     └─────┘
    │               │
    Port-based      Signature-based

NEXT-GEN FIREWALL (NGFW):
┌─────────────────────────────────────┐
│            NGFW                     │
│  ┌──────────────────────────────┐  │
│  │ Firewall + IPS + App Control │  │
│  │ + URL Filter + TLS Inspect   │  │
│  └──────────────────────────────┘  │
└─────────────────────────────────────┘
           │
           All in one box

CONSIDERATIONS:
- NGFW: Simpler management, single vendor
- Separate IPS: Best-of-breed, defense in depth
- Both: Redundancy, different detection engines
```

---

## 3. Guided Practice

### Exercise 1: IDS/IPS Selection

Your company has these requirements:
- Cannot risk blocking legitimate traffic
- Needs to detect SQLi on web applications
- Has 10Gbps internet connection

Which is appropriate: IDS or IPS? Why?
___

### Exercise 2: Signature Analysis

This Snort rule triggers 100 false positives per day:

```
alert http any any -> $HOME_NET any (
  msg:"Possible XSS"; 
  content:"<script"; nocase; 
  sid:1000001;
)
```

What's causing false positives? How would you tune it?

1. Problem: ___
2. Solution: ___

### Exercise 3: Evasion Understanding

An IDS detects `' OR 1=1`. Attacker modifies to:
```
' OR '1'='1'--
```

1. Will the same signature catch this? ___
2. How would you improve the signature? ___

---

## 4. Reflection Check

### Technical Understanding
1. IPS drops a packet. Does the attacker get any response?

2. IDS alerts 5 seconds after the attack. Attack succeeded. Value of the alert?

3. Encrypted traffic (HTTPS) passes through IDS. What does IDS see?

### Operational Thinking
1. Critical trading system. IPS or IDS? Why?

2. You get 500 alerts per day. How do you prioritize?

3. New zero-day attack released. Signatures don't exist yet. What helps?

---

## 5. Key Misconceptions

**MYTH: "IPS replaces IDS"**
REALITY: IDS provides visibility where IPS can't be deployed (risk too high). Both have roles.

**MYTH: "Signature-based IDS catches all attacks"**
REALITY: Signatures only catch KNOWN attacks. Zero-days and novel attacks are missed.

**MYTH: "Just enable all signatures for maximum protection"**
REALITY: This creates massive false positive volume. Tuning is essential.

**MYTH: "IDS/IPS can see encrypted traffic"**
REALITY: Without TLS decryption, encrypted payloads are invisible.

**MYTH: "More alerts = better detection"**
REALITY: Alert volume without context overwhelms analysts. Quality over quantity.

---

## 6. Completion Criteria

This module is complete when you can:

1. **Explain** IDS vs IPS deployment and trade-offs
2. **Identify** signature-based vs anomaly-based detection
3. **Manage** false positives through tuning
4. **Recognize** common evasion techniques
5. **Design** IDS/IPS placement for a network

---

## 7. Further Depth (Optional)

*   **Tools:** Set up Snort or Suricata in a lab
*   **Signatures:** Study the Emerging Threats ruleset
*   **Practice:** PCAP analysis for attack detection
*   **Research:** Machine learning-based anomaly detection
