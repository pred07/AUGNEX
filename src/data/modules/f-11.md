# Users, Groups, and Access Control

## 1. Orientation

### What this module covers
This module defines identity in computing—how operating systems track users and groups to enforce security boundaries. Every security decision ultimately asks: "Is this identity allowed to perform this action?" Understanding identity is essential for privilege escalation, credential attacks, and access control.

### Fit in the Learning Path
"Hacking" often means stealing or forging an identity to access resources unauthorized. Privilege escalation means changing your identity to one with more permissions. You must understand how identity works to attack or defend it.

### Learning Objectives
By the end of this module, you will:
*   Understand Linux user/group identification (UID/GID)
*   Understand Windows security identifiers (SID/RID)
*   Identify privileged accounts and why they matter
*   Recognize identity-based attack vectors

---

## 2. Core Content

### Mental Model: Identity as the Security Foundation

**How professionals think about this:**
The operating system doesn't know "who you are"—it knows a number. Every security check compares this number against access control lists. If you can change or forge this number, you bypass security.

```
IDENTITY CHECK FLOW:

┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│   LOGIN         │     │   KERNEL        │     │   RESOURCE      │
│                 │     │   LOOKUP        │     │   ACCESS        │
│  Username: bob  │────►│                 │────►│                 │
│  Password: ***  │     │  "bob" = UID    │     │  Does UID 1001  │
│                 │     │   1001          │     │  have access?   │
└─────────────────┘     └─────────────────┘     └─────────────────┘
                                                         │
                                          ┌──────────────┴──────────────┐
                                          │                             │
                                          ▼                             ▼
                                    ┌──────────┐                  ┌──────────┐
                                    │  ALLOW   │                  │   DENY   │
                                    └──────────┘                  └──────────┘
```

### Linux Identity Model

**User Identification:**
Every user has a unique User ID (UID):

| UID Range | Type | Examples |
|-----------|------|----------|
| **0** | Root (superuser) | root |
| **1-999** | System accounts | daemon, www-data, mysql |
| **1000+** | Regular users | kali, bob, alice |

**Critical insight:**
The name "root" is just a label. UID 0 is the real power. Any account with UID 0 has root privileges:
```bash
# These are BOTH root (same UID 0):
root:x:0:0:root:/root:/bin/bash
backdoor:x:0:0:Hidden root:/tmp:/bin/bash
```

**Group Identification:**
Groups allow bulk permission management. Each group has a Group ID (GID):

```
/etc/group format:
groupname:password:GID:member_list

sudo:x:27:kali,admin
docker:x:999:kali
developers:x:1001:bob,alice
```

**Primary vs Supplementary Groups:**
- Primary group: Assigned when files are created
- Supplementary groups: Additional group memberships

**The important identity files:**

| File | Purpose | Format |
|------|---------|--------|
| `/etc/passwd` | User database | name:x:UID:GID:info:home:shell |
| `/etc/shadow` | Password hashes | name:hash:password_age_info |
| `/etc/group` | Group database | name:x:GID:members |
| `/etc/gshadow` | Group passwords | name:hash:admins:members |

### Windows Identity Model

**Security Identifiers (SIDs):**
Windows uses SIDs—structured strings that uniquely identify accounts:

```
S-1-5-21-3623811015-3361044348-30300820-1001
│ │ │  │            │           │         │
│ │ │  │            │           │         └── Relative ID (RID)
│ │ │  │            │           │             + 1001 = Regular user
│ │ │  └────────────┴───────────┴── Domain/Machine ID
│ │ └── Identifier Authority (5 = NT Authority)
│ └── Revision
└── SID prefix

Well-Known RIDs:
500 = Administrator (always)
501 = Guest
512 = Domain Admins group
```

**Local vs Domain accounts:**
- Local: Stored in SAM database (`C:\Windows\System32\config\SAM`)
- Domain: Stored in Active Directory (on Domain Controllers)

**Important Windows groups:**

| Group | Description | Risk Level |
|-------|-------------|------------|
| Administrators | Full system control | Critical |
| Backup Operators | Can read any file (for backups) | High |
| Remote Desktop Users | Can RDP to system | Medium |
| Domain Admins | Full domain control | Critical |
| Power Users | Legacy elevated privileges | Medium |

### Privileged Accounts in Detail

**Linux root (UID 0):**
- Bypasses all permission checks
- Can read any file, kill any process
- Can modify system configuration
- Target of all privilege escalation attacks

**Windows Administrator (RID 500):**
- Built-in admin account
- Cannot be deleted or locked out
- Often renamed but still identifiable by RID

**Service accounts:**
Both systems have accounts for services:
- Linux: www-data, mysql, nobody
- Windows: NETWORK SERVICE, LOCAL SERVICE, SYSTEM

**SYSTEM account (Windows):**
- Higher privilege than Administrator
- Used by Windows services
- Tokens can be stolen for privilege escalation

### Dangerous Group Memberships

**Linux dangerous groups:**

| Group | Why Dangerous | Attack Vector |
|-------|---------------|---------------|
| **sudo** | Can run commands as root | Already privileged |
| **docker** | Can access Docker daemon | Container escape to root |
| **disk** | Raw disk access | Read any file directly |
| **adm** | Read system logs | Information disclosure |
| **lxd** | LXD container access | Container escape |

**Docker privilege escalation example:**
```bash
# User in docker group can mount root filesystem
docker run -v /:/hostfs -it alpine chroot /hostfs
# Now running as root with access to host filesystem
```

**Windows dangerous groups:**

| Group | Why Dangerous | Attack Vector |
|-------|---------------|---------------|
| **Administrators** | Full control | Already privileged |
| **Backup Operators** | SeBackupPrivilege | Read any file |
| **DnsAdmins** | DLL loading in DNS | Code execution as SYSTEM |
| **Account Operators** | Create accounts | Create privileged users |

### Authentication vs Authorization

**Authentication:** "Prove who you are"
- Something you know (password)
- Something you have (token, key)
- Something you are (biometrics)

**Authorization:** "What are you allowed to do?"
- After identity is verified
- Check permissions on requested resource
- Allow or deny based on access control

**Common attacks:**

| Target | Attack | Result |
|--------|--------|--------|
| Authentication | Password guessing, theft | Gain identity |
| Authorization | Permission misconfiguration | Access without proper identity |
| Both | Token theft (Kerberos, JWT) | Assume identity AND permissions |

### Identity Enumeration

**Linux information gathering:**
```bash
# Current user identity
id
whoami

# All users
cat /etc/passwd

# All groups
cat /etc/group

# User's groups
groups username

# Users with shell access (potential interactive users)
grep -v nologin /etc/passwd | grep -v false

# Users with UID 0 (root equivalents)
awk -F: '$3 == 0 {print}' /etc/passwd
```

**Windows information gathering:**
```cmd
# Current user
whoami /all

# Local users
net user

# Local groups
net localgroup

# Specific group members
net localgroup Administrators

# Domain users (if domain-joined)
net user /domain
```

---

## 3. Guided Practice

### Exercise 1: Identity Analysis

Analyze your current identity:

```bash
# Full identity dump
id

# Decode the output:
# uid=1000(kali) gid=1000(kali) groups=1000(kali),27(sudo),44(video)...
```

Questions:
1. What is your UID? ___
2. What is your primary GID? ___
3. Are you in the sudo group? ___
4. What other groups are you in? ___

### Exercise 2: User Database Exploration

Examine the user database:

```bash
# View user database (sanitized)
cat /etc/passwd

# Count users with login shells
grep -c "/bin/bash\|/bin/zsh\|/bin/sh" /etc/passwd

# Find service accounts
awk -F: '$3 < 1000 {print $1}' /etc/passwd

# Find potential hidden root accounts
awk -F: '$3 == 0 {print}' /etc/passwd
```

### Exercise 3: Dangerous Group Check

Check for dangerous group memberships:

```bash
# Am I in docker group?
groups | grep -o docker

# List all members of sudo group
getent group sudo

# List all members of docker group
getent group docker
```

If you're in the docker group without needing it, why is this a security risk? ___

---

## 4. Reflection Check

### Identity Understanding
1. If you create a user named "admin" but assign UID 1001, is it actually an administrator?

2. An attacker adds a line to /etc/passwd creating user "backup" with UID 0. What have they accomplished?

3. Why do service accounts typically have `/usr/sbin/nologin` as their shell?

### Attack Perspective
1. During enumeration, you find a user in the "docker" group. Why does this immediately interest you?

2. On Windows, you discover a user in "Backup Operators". What can you potentially accomplish with this?

3. Why do password crackers target /etc/shadow rather than /etc/passwd?

---

## 5. Key Misconceptions

**MYTH: "The username 'root' is what makes it powerful"**
REALITY: UID 0 provides the power. Any account with UID 0 is root, regardless of name.

**MYTH: "System accounts can't be used for attacks"**
REALITY: Service accounts with weak configurations or accessible credentials are frequent attack vectors.

**MYTH: "Being in the 'docker' group is just for running containers"**
REALITY: Docker group access is equivalent to root access through volume mounting.

**MYTH: "Renaming Administrator makes it secure"**
REALITY: The RID 500 is still identifiable. Security through obscurity isn't security.

**MYTH: "Users can only have one group"**
REALITY: Users have a primary group plus multiple supplementary groups, all granting permissions.

---

## 6. Completion Criteria

This module is complete when you can:

1. **Explain** the difference between UIDs/GIDs and account names
2. **Identify** privileged accounts and groups in Linux and Windows
3. **Enumerate** user and group information on a system
4. **Recognize** dangerous group memberships and their exploitation potential
5. **Distinguish** between authentication and authorization

---

## 7. Further Depth (Optional)

*   **Research:** Study Windows SID structure and well-known SIDs
*   **Practice:** Enumerate users and groups on your lab systems
*   **Exploration:** Investigate lxd/docker group privilege escalation techniques
*   **Advanced:** Study Kerberos authentication and ticket-based identity
