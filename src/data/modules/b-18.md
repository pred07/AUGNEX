# Ansible: Configuration Management

## 1. Orientation

### What this module covers
While Terraform builds the *Server* (Hardware), Ansible configures the *Software* inside it. Ansible is **Agentless** (uses SSH) and uses YAML for its Playbooks.

### Learning Objectives
*   Understand the **Inventory** file.
*   Write a **Playbook** with multiple Tasks.
*   Use **Modules** (`apt`, `service`, `copy`) instead of shell commands.

---

## 2. Core Content

### inventory.ini
A list of targets.
```ini
[webservers]
192.168.1.10
192.168.1.11

[dbservers]
192.168.1.50
```

### The Playbook (YAML)
```yaml
- name: Secure Web Server
  hosts: webservers
  become: yes

  tasks:
    - name: Install Apache
      apt: 
        name: apache2 
        state: present

    - name: Disable Root Login
      lineinfile:
        path: /etc/ssh/sshd_config
        regexp: '^PermitRootLogin'
        line: 'PermitRootLogin no'
      notify: Restart SSH

  handlers:
    - name: Restart SSH
      service:
        name: sshd
        state: restarted
```

### Agentless Security
Ansible uses standard SSH. You don't need to install a proprietary agent on every server. 
*   **Auth:** Uses Keys. You need the private key on the Control Node.

---

## 3. Lab: Idempotency Check

### Scenario
You run the playbook above. 
*   **Result 1:** `changed=2` (Installed Apache, Disabled Root).
*   **Result 2 (Run again):** `changed=0`. 

**Why?** The `apt` module checked if apache was installed. It saw "yes", so it did nothing. This is safe automation.

---

## 4. Reflection
1.  Why is `become: yes` dangerous if not audited? (It grants Root privileges for the task. Use Least Privilege where possible).
2.  How is Ansible different from a Bash script loop? (Error handling, reporting, and idempotency are built-in).
