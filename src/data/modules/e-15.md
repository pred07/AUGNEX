# Web Authentication Mechanisms

## 1. Orientation

### What this module covers
This module examines how web applications verify identity—authentication mechanisms, their implementations, and their weaknesses. Authentication bypass is among the highest-impact vulnerabilities, often rated Critical.

### Fit in the Learning Path
Authentication is the front door. If you can bypass authentication, you skip all internal authorization checks. Understanding authentication mechanisms and their common flaws is essential for web application security testing.

### Learning Objectives
By the end of this module, you will:
*   Understand major authentication mechanisms and their weaknesses
*   Apply brute force and credential stuffing techniques
*   Recognize authentication bypass vulnerabilities
*   Test multi-factor authentication implementations

---

## 2. Core Content

### Mental Model: The Authentication Attack Surface

**How professionals think about this:**
Authentication is a complex process with many potential failure points. The login form is just the visible surface—behind it are password storage, session management, account recovery, and more.

```
AUTHENTICATION ATTACK SURFACE:

┌─────────────────────────────────────────────────────────────────────┐
│                                                                     │
│                      AUTHENTICATION FLOW                            │
│                                                                     │
│   USER INPUT                                                        │
│   ─────────                                                         │
│   Username ────┐                                                    │
│   Password ────┼──► [Login Form] ──► [Auth Logic] ──► [Session]    │
│   2FA Code ────┘                                                    │
│                        │              │               │             │
│                        ▼              ▼               ▼             │
│   ATTACK VECTORS:                                                   │
│                                                                     │
│   [Login Form]         [Auth Logic]      [Session]                  │
│   ├── Brute force      ├── SQLi          ├── Token theft            │
│   ├── Cred stuffing    ├── Logic flaws   ├── Fixation               │
│   ├── Username enum    ├── Race cond     ├── Weak ID                │
│   └── Rate limit bypass└── Type juggling └── No expiration          │
│                                                                     │
│   [Password Recovery]  [Registration]    [2FA]                      │
│   ├── Token prediction ├── Duplicate     ├── Bypass                 │
│   ├── Reset poisoning    accounts        ├── Brute force            │
│   └── Security Q weak  └── Mass assign   └── Fallback abuse         │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### Authentication Types

**Basic Authentication:**

```http
GET /protected HTTP/1.1
Authorization: Basic YWRtaW46cGFzc3dvcmQ=

# Decode Base64:
echo "YWRtaW46cGFzc3dvcmQ=" | base64 -d
# Result: admin:password

WEAKNESSES:
- Credentials sent with EVERY request
- Base64 is encoding, NOT encryption
- No session concept (credentials always in transit)
- Trivially sniffable without HTTPS
```

**Form-Based Authentication:**

```http
POST /login HTTP/1.1
Content-Type: application/x-www-form-urlencoded

username=admin&password=P@ssw0rd

WEAKNESSES:
- SQLi: username=' OR 1=1--&password=x
- Brute force if no rate limiting
- Password in request body (log exposure)
- CSRF if no tokens
```

**Token-Based (JWT, API keys):**

```
JWT Structure:
eyJhbGc.eyJzdWI.signature
│       │       │
│       │       └── Signature
│       └── Payload (claims)
└── Header (algorithm)

WEAKNESSES:
- None algorithm attack
- Weak signing secrets
- Client-side only logout
- Token theft via XSS
```

**OAuth 2.0:**

```
OAuth Flow:
User ──► App ──► Auth Server ──► User approves ──► Token ──► App

WEAKNESSES:
- Open redirect in redirect_uri
- Token theft via referrer leakage
- CSRF in callback
- Scope escalation
```

### Brute Force vs Credential Stuffing

**Understanding the difference:**

| Attack | Strategy | Success Rate |
|--------|----------|--------------|
| **Brute Force** | Try all password combinations | Very low |
| **Dictionary Attack** | Try common passwords | Low-Medium |
| **Credential Stuffing** | Use leaked credentials from other breaches | Very high |
| **Password Spraying** | Try one password across many accounts | Medium-High |

**Credential stuffing:**

```
CREDENTIAL STUFFING ATTACK:

Source: Leaked database (LinkedIn, Adobe, etc.)
Format: email@domain.com:Password123

1. Attacker obtains leaked credentials
2. Tests them on target sites
3. Users who reused passwords = compromised

WHY IT WORKS:
- 65% of users reuse passwords
- Billions of credentials available
- Automated testing at scale

DEFENSE:
- Password breach databases (HaveIBeenPwned)
- Rate limiting
- Device fingerprinting
- CAPTCHA on suspicious patterns
```

**Password spraying:**

```
PASSWORD SPRAYING:

Traditional brute force:
User1: pass1, pass2, pass3... (triggers lockout)
User2: pass1, pass2, pass3... (triggers lockout)

Password spray:
All users: Password123! (1 attempt each)
Wait 30 minutes
All users: Summer2024! (1 attempt each)

WHY IT WORKS:
- Stays under lockout threshold
- Common passwords work somewhere
- Enterprise often has password policies that create patterns
  (Company2024!, Welcome123!, etc.)
```

### Username Enumeration

**Information disclosure through login responses:**

```
ENUMERATION VIA DIFFERENT RESPONSES:

Valid user, wrong password:
"Invalid password"

Invalid user:
"User does not exist"

ENUMERATION VIA TIMING:

Valid user: Response in 100ms (database lookup + hash comparison)
Invalid user: Response in 5ms (quick fail, no hash comparison)

ENUMERATION VIA FORGOT PASSWORD:

Valid email:
"Password reset link sent"

Invalid email:
"Email not found"

SECURE RESPONSE (same for both):
"If this email exists, a reset link has been sent"
```

### Authentication Bypass Techniques

**SQL Injection:**

```sql
Username: admin'--
Password: anything

Query becomes:
SELECT * FROM users WHERE username='admin'--' AND password='anything'
                                       ^ Comment ignores password check
```

**Type Juggling (PHP):**

```php
// Vulnerable comparison
if ($password == $hash) { login(); }

// Attack:
$password = 0;  // Integer 0
$hash = "password123";  // Magic hash starts with 0e

// PHP:
0 == "0e123456" → true (both become 0)
```

**Logic Flaws:**

```
LOGIC FLAW EXAMPLE:

Normal flow:
Step 1: Enter credentials
Step 2: Enter 2FA code
Step 3: Access granted, set session

Attack:
Step 1: Enter credentials
Step 2: Skip (go directly to protected page with partial session)
Step 3: Access granted (developer assumed step 2 completed)

ALWAYS TEST:
- Can you skip steps?
- Can you repeat steps?
- Can you go backwards?
```

### Rate Limiting Bypass

**Common bypass techniques:**

| Defense | Bypass |
|---------|--------|
| IP-based limiting | X-Forwarded-For header rotation |
| Account lockout | Password spray (many accounts, few attempts) |
| CAPTCHA | OCR, CAPTCHA solving services ($2/1000) |
| Per-session limiting | New session per request |
| Delay-based | Parallel requests |

```http
# X-Forwarded-For rotation
POST /login HTTP/1.1
X-Forwarded-For: 1.1.1.1

POST /login HTTP/1.1
X-Forwarded-For: 1.1.1.2

POST /login HTTP/1.1
X-Forwarded-For: 1.1.1.3
# Each "new IP" gets fresh rate limit
```

### Multi-Factor Authentication Bypass

**2FA weaknesses:**

| Bypass | Technique |
|--------|-----------|
| **Code brute force** | 6-digit code = 1 million options |
| **Rate limit absence** | Try all codes rapidly |
| **Code reuse** | Used code still valid |
| **Fallback abuse** | Switch to SMS, then SIM swap |
| **Direct navigation** | Skip 2FA page, load dashboard |
| **Response manipulation** | Change {"success":false} to true |
| **Session state** | 2FA verified flag in cookie |

```
2FA BYPASS FLOW:

Step 1: Login with valid credentials
Step 2: Server redirects to 2FA page
Step 3: Instead of entering code, access /dashboard directly
Step 4: If server didn't properly track authentication state:
        Dashboard loads (2FA bypassed)
```

### Password Recovery Attacks

**Reset flow vulnerabilities:**

```
RESET TOKEN ATTACKS:

Predictable tokens:
- Sequential: reset_token=1234, 1235, 1236
- Time-based: base64(timestamp + user_id)
- Weak random: MD5(time())

Host header poisoning:
POST /forgot-password HTTP/1.1
Host: attacker.com

Email sent: "Reset here: http://attacker.com/reset?token=SECRET"
User clicks → attacker captures token

Token leakage:
- In referrer header
- In URL (access logs)
- Via redirect chains
```

---

## 3. Guided Practice

### Exercise 1: Basic Auth Decode

Decode this header:
```http
Authorization: Basic cm9vdDp0b29y
```

Username: ___
Password: ___

### Exercise 2: Attack Classification

For each scenario, identify the attack type:

| Scenario | Attack Type |
|----------|-------------|
| Testing `admin:admin`, `admin:password` | ___ |
| Using LinkedIn breach data | ___ |
| Trying `Company2024!` on 1000 accounts | ___ |
| Entering `' OR 1=1--` as username | ___ |

### Exercise 3: Bypass Analysis

For a 2FA implementation, list what you would test:

1. ___
2. ___
3. ___
4. ___

---

## 4. Reflection Check

### Understanding Authentication
1. Why is credential stuffing so effective compared to brute force?

2. A login form shows "Invalid password" for valid users. What's wrong?

3. Why might a 6-digit MFA code still be brute-forceable?

### Attack Thinking
1. Rate limiting is based on IP. You're behind VPN. How do you abuse this?

2. The forgot password page says "Email sent" regardless of whether the email exists. Is this secure?

3. 2FA uses SMS. What's the risk compared to TOTP?

---

## 5. Key Misconceptions

**MYTH: "MFA makes authentication secure"**
REALITY: MFA raises the bar but can still be bypassed, phished, or poorly implemented.

**MYTH: "Account lockout stops attacks"**
REALITY: Password spraying (one password, many accounts) bypasses per-account lockout.

**MYTH: "We use strong hashing, so we're safe"**
REALITY: Hashing protects stored passwords, not the authentication endpoint itself.

**MYTH: "Rate limiting by IP stops brute force"**
REALITY: Attackers use distributed attacks, proxy chains, and header manipulation.

**MYTH: "OAuth is always more secure than passwords"**
REALITY: OAuth implementations frequently have misconfigurations (open redirects, token leakage).

---

## 6. Completion Criteria

This module is complete when you can:

1. **Identify** authentication mechanism types and their weaknesses
2. **Distinguish** between brute force, credential stuffing, and password spraying
3. **Test** for username enumeration vulnerabilities
4. **Recognize** 2FA bypass opportunities
5. **Explain** authentication vs authorization

---

## 7. Further Depth (Optional)

*   **Practice:** OWASP Juice Shop authentication challenges
*   **Tool:** Hydra, Burp Intruder for credential attacks
*   **Research:** OAuth 2.0 security best practices
*   **Reading:** OWASP Authentication Cheat Sheet
