# Linux Logging Fundamentals

## 1. Orientation

### What this module covers
This module covers Linux logging—from traditional syslog to modern journald. Understanding Linux logs is essential because Linux powers the majority of servers, cloud infrastructure, and security tooling. If you can't navigate Linux logs, you can't investigate Linux systems.

### Fit in the Learning Path
Linux powers the internet backbone, cloud providers, and most enterprise servers. Security professionals must be fluent in Linux log analysis for incident response, threat hunting, and system administration.

### Learning Objectives
By the end of this module, you will:
*   Navigate the Linux logging ecosystem
*   Use syslog and journald effectively
*   Find security-relevant information in logs
*   Apply command-line tools for log analysis

---

## 2. Core Content

### Mental Model: The Linux Logging Ecosystem

**How professionals think about this:**
Linux logging is simpler conceptually (text files) but more fragmented (each application chooses its format). The transition from syslog to journald adds complexity, but understanding both is essential.

```
LINUX LOGGING ARCHITECTURE:

┌─────────────────────────────────────────────────────────────────────┐
│                                                                     │
│  TRADITIONAL (Syslog-based)         MODERN (Systemd-based)         │
│                                                                     │
│  ┌─────────────┐                    ┌─────────────┐                │
│  │ Application │                    │ Application │                │
│  │   (daemon)  │                    │  (service)  │                │
│  └──────┬──────┘                    └──────┬──────┘                │
│         │                                  │                        │
│         │ syslog()                         │ stdout/stderr          │
│         ▼                                  ▼                        │
│  ┌─────────────┐                    ┌─────────────┐                │
│  │   rsyslog   │                    │  journald   │                │
│  │  syslog-ng  │                    │  (systemd)  │                │
│  └──────┬──────┘                    └──────┬──────┘                │
│         │                                  │                        │
│         ▼                                  ▼                        │
│  /var/log/*.log                     Binary journal                  │
│  (text files)                       (journalctl)                    │
│                                                                     │
│  ┌────────────────────────────────────────────────────────────────┐│
│  │ Many systems use BOTH - journald forwards to rsyslog          ││
│  │ or vice versa for compatibility                               ││
│  └────────────────────────────────────────────────────────────────┘│
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### Log Locations

**Essential log files:**

| Log File | Distribution | Contents |
|----------|--------------|----------|
| `/var/log/syslog` | Debian/Ubuntu | General system messages |
| `/var/log/messages` | RHEL/CentOS | General system messages |
| `/var/log/auth.log` | Debian/Ubuntu | Authentication events |
| `/var/log/secure` | RHEL/CentOS | Authentication events |
| `/var/log/kern.log` | Most | Kernel messages |
| `/var/log/dmesg` | Most | Boot/hardware messages |
| `/var/log/cron` | Most | Cron job execution |
| `/var/log/maillog` | Most | Email server logs |

**Application logs:**

```
COMMON APPLICATION LOG LOCATIONS:

Web Servers:
/var/log/apache2/access.log     # Debian Apache
/var/log/apache2/error.log
/var/log/httpd/access_log       # RHEL Apache
/var/log/httpd/error_log
/var/log/nginx/access.log       # Nginx
/var/log/nginx/error.log

Databases:
/var/log/mysql/error.log        # MySQL
/var/log/postgresql/            # PostgreSQL

SSH:
/var/log/auth.log               # SSH in auth.log (Debian)
/var/log/secure                 # SSH in secure (RHEL)

Boot:
/var/log/boot.log               # Service startup
dmesg                           # Kernel ring buffer
```

### Syslog Format

**Traditional syslog structure:**

```
SYSLOG MESSAGE FORMAT:

Aug 15 10:30:45 webserver01 sshd[12345]: Accepted publickey for admin from 192.168.1.100 port 54321 ssh2
│      │        │           │     │      └── Message
│      │        │           │     └── Process ID (PID)
│      │        │           └── Program/Service name
│      │        └── Hostname
│      └── Timestamp
└── Month

LIMITATIONS:
- No year in timestamp (rollover ambiguity)
- No timezone
- Unstructured message (parsing nightmare)
```

**Syslog facility and severity:**

```
SYSLOG PRIORITY = (Facility * 8) + Severity

FACILITIES:
0  kern     - Kernel messages
1  user     - User-level messages
2  mail     - Mail system
3  daemon   - System daemons
4  auth     - Authentication (security)
10 authpriv - Authentication (privileged)
16-23 local0-7 - Local use

SEVERITIES:
0 emerg   - System is unusable
1 alert   - Action must be taken immediately
2 crit    - Critical conditions
3 err     - Error conditions
4 warning - Warning conditions
5 notice  - Normal but significant
6 info    - Informational
7 debug   - Debug-level messages
```

### Journald (systemd)

**Modern logging with journald:**

```bash
# View all logs
journalctl

# Follow logs in real-time
journalctl -f

# Logs since boot
journalctl -b

# Previous boot
journalctl -b -1

# By time range
journalctl --since "2024-01-15 09:00:00" --until "2024-01-15 10:00:00"
journalctl --since "1 hour ago"

# By unit (service)
journalctl -u sshd
journalctl -u nginx.service

# By priority
journalctl -p err            # Error and above
journalctl -p warning

# By specific field
journalctl _UID=1000         # Specific user
journalctl _COMM=sudo        # Specific command

# JSON output for parsing
journalctl -o json

# Kernel messages only
journalctl -k
```

### Security-Relevant Log Analysis

**Finding attacks in auth.log:**

```bash
# Failed SSH logins
grep "Failed password" /var/log/auth.log

# Successful SSH logins
grep "Accepted" /var/log/auth.log

# Sudo commands
grep "COMMAND" /var/log/auth.log

# Root logins
grep "session opened for user root" /var/log/auth.log

# Brute force detection (count by IP)
grep "Failed password" /var/log/auth.log | \
  grep -oE "from [0-9.]+" | \
  cut -d' ' -f2 | \
  sort | uniq -c | sort -rn | head

# Invalid users (username enumeration)
grep "invalid user" /var/log/auth.log

# Account manipulation
grep -E "useradd|userdel|usermod|passwd" /var/log/auth.log
```

**Journalctl security queries:**

```bash
# Failed authentication (journald)
journalctl -u ssh _AUDIT_TYPE=1 | grep -i fail

# All authentication events
journalctl SYSLOG_FACILITY=4
journalctl SYSLOG_FACILITY=10

# Sudo usage
journalctl _COMM=sudo

# Recent cron activity
journalctl -u cron --since "1 day ago"
```

### Command-Line Log Analysis

**Essential commands:**

```bash
# View logs with context
tail -f /var/log/syslog           # Follow in real-time
tail -100 /var/log/auth.log       # Last 100 lines
head -50 /var/log/syslog          # First 50 lines
less /var/log/syslog              # Paginated view

# Search and filter
grep "error" /var/log/syslog      # Find matches
grep -i "error" /var/log/syslog   # Case insensitive
grep -v "CRON" /var/log/syslog    # Exclude pattern
grep -E "error|fail|warn" /var/log/syslog  # Multiple patterns

# Extract and count
grep "Failed password" /var/log/auth.log | wc -l

# Time-based analysis
grep "Aug 15 10:" /var/log/syslog

# Process specific fields
awk '{print $1, $2, $3, $5}' /var/log/syslog

# Unique values
cut -d' ' -f5 /var/log/auth.log | sort | uniq -c | sort -rn

# Complex pipeline for investigation
cat /var/log/auth.log | \
  grep "Failed password" | \
  awk '{print $(NF-3)}' | \   # Extract IP
  sort | uniq -c | sort -rn | \
  head -10
```

### Log Rotation

**Managing log size:**

```
LOG ROTATION CONCEPT:

/var/log/auth.log       ← Current (active writing)
/var/log/auth.log.1     ← Previous (rotated)
/var/log/auth.log.2.gz  ← Older (compressed)
/var/log/auth.log.3.gz
/var/log/auth.log.4.gz  ← Oldest (will be deleted)

Configuration: /etc/logrotate.conf
Per-app config: /etc/logrotate.d/*

FORENSIC IMPLICATION:
- Check .1, .2.gz files for historical data
- gunzip *.gz files before searching
- Rotation may happen mid-incident
```

**Searching rotated logs:**

```bash
# Search compressed logs
zgrep "Failed password" /var/log/auth.log.*.gz

# Search all auth logs
grep "Failed password" /var/log/auth.log* | head

# Decompress and analyze
gunzip -c /var/log/auth.log.2.gz | grep "Failed password"
```

### Remote Logging

**Sending logs off-system:**

```
RSYSLOG REMOTE CONFIGURATION:

Client (/etc/rsyslog.conf):
*.* @@logserver.example.com:514    # TCP
*.* @logserver.example.com:514     # UDP

Server (/etc/rsyslog.conf):
module(load="imtcp")
input(type="imtcp" port="514")

WHY REMOTE LOGGING:
- Attackers with root CAN modify local logs
- Attack timeline preserved even if system compromised
- Centralized analysis and correlation
- Compliance requirements
```

---

## 3. Guided Practice

### Exercise 1: Log Navigation

Execute and record findings:

```bash
# List log files
ls -la /var/log/

# Check auth log location
cat /var/log/auth.log 2>/dev/null || cat /var/log/secure
```

Distribution type (Debian/RHEL): ___
Security log file found: ___

### Exercise 2: Authentication Analysis

Find login events:

```bash
# View SSH activity
grep -E "sshd.*(Accepted|Failed)" /var/log/auth.log | tail -10
```

Questions:
- Any failed logins? Y/N: ___
- Source IPs observed: ___

### Exercise 3: Journalctl Practice

```bash
# Check if journald is used
journalctl --no-pager | head -20

# Find errors
journalctl -p err --since "24 hours ago"
```

Number of errors in last 24 hours: ___

---

## 4. Reflection Check

### Technical Understanding
1. Why can root easily modify /var/log files? What's the mitigation?

2. You're investigating a breach from 3 days ago. auth.log only has today's data. Where else might you find evidence?

3. Syslog timestamps don't include year. Why is this problematic for forensics?

### Practical Thinking
1. An attacker gains root. They run `echo "" > /var/log/auth.log`. What evidence might still exist?

2. Why do many organizations use both journald AND rsyslog?

3. You need to search 50 servers for a specific login. How would you approach this?

---

## 5. Key Misconceptions

**MYTH: "Linux logs are in a standard format"**
REALITY: Each application can choose its own format. Parsing is complex without normalization.

**MYTH: "journalctl replaces log files completely"**
REALITY: Most systems keep both. Journal may forward to rsyslog, or rsyslog to journal.

**MYTH: "Journald logs persist across reboots by default"**
REALITY: On many systems, journal is volatile by default. Check /etc/systemd/journald.conf.

**MYTH: "root access means all evidence is destroyed"**
REALITY: Remote logs, ARP tables, neighbor logs, netflow data, and memory artifacts may survive.

**MYTH: "grep is sufficient for log analysis"**
REALITY: grep is essential but limited. Learn awk, sed, cut for complex parsing. Consider ELK for scale.

---

## 6. Completion Criteria

This module is complete when you can:

1. **Navigate** /var/log and identify key log files
2. **Use** both grep-based and journalctl-based log analysis
3. **Find** authentication events in auth.log/secure
4. **Search** rotated and compressed log files
5. **Understand** the value of remote logging

---

## 7. Further Depth (Optional)

*   **Tool:** Configure rsyslog for remote logging
*   **Practice:** Set up ELK stack for log analysis
*   **Research:** Auditd for detailed Linux auditing
*   **Script:** Build a log analysis script for incident response
