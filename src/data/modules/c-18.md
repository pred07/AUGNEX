# Detection Logic Basics

## 1. What this module covers
The syntax and logic of writing queries. Boolean logic, Patterns, and Thresholds.

## 2. Why this matters for purple teams
You can't test detections if you can't read the code that defines them.

## 3. Core concepts explained clearly

### Boolean Operators
*   **AND**: Both must be true. (Narrower).
*   **OR**: One must be true. (Broader).
*   **NOT**: Must be false. (Exclusion).

### Search Types
*   **String Match**: `message contains "error"`. (Simple).
*   **Regex**: `message matches "User \d+ failed"`. (Powerful, slow).
*   **Frequency**: `count() > 5 in 1 minute`. (Brute force).

## 4. Validation examples

### Logic Error Testing
*   **Goal**: Detect `cmd.exe` running from Temp.
*   **Rule A**: `Image="*temp*cmd.exe"` (Matches `C:\temp\cmd.exe` - Specific).
*   **Rule B**: `Image="*temp*" AND Image="*cmd.exe*"` (Matches `C:\temp\folder\cmd.exe` - Better).
*   **Test**: Create `C:\temp\subfolder\cmd.exe`. Rule A fails. Rule B passes.

## 5. Common gaps and failures
*   **Case Sensitivity**: In some SIEMs, `User="Admin"` does not match `User="admin"`.
*   **Order of Operations**: `A AND B OR C`. Is it `(A&B)|C` or `A&(B|C)`? Always use parentheses!

## 6. Key takeaways
*   **Complexity**: Complex logic is hard to debug. Keep it simple.
*   **Performance**: Wildcards at the *start* of a string (`*mimikatz`) are very CPU intensive. Use them sparingly.
