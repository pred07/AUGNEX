# Kubernetes Security Hardening

## 1. Orientation

### What this module covers
Default K8s is open. Hardened K8s is a fortress. This module covers **RBAC** (Role Based Access Control), **Network Policies** (Firewalls for Pods), and **Pod Security Standards (PSS)**.

### Learning Objectives
*   Write a restrictive **Network Policy**.
*   Audit **RBAC Roles** for privilege escalation.
*   Enforce **Pod Security Admission** (Block Root containers).

---

## 2. Core Content

### Network Policies
By default, all pods can talk to all pods. (Flat network). 
*   **Attack:** Web Pod hacked -> Connect to Database Pod directly.
*   **Defense:** NetworkPolicy (YAML) that says "DB can only accept connections from Web".

### RBAC (Role Based Access Control)
*   **Role:** Permissions within a Namespace.
*   **ClusterRole:** Permissions across the entire cluster.
*   *Dangerous:* `verbs: ["*"]`, `resources: ["secrets"]`.

### Pod Security Standards (PSS)
Replacing the old "Pod Security Policy (PSP)".
*   **Privileged:** Unrestricted.
*   **Baseline:** Minimal restrictions.
*   **Restricted:** Heavily hardened (No Root, Drop Capabilities, Seccomp required). 
*   *Enforcement:* Via Admission Controllers.

---

## 3. Lab: The Network Firewall

### Task
Isolate the `backend` namespace so it only accepts traffic from `frontend`.

**NetworkPolicy.yaml**
```yaml
kind: NetworkPolicy
apiVersion: networking.k8s.io/v1
metadata:
  name: allow-frontend
  namespace: backend
spec:
  podSelector:
    matchLabels:
      app: db
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          name: frontend
```
*   **Effect:** If you exec into a `debug` pod in the `default` namespace and try to curl the DB, it hangs. Connection refused.

---

## 4. Reflection
1.  Why is "Namespace" not a hard security boundary? (It segregates resources, but unless you have Network Policies, traffic can still flow between namespaces).
2.  What is an "Admission Controller"? (A piece of code that intercepts requests to the API server *before* an object is persisted. It's the bouncer that says "No Root Containers Allowed").
