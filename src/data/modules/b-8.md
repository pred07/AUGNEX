# Active Directory Secure Design

## 1. Orientation

### What this module covers
Active Directory (AD) is the "Keys to the Kingdom" for 90% of the Fortune 500. It is also the most attacked component. This module covers **Securing AD by Design**. We assume you know what AD is. We will focus on the **Tier Model**, **Clean Source Principle**, and **Privileged Access Workstations (PAW)**.

### Learning Objectives
By the end of this module, you will:
*   Implement the **Microsoft Enterprise Access Model (Tier Model)**
*   Design a **Red Forest / ESAE** (Enhanced Security Admin Environment) concept
*   Explain why "Domain Admins" should never log into a workstation
*   Understand the "AdminSDHolder" and "SDProp" protection mechanism

---

## 2. Core Content

### The Tier Model (The Golden Rule)
The default state of AD is flat. If a Domain Admin logs into a Helpdesk laptop, and that laptop has malware, the hash is stolen, and the Domain is owned (Pass-the-Hash).

**The Solution: Segmentation by Trust Level.**

*   **Tier 0 (Control Plane):** Domain Controllers, PKI, ADFS, MIM.
    *   *Admins:* Only T0 Admins manage these.
    *   *Workstations:* Only T0 PAWs can access these.
    *   *Rule:* T0 accounts NEVER log onto T1/T2 assets.

*   **Tier 1 (Data Plane):** App Servers, DBs, File Shares.
    *   *Admins:* T1 Admins manage these.
    *   *Rule:* T1 accounts NEVER log onto T2 assets.

*   **Tier 2 (User Plane):** Workstations, Laptops, Printers.
    *   *Admins:* Helpdesk/Local Admins.

**The Barrier:**
Technically enforced (Authentication Policies / GPOs). "Deny Log on Locally" for T0 users on T1/T2 machines.

### Clean Source Principle
**"You cannot secure a system from a system of lower trust."**
*   If you manage a Domain Controller (High Trust) from a User Laptop (Low Trust), the DC is now Low Trust.
*   **Requirement:** Privileged Access Workstations (PAW). A dedicated, hardened laptop for admin tasks ONLY. No email, no internet browsing.

### Kerberos Security Indicators
*   **Golden Ticket:** Attacker has the KRBTGT hash. They can forge TGTs for any user (fake Domain Admin) valid for 10 years.
*   **Silver Ticket:** Attacker has a Service Account hash. They can forge TGS tickets for that specific service.

---

## 3. Application: Designing a Secure Forest

### Scenario
You are architecting a new AD for a bank.

**Step 1: The Red Forest (Admin Forest)**
*   Create a separate Forest just for Admins.
*   One-way Trust: Production Forest trusts Red Forest. Red Forest trusts NO ONE.
*   Admins live in Red Forest. Resources live in Production.

**Step 2: Principals**
*   Create `T0_Admin_Jill`, `T1_Admin_Jill`, `User_Jill`.
*   Jill uses `User_Jill` for email.
*   Jill uses `T0_Admin_Jill` ONLY on her PAW to manage DCs.

**Step 3: GPO Hardening**
*   Disable NTLMv1 (Force NTLMv2 or Kerberos).
*   Enable "SMB Signing" (Prevent Relay Attacks).
*   Enable "LAPS" (Local Admin Password Solution) to rotate local admin passwords daily.

---

## 4. Reflection Check
1.  Why is "Cached Credentials" on a laptop a risk to the Domain Controller?
2.  What happens if you find a Domain Admin logged into a Receptionist PC? (Incident Response!)
3.  Why is the KRBTGT password rotation the most critical maintenance task?

---

## 5. Completion Criteria
1.  **Draw** the 3-Tier Model.
2.  **Configure** a GPO to "Deny Log on as Batch Job" for Domain Admins on Workstations.
3.  **Explain** why "One-Way Trust" protects the Admin Forest.
