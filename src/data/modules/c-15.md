# Validating Command-Line and Script Activity

## 1. Orientation

### What this module covers
This module covers specific scripting engines: **PowerShell** and **Bash**. Hackers love them.

### Fit in the Learning Path
"Living off the Land" means using scripts. If you don't log the script content, you only see "Script Ran", not "Script stole passwords".

### Learning Objectives
By the end of this module, you should understand:
*   **AMSI** (Anti-Malware Scan Interface).
*   **Script Block Logging** (4104).
*   **Module Logging** (4103).

---

## 2. Core Content

### PowerShell Logging
Key Event IDs:
*   **4104 (Script Block)**: Logs the *de-obfuscated* code. Even if they used Base64, this log shows the real code.
*   **4103 (Module)**: Logs which commands were executed.

### Bash Logging
*   `.bash_history`: Can be deleted by user. Unreliable.
*   **Auditd**: The Linux kernel auditor. Can log every `execve` syscall.
    *   *Validation*: `auditctl -w /bin/cat -p x -k cat_exec`.

---

## 3. Guided Practice

### The Obfuscation Test
**Action**:
Run encoded PowerShell:
`powershell -enc RwBlAHQALQBEAGEAdABlAA==` (Get-Date).

**Validation**:
1.  Check Event Viewer > Applications and Services > Microsoft > Windows > PowerShell > Operational.
2.  Look for ID **4104**.
3.  Do you see `Get-Date`?
    *   Yes? -> **Success** (AMSI/ScriptBlock working).
    *   No? -> Turn on GPO.

---

## 4. Reflection Check

1.  **Volume**: 4104 logs are huge. (Warning: Disk space usage increases significantly).
2.  **Bypass**: Can AMSI be bypassed? (Yes. But the *attempt* to bypass it usually generates a log itself).
3.  **Privacy**: These logs capture passwords if admins type them in the console. (Education: "Don't type passwords in CLI").

---

## 5. Completion Criteria

This module is complete when:
1.  You verify **Event ID 4104** is flowing.
2.  You understand that **Bash History** is not a security control.
3.  You accept the storage cost of full script logging.
