# Container Fundamentals (Docker)

## 1. Orientation

### What this module covers
Containers are "Processes on Steroids," not "Mini VMs." They share the Host Kernel. This means if you escape a container, you are often Root on the host. This module defines the underlying Linux primitives: **Namespaces** and **Cgroups**.

### Learning Objectives
*   Explain **Namespaces** (Isolation) vs **Cgroups** (Resource Control).
*   Deconstruct a `Dockerfile` for security flaws.
*   Understand the **Docker Daemon** attack surface.

---

## 2. Core Content

### Under the Hood
Docker is a wrapper around Linux features:
1.  **Namespaces:** What you can *see*. (PID, Network, Mount, User).
    *   *PID Namespace:* Process 1 in container looks like Process 1. On host, it's Process 4567.
2.  **Cgroups (Control Groups):** What you can *use*. (CPU, RAM limits).

### The Dockerfile
Instructions to build an image.

**Secure Dockerfile Example:**
```dockerfile
# 1. Use specific base image (Minimize surface area)
FROM alpine:3.14 

# 2. Don't run as Root
RUN addgroup -S appgroup && adduser -S appuser -G appgroup
USER appuser

# 3. Copy only what is needed
COPY --chown=appuser:appgroup . /app
```

### The Deadly Flag: `--privileged`
Running `docker run --privileged` gives the container access to *all* host devices.
*   **Impact:** Container can mount the host's hard drive and wipe it. It disables almost all security namespaces.

---

## 3. Lab: Container Escape (Simulation)

### Scenario
You have a container running as Root.

1.  **Check Capabilities:** `capsh --print`.
2.  **Mount Host Disk:** If you are privileged, you can run:
    ```bash
    mkdir /host
    mount /dev/sda1 /host
    cat /host/etc/shadow
    ```
3.  **Result:** You have the Host's password hashes. Game Over.

**Defense:** NEVER run as Root. Use `USER appuser` in Dockerfile. Drop Capabilities (`--cap-drop=ALL`).

---

## 4. Reflection
1.  Why is `alpine` preferred over `ubuntu` for base images? (Smaller size = fewer installed packages = fewer vulnerabilities).
2.  Is a container a security boundary? (By default, no. It's an application delivery mechanism. You must add barriers like Seccomp and AppArmor to make it secure).
