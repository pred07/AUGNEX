# Firewalls: Concepts and Rule Logic

## 1. Unit Brief: The Traffic Cop
A Firewall filters traffic based on rules. Start simply: Source, Destination, Port, Action.

## 2. Real-World Relevance
*   **Ingress Filter**: Blocking "Any -> Port 22" prevents the world from brute-forcing your SSH.
*   **Egress Filter**: Blocking "Server -> Port 6667 (IRC)" prevents malware from chatting with its Controller.

## 3. Core Concepts

### Types of Firewalls
*   **Packet Filtering (L3/L4)**: stateless. Fast. "Block IP 1.2.3.4".
*   **Stateful Inspection**: Remembers connections. "Allow return traffic if I initiated it."
*   **Next-Generation (NGFW / L7)**: Deep Packet Inspection. "Block 'Facebook Games' but allow 'Facebook Chat'".

### The Rule Base
Processed Top-Down. First match wins.
1.  Allow HR to Web.
2.  Allow IT to Server.
3.  **Deny Any Any (Implicit Cleanup)**.

## 4. Practical Examples

### IPTables (Linux)
```bash
# Allow established connections (Stateful)
iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
# Allow SSH
iptables -A INPUT -p tcp --dport 22 -j ACCEPT
# Drop everything else
iptables -P INPUT DROP
```

### UFW (Uncomplicated Firewall)
`ufw allow 22/tcp`
`ufw enable`

## 5. Common Mistakes Beginners Make
*   **Shadowed Rules**: Placing "Deny All" at the top. It matches everything, so the specific "Allow Web" rules below it never execute.
*   **Temporary Rules**: "Allow Any Any" for testing. Forgetting to remove it.

## 6. Key Takeaways
*   **Order Matters**: Specific rules first. General rules last.
*   **Log the Drops**: The "Deny" log is your best source of threat intel.
