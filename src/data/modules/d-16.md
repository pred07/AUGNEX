# Firewalls: Concepts and Rule Logic

## 1. Orientation

### What this module covers
This module defines the **Firewall**. The traffic cop of the network. We examine **Stateless**, **Stateful**, and **Next-Gen (NGFW)**.

### Fit in the Learning Path
The firewall is the first line of defense. A bad rulebase exposes the entire company.

### Learning Objectives
By the end of this module, you should understand:
*   **The Implicit Deny**.
*   **Stateful Inspection** (Tracking connections).
*   **Layer 7 Inspection** (NGFW).

---

## 2. Core Content

### Types of Firewalls
1.  **Packet Filtering (Stateless)**: Look at individual packets. "Allow Port 80". (Old).
2.  **Stateful Inspection**: Remembers the connection. "Allow packets from Server if Client asked for them first." (Standard).
3.  **NGFW (Next-Gen)**: "Allow 'Facebook' but Block 'Farmville'". Looks at the Application Layer (L7).

### Rule Logic (Top-Down)
Firewalls process rules from Top to Bottom. First match wins.
1.  Allow 1.1.1.1 to 2.2.2.2.
2.  Deny All to 2.2.2.2.
3.  Allow 3.3.3.3 to 2.2.2.2. (Will never happen, because Rule 2 blocked it).

### Implicit Deny
If no rule matches, the default action is **DROP**.

---

## 3. Guided Practice

### Writing a Rulebase
**Goal**: Allow a Web Server (Port 80/443) and SSH (Port 22) for Admins only.

**Rule 1**:
*   Src: Start of "World" (Any)
*   Dst: Web Server
*   Port: 80, 443
*   Action: **ALLOW**

**Rule 2**:
*   Src: Admin IP Range
*   Dst: Web Server
*   Port: 22
*   Action: **ALLOW**

**Rule 3 (The Cleanup)**:
*   Src: Any
*   Dst: Any
*   Port: Any
*   Action: **DENY** (Implicit).

---

## 4. Reflection Check

1.  **Egress**: Should we filter Outbound traffic? (Yes! If a server tries to connect to a C2 server on Port 6667, the Egress firewall should block it).
2.  **Order**: Why put the most used rules at the top? (Performance. Don't make the packet check 1000 rules before finding the match).
3.  **Shadow rules**: What happens if Rule 1 is "Allow Any" and Rule 100 is "Deny Bad Guy"? (Rule 100 is useless. Shadowed).

---

## 5. Completion Criteria

This module is complete when:
1.  You can write a 5-tuple ACL.
2.  You understand why "Order Matters".
3.  You treat "Any-Any-Allow" as a cardinal sin.
