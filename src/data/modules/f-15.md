# File and Process Management

## 1. Orientation

### What this module covers
This module covers file manipulation and process control—the administrative operations that let you create, modify, delete, find files, and manage running programs. These are the verbs of Linux; navigation is useless without the ability to act.

### Fit in the Learning Path
After learning to navigate, you need to interact. Every security task involves creating tools, modifying configurations, cleaning up tracks, or controlling processes. These commands are used every day.

### Learning Objectives
By the end of this module, you will:
*   Create, copy, move, and delete files and directories
*   Find files using multiple methods
*   Monitor and control running processes
*   Understand the danger of destructive commands

---

## 2. Core Content

### Mental Model: CRUD for Files and Processes

**How professionals think about this:**
Linux administration is about Create, Read, Update, Delete operations on two types of objects: files (persistent data) and processes (running programs). Know the commands for each operation.

```
FILE OPERATIONS:             PROCESS OPERATIONS:
┌───────────────────────┐    ┌───────────────────────┐
│ CREATE: touch, mkdir  │    │ START:  ./command     │
│ READ:   cat, less     │    │ LIST:   ps, top       │
│ UPDATE: cp, mv, edit  │    │ SIGNAL: kill          │
│ DELETE: rm, rmdir     │    │ STOP:   kill, Ctrl+C  │
│ FIND:   find, locate  │    │ BACKGROUND: &, bg, fg │
└───────────────────────┘    └───────────────────────┘
```

### File Creation

**touch - Create empty file or update timestamp:**
```bash
touch newfile.txt           # Create empty file
touch file1 file2 file3     # Create multiple files
touch existing.txt          # Updates timestamp only
```

**mkdir - Create directory:**
```bash
mkdir newdir                # Create directory
mkdir -p path/to/deep/dir   # Create full path (-p = parents)
mkdir dir1 dir2 dir3        # Create multiple
```

**Creating with content:**
```bash
echo "content" > file.txt           # Create with content
echo "more" >> file.txt             # Append to file
cat > file.txt << EOF               # Multi-line content
Line 1
Line 2
EOF
```

### File Copying and Moving

**cp - Copy:**
```bash
cp source.txt dest.txt             # Copy file
cp source.txt /path/to/dest/       # Copy to directory
cp -r sourcedir destdir            # Copy directory recursively
cp -p source.txt dest.txt          # Preserve permissions
cp -i source.txt dest.txt          # Interactive (ask before overwrite)
```

**mv - Move/Rename:**
```bash
mv oldname.txt newname.txt         # Rename
mv file.txt /path/to/dest/         # Move
mv file.txt /path/to/newname.txt   # Move and rename
mv -i file.txt /dest/              # Interactive (ask before overwrite)
```

### File Deletion

**rm - Remove (DANGEROUS):**
```bash
rm file.txt                 # Delete file
rm file1.txt file2.txt      # Delete multiple
rm -r directory/            # Delete directory recursively
rm -f file.txt              # Force (no confirmation)
rm -rf directory/           # Recursive + Force (VERY DANGEROUS)
rm -i file.txt              # Interactive (ask first)
```

**WARNING: rm has no undo. There is no Recycle Bin.**

```
DANGER ZONE:
┌─────────────────────────────────────────────────────────────────────┐
│                                                                     │
│   rm -rf /                  # DESTROYS ENTIRE SYSTEM               │
│   rm -rf ~                  # DESTROYS ALL YOUR FILES              │
│   rm -rf .                  # DESTROYS CURRENT DIRECTORY           │
│   rm -rf / path/to/delete   # SPACE TYPO = DISASTER                │
│         ^                                                           │
│         └── This space makes it "rm -rf /" THEN "/path/to/delete"   │
│                                                                     │
│   ALWAYS: Double-check rm commands before pressing Enter            │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

**Safer deletion practices:**
```bash
# Use trash instead of rm
trash-put file.txt          # If trash-cli installed

# Use rm -i for important deletions
rm -ri important_directory/

# Dry run with ls first
ls /path/to/delete          # See what would be deleted
rm -rf /path/to/delete      # Then delete
```

### Finding Files

**find - Most powerful, searches in real-time:**
```bash
# Find by name
find /path -name "filename"
find / -name "password.txt"
find /home -name "*.txt"              # Wildcard

# Find by type
find /path -type f                     # Files only
find /path -type d                     # Directories only
find /path -type l                     # Symlinks

# Find by permissions
find / -perm -4000                     # SUID files
find /home -perm -o+w                  # World-writable

# Find by owner
find / -user root -perm -4000          # SUID owned by root
find /var -user www-data               # Files owned by www-data

# Find by time
find /var/log -mtime -1                # Modified in last 1 day
find / -mmin -60                       # Modified in last 60 minutes

# Find and act
find /tmp -name "*.tmp" -delete        # Find and delete
find /home -name "*.sh" -exec chmod +x {} \;  # Find and chmod
```

**locate - Faster but uses database:**
```bash
locate filename                        # Fast search
sudo updatedb                          # Update locate database
```

**which / whereis - Find commands:**
```bash
which python3                          # Find command path
whereis python3                        # Find binary, source, manual
```

### Process Viewing

**ps - Process snapshot:**
```bash
ps                          # Current terminal processes
ps aux                     # All processes, detailed
ps aux | grep ssh          # Find SSH processes
ps -ef                     # Full format listing
ps -u kali                 # Processes by user
ps --forest                # Tree view
```

**Understanding ps aux output:**
```
USER    PID  %CPU %MEM    VSZ   RSS TTY   STAT START   TIME COMMAND
root      1   0.0  0.1  16912  7424 ?     Ss   10:00   0:01 /sbin/init
kali   1234   5.0  2.1 425684 86432 ?     Sl   10:05   1:23 /usr/bin/firefox
│        │     │    │      │     │  │      │
│        │     │    │      │     │  │      └── Status (S=sleeping,R=running)
│        │     │    │      │     │  └── Terminal (? = no terminal)
│        │     │    │      │     └── Resident memory (actual)
│        │     │    │      └── Virtual memory (allocated)
│        │     │    └── Memory percentage
│        │     └── CPU percentage
│        └── Process ID
└── Owner
```

**top / htop - Real-time monitoring:**
```bash
top                         # Interactive process viewer
htop                        # Better interactive viewer
```

**Top keyboard shortcuts:**
| Key | Action |
|-----|--------|
| q | Quit |
| k | Kill process (asks for PID) |
| M | Sort by memory |
| P | Sort by CPU |
| u | Filter by user |

### Process Control

**kill - Send signals to processes:**
```bash
kill PID                    # Send SIGTERM (polite shutdown)
kill -9 PID                 # Send SIGKILL (forced kill)
kill -STOP PID              # Pause process
kill -CONT PID              # Resume paused process
killall processname         # Kill by name
```

**Common signals:**

| Signal | Number | Purpose |
|--------|--------|---------|
| SIGTERM | 15 | Polite termination request |
| SIGKILL | 9 | Force kill (cannot be ignored) |
| SIGSTOP | 19 | Pause execution |
| SIGCONT | 18 | Resume execution |
| SIGHUP | 1 | Reload configuration |

**Background and foreground:**
```bash
command &                   # Run in background
bg                         # Send stopped job to background
fg                         # Bring to foreground
jobs                       # List background jobs
nohup command &            # Run even after logout
```

### File Viewing

**cat - Concatenate and display:**
```bash
cat file.txt                # Display entire file
cat file1 file2 > combined  # Combine files
```

**less - Paged viewing:**
```bash
less file.txt               # View with navigation
# Space = next page, b = back, / = search, q = quit
```

**head / tail - Beginning or end:**
```bash
head file.txt               # First 10 lines
head -n 20 file.txt         # First 20 lines
tail file.txt               # Last 10 lines
tail -f /var/log/syslog     # Follow log in real-time
```

---

## 3. Guided Practice

### Exercise 1: File Operations

```bash
cd ~
mkdir -p lab/subdir1/subdir2
touch lab/file1.txt lab/file2.txt

# Copy operations
cp lab/file1.txt lab/file1_backup.txt
cp -r lab lab_backup

# Move and rename
mv lab/file2.txt lab/renamed.txt

# Verify structure
ls -laR lab

# Cleanup
rm -rf lab lab_backup
```

### Exercise 2: Find Important Files

```bash
# Find all password files
find /etc -name "*passwd*" 2>/dev/null

# Find SUID binaries
find / -perm -4000 -type f 2>/dev/null | head -20

# Find files modified in last hour
find /var -mmin -60 -type f 2>/dev/null | head -20

# Find world-writable directories
find / -perm -o+w -type d 2>/dev/null | head -20
```

### Exercise 3: Process Control

```bash
# Start a background process
sleep 1000 &
echo "Started sleep, PID: $!"

# View it
ps aux | grep sleep

# Stop it
kill -STOP $!
ps aux | grep sleep  # Note 'T' status

# Resume it
kill -CONT $!

# Kill it
kill $!
```

---

## 4. Reflection Check

### File Operations
1. What's the difference between `cp -r` and `mv` for directories?

2. You accidentally delete /home/kali. Your colleague says "check the trash." Why are they wrong?

3. Why is `rm -rf /` more destructive than `rm -rf ~`?

### Process Control
1. A process isn't responding to `kill PID`. What do you try next?

2. You're running a long scan and need to close the terminal. How do you ensure it continues?

3. You want to find all processes belonging to user www-data. How?

---

## 5. Key Misconceptions

**MYTH: "rm deletes files permanently"**
REALITY: rm removes the directory entry. Data may be recoverable with forensic tools until overwritten.

**MYTH: "kill always works"**
REALITY: Regular kill sends SIGTERM, which processes can ignore. SIGKILL (-9) cannot be ignored but doesn't allow cleanup.

**MYTH: "find is slow, use locate"**
REALITY: find searches in real-time (current state). locate uses a database (may be outdated). Both have uses.

**MYTH: "Background processes with & survive logout"**
REALITY: Background processes get SIGHUP on logout. Use `nohup` or `disown` for persistence.

**MYTH: "PID 1 can be killed"**
REALITY: PID 1 is special (init). Killing it crashes the system.

---

## 6. Completion Criteria

This module is complete when you can:

1. **Create** files and directory structures efficiently
2. **Copy, move, and rename** files and directories
3. **Delete** carefully with awareness of rm dangers
4. **Find** files using find with various criteria
5. **Monitor and control** processes with ps, top, and kill

---

## 7. Further Depth (Optional)

*   **Practice:** Write a script that creates a test directory structure, finds files, then cleans up
*   **Research:** Study all signals (man 7 signal)
*   **Challenge:** Find the 10 largest files on your system
*   **Exploration:** Learn about process priorities (nice, renice)
