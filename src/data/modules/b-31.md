# SIEM Architecture & Log Engineering

## 1. Orientation

### What this module covers
A Security Information and Event Management (SIEM) system is the central brain of the SOC. It aggregates logs from everywhere. This module covers **Ingestion**, **Normalization**, and **Retention**.

### Learning Objectives
*   Design a **Logging Pipeline** (Shipper -> Buffer -> Indexer -> Search Head).
*   Understand **Normalization** (CIM/ECS).
*   Calculate **EPS** (Events Per Second) and storage costs.

---

## 2. Core Content

### The Pipeline
1.  **Generation:** The App/Firewall creates the log.
2.  **Collection (Shipper):** Fluentd/Logstash/Splunk UF reads the log.
3.  **Buffering:** Kafka/Redis queues the logs (to prevent data loss during spikes).
4.  **Indexing:** The SIEM parses and stores the text for searching.

### Normalization (The Babel Fish)
Every vendor formats logs differently.
*   *Cisco firewall:* `src_ip=1.2.3.4`
*   *Windows Event:* `SourceAddress=1.2.3.4`
*   *Problem:* You can't search consistently.
*   *Solution:* **Common Information Model (CIM)**. Rename all fields to `src_ip` at ingest time. Now one query searches Windows, Linux, and Cisco simultaneously.

### Storage Tiers
*   **Hot:** SSD. Searchable in milliseconds. Expensive. Keep for 30 days.
*   **Warm:** HDD. Searchable. Keep for 90 days.
*   **Cold:** Archived/Tape. Not immediately searchable. Keep for Compliance (1-7 years).

---

## 3. Lab: The Parser

### Scenario
Raw Log: `2024-01-01 Failed login for user admin from 10.0.0.1`

**Goal:** Extract fields.

**Regex (Splunk Style):**
`^\d{4}-\d{2}-\d{2}\s(?<action>.*)\sfor user\s(?<user>\w+)\sfrom\s(?<src_ip>[\d\.]+)`

**Normalized Output:**
{
  "action": "Failed login",
  "user": "admin",
  "src_ip": "10.0.0.1"
}

---

## 4. Reflection
1.  Why is "Timestamp Parsing" the most critical step? (If the SIEM guesses the wrong year or timezone, your logs might appear in the future or past, making correlation impossible).
2.  What is "Filter at Source"? (Dropping useless debug logs at the agent level to save network bandwidth and storage license costs).
