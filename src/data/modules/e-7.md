# Passive Reconnaissance Techniques

## 1. Orientation

### What this module covers
This module covers the practical techniques and tools for passive reconnaissance—gathering information about targets without touching their infrastructure. We focus on WHOIS, DNS enumeration, certificate transparency, search engine dorking, and OSINT frameworks that reveal what organizations try to hide.

### Fit in the Learning Path
Before you can scan a target, you need to know what to scan. Organizations have thousands of subdomains, IP ranges, and shadow IT assets. Passive recon finds them without alerting anyone.

### Learning Objectives
By the end of this module, you will:
*   Extract useful information from WHOIS records
*   Enumerate subdomains using multiple passive sources
*   Use certificate transparency logs effectively
*   Apply Google dorking for reconnaissance
*   Leverage Shodan and similar services

---

## 2. Core Content

### Mental Model: The Information Ecosystem

**How professionals think about this:**
Organizations leak information constantly—through DNS records, SSL certificates, job postings, code repositories, and public filings. A skilled investigator knows where to look and how to connect the dots.

```
PASSIVE DATA SOURCES:

                     ┌──────────────────┐
                     │     TARGET       │
                     │   ORGANIZATION   │
                     └────────┬─────────┘
                              │
          ┌───────────────────┼───────────────────┐
          │                   │                   │
          ▼                   ▼                   ▼
   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
   │   DNS &     │    │  SSL/TLS    │    │   Public    │
   │   WHOIS     │    │   Certs     │    │   Records   │
   └─────────────┘    └─────────────┘    └─────────────┘
          │                   │                   │
          ▼                   ▼                   ▼
   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
   │   Search    │    │   Code      │    │   Social    │
   │   Engines   │    │   Repos     │    │   Media     │
   └─────────────┘    └─────────────┘    └─────────────┘
          │                   │                   │
          └───────────────────┼───────────────────┘
                              │
                              ▼
                     ┌──────────────────┐
                     │   INTELLIGENCE   │
                     │   PICTURE        │
                     └──────────────────┘
```

### WHOIS Analysis

**What WHOIS reveals:**

| Field | Intelligence Value |
|-------|-------------------|
| **Registrant** | Organization name (often hidden now) |
| **Admin Contact** | Email, phone (often privacy-protected) |
| **Tech Contact** | IT team details |
| **Name Servers** | DNS infrastructure, hosting provider |
| **Creation Date** | How long domain has existed |
| **Registrar** | Where domain is registered |
| **Status** | Lock states, transfer status |

**WHOIS commands:**
```bash
# Basic WHOIS lookup
whois example.com

# Reverse WHOIS (find domains by registrant)
# Use tools like Reverse WHOIS services

# Historical WHOIS (see past records)
# Services: DomainTools, WhoisHistory
```

**The GDPR impact:**
Since 2018, European registrars often hide personal information. Historical WHOIS databases are valuable for seeing what was exposed before.

### DNS Enumeration

**DNS record types for recon:**

| Record | Contains | Intelligence Use |
|--------|---------|------------------|
| **A** | IP address | Identify hosting |
| **AAAA** | IPv6 address | Additional IP space |
| **MX** | Mail servers | Email infrastructure |
| **NS** | Name servers | DNS infrastructure |
| **TXT** | Text records | SPF, DKIM, verification secrets |
| **CNAME** | Aliases | Subdomain relationships |
| **SOA** | Zone info | DNS admin details |

**Subdomain enumeration sources:**

```
PASSIVE SUBDOMAIN SOURCES:

1. CERTIFICATE TRANSPARENCY
   └── crt.sh, certspotter, censys
   └── Every SSL cert is logged publicly

2. DNS AGGREGATORS  
   └── DNSDumpster, VirusTotal, RapidDNS
   └── Collect DNS data from various sources

3. SEARCH ENGINES
   └── Google: site:example.com -www
   └── Index pages reveal subdomains

4. WEB ARCHIVES
   └── Wayback Machine, Common Crawl
   └── Historical pages reference subdomains

5. SECURITY SCANNERS
   └── Shodan, Censys, BinaryEdge
   └── Already scanned and indexed services
```

**Practical subdomain enumeration:**
```bash
# Using crt.sh
curl -s "https://crt.sh/?q=%.example.com&output=json" | \
  jq -r '.[].name_value' | sort -u

# Using subfinder
subfinder -d example.com -silent

# Using amass (passive mode)
amass enum -passive -d example.com

# Using theHarvester
theHarvester -d example.com -b google,linkedin
```

### Certificate Transparency

**How CT logs work:**

All Certificate Authorities must log certificates they issue to public CT logs. This was designed for security (detect rogue certs) but is excellent for recon.

```
CERTIFICATE ISSUANCE → CT LOG → PUBLICLY SEARCHABLE

Company gets SSL cert for:
  - secure.internal.company.com
  - dev-api.company.com
  - staging-admin.company.com

All become publicly visible, even if:
  - Sites are not public
  - No DNS resolution
  - Behind firewalls
```

**Using crt.sh:**
```
URL: https://crt.sh/?q=%.example.com

FINDINGS:
├── www.example.com
├── mail.example.com
├── vpn.example.com ← Interesting!
├── dev.example.com ← Interesting!
├── staging-internal.example.com ← Very interesting!
└── kubernetes-prod.example.com ← Very interesting!
```

### Google Dorking

**Advanced search operators for reconnaissance:**

| Operator | Purpose | Example |
|----------|---------|---------|
| `site:` | Limit to domain | `site:example.com` |
| `filetype:` | Find specific files | `filetype:pdf site:example.com` |
| `intitle:` | Title contains | `intitle:"index of" site:example.com` |
| `inurl:` | URL contains | `inurl:admin site:example.com` |
| `cache:` | Cached version | `cache:example.com` |
| `-` | Exclude | `site:example.com -www` |
| `"..."` | Exact phrase | `"password" filetype:txt` |

**Useful dork combinations:**

```
Finding exposed files:
  site:example.com filetype:sql
  site:example.com filetype:env
  site:example.com filetype:log
  site:example.com filetype:bak

Finding directories:
  site:example.com intitle:"index of"
  site:example.com intitle:"directory listing"

Finding credentials:
  site:example.com password filetype:txt
  site:example.com "api_key" OR "apikey" filetype:json

Finding admin panels:
  site:example.com inurl:admin
  site:example.com inurl:login
  site:example.com intitle:"admin panel"

Finding vulnerable pages:
  site:example.com inurl:php?id=
  site:example.com "error" OR "warning" filetype:php
```

### Shodan and Internet-Wide Scans

**Shodan queries:**

```
# Basic search
hostname:example.com

# Organizations
org:"Example Company"

# Specific services
hostname:example.com port:22
hostname:example.com product:nginx

# Geographic
country:US city:"New York" org:"Example"

# Vulnerabilities (Shodan scans for common CVEs)
hostname:example.com vuln:CVE-2021-44228

# Screenshots (visual services)
hostname:example.com has_screenshot:true
```

**Similar services:**

| Service | Specialty |
|---------|-----------|
| **Shodan** | IoT, services, banners |
| **Censys** | Certificates, services |
| **BinaryEdge** | Services, data leaks |
| **ZoomEye** | Chinese perspective |
| **Greynoise** | What's scanning the internet |

### Email and Employee Enumeration

**Finding email addresses:**
```bash
# theHarvester
theHarvester -d example.com -b google,linkedin,twitter

# hunter.io (requires account)
# Shows email patterns and verified addresses

# LinkedIn research
# Manually find employees, derive email format
```

**Email format discovery:**
If you know one email (from a data breach or job posting), you know the format:
- john.smith@example.com → firstname.lastname
- jsmith@example.com → firstinitiallastname

### Data Breach Research

**Checking if target appears in breaches:**

| Service | Purpose |
|---------|---------|
| **Have I Been Pwned** | Check if emails in breaches |
| **DeHashed** | Search breach databases |
| **IntelX** | Intelligence database |

**Credential research (ethical considerations):**
- Knowing IF credentials were leaked is legitimate recon
- Using actual leaked credentials without authorization is illegal
- Report found credentials to client as vulnerability

### OSINT Frameworks

**Comprehensive OSINT tools:**

| Tool | Capability |
|------|------------|
| **Maltego** | Visual link analysis |
| **Recon-ng** | Modular reconnaissance |
| **SpiderFoot** | Automated OSINT collection |
| **OSINT Framework** | Web-based resource directory |

```bash
# Recon-ng example workflow
recon-ng
workspaces create targetCo
modules load recon/domains-hosts/certificate_transparency
options set SOURCE example.com
run
```

---

## 3. Guided Practice

### Exercise 1: WHOIS Analysis

```bash
whois google.com
```

Record findings:
- Registrar: ___
- Name Servers: ___
- Creation Date: ___
- What's hidden by privacy protection? ___

### Exercise 2: Certificate Transparency

Go to https://crt.sh and search for `%.tesla.com`

Record findings:
- Number of certificates found: ___
- Interesting subdomains discovered: 
  1. ___
  2. ___
  3. ___
- Any subdomains suggesting internal services? ___

### Exercise 3: Google Dorking

Construct dorks to find:

| Goal | Your Dork |
|------|-----------|
| PDF files on target domain | ___ |
| Subdomains excluding www | ___ |
| Exposed directory listings | ___ |
| Pages with "password" in title | ___ |

---

## 4. Reflection Check

### Technique Understanding
1. Why do CT logs reveal "secret" subdomains? Isn't that a design flaw?

2. A company's WHOIS shows privacy protection. Does that mean you've learned nothing?

3. Why might historical WHOIS data be more valuable than current WHOIS data?

### Practical Application
1. You find a subdomain `dev-api.company.com` in CT logs, but it doesn't resolve in DNS. Is it useful?

2. A Google dork reveals `site:company.com filetype:env` returns results. What have you found?

3. Shodan shows the target has 50 hosts on port 22. What's your next step?

---

## 5. Key Misconceptions

**MYTH: "WHOIS is useless now due to privacy"**
REALITY: WHOIS still reveals name servers, registrar, and sometimes partial info. Historical WHOIS databases are invaluable.

**MYTH: "CT logs only show public websites"**
REALITY: CT logs show ALL certificates, including internal subdomains that shouldn't be public.

**MYTH: "Google finds everything"**
REALITY: Google only indexes visible, linkable content. Much organizational data is not indexed.

**MYTH: "Shodan is illegal to use"**
REALITY: Shodan's data is publicly accessible. Querying Shodan is passive recon—entirely legal.

**MYTH: "Subdomain enumeration is hacking"**
REALITY: DNS records are public. Querying public sources is research, not hacking.

---

## 6. Completion Criteria

This module is complete when you can:

1. **Extract** intelligence from WHOIS records
2. **Enumerate** subdomains using multiple passive sources
3. **Use** certificate transparency logs via crt.sh
4. **Construct** effective Google dorks for reconnaissance
5. **Query** Shodan for service and host information

---

## 7. Further Depth (Optional)

*   **Practice:** Enumerate a bug bounty target using only passive sources
*   **Tools:** Set up and master Recon-ng or SpiderFoot
*   **Resource:** Study the OSINT Framework (osintframework.com)
*   **Advanced:** Learn to use Maltego for link analysis
