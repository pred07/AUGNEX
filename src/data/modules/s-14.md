# Indicators of Compromise (IOCs) vs TTPs

## 1. Orientation

### What this module covers
This module moves beyond the basic definition of an IOC. We analyze the **operational lifespan** of indicators, the **engineering costs** of detection at different levels, and the strategic pivot to TTP-based defense. You will learn to evaluate indicators not just by their type, but by their **utility** and **robustness** in a hostile environment.

### Fit in the Learning Path
As a Sentinel, your job is to feed the defense. If you feed the SOC expired domains (Level 1), you generate noise. If you feed them behavioral signatures (Level 6), you generate immunity. This module connects "Intel" to "Engineering."

### Learning Objectives
*   Master the **Pyramid of Pain** from an attacker's cost-benefit perspective.
*   Distinguish between **Atomic**, **Computed**, and **Behavioral** indicators.
*   Understand **IOC Decay** and why static lists fail.
*   Map a real-world campaign to the Pyramid spectrum.

---

## 2. Core Content

### The Engineering Reality of the Pyramid of Pain

David Biancoâ€™s *Pyramid of Pain* explains the difficulty for an *attacker* to change their potential indicators. As a defender, you must inversely map this to the *stability* of your detections.

| Layer | Indicator Type | Attacker Cost | Detection Stability | Shelf Life |
| :--- | :--- | :--- | :--- | :--- |
| **Top** | **TTPs** | **High** (Re-training required) | **Permanent** (Until tradecraft evolves) | Years |
| 5 | **Tools** | High (Dev/Procurement) | Long (Until code obfuscation) | Months/Years |
| 4 | **Network/Host Artifacts** | Medium (Config changes) | Medium (Until re-config) | Weeks/Months |
| 3 | **Domain Names** | Low (New Reg/DGA) | Short (Days/Hours) | Days |
| 2 | **IP Addresses** | Low (Proxy Rotation) | Very Short (Minutes) | Hours |
| **Base** | **Hash Values** | **Trivial** (Re-compile) | **Instant** (Single use) | Seconds |

### 1. The Base: Hash Values (MD5, SHA256)
*   **Engineering View:** Exact string matching. Extremely fast for EDR/SIEM ($O(1)$ complexity).
*   **Analyst Reality:** A hash is a unique identifier for a *specific build* of a file.
*   **The Problem:** Polymorphism. A single bit change alters the hash. Attackers automate this.
*   **Verdict:** Great for *forensics* (identifying what hit you), useless for *prevention* (stopping what's coming).

### 2. The Churn: IP Addresses & Domains
*   **Engineering View:** Network filtering, DNS sinkholing.
*   **Operational Risk:** C2 infrastructure is ephemeral. Fast Flux DNS and Domain Generation Algorithms (DGA) make static blacklisting obsolete.
*   **Shared Infrastructure:** Attackers use Cloudflare, AWS, or compromised WordPress sites. Blocking an IP might block legitimate business traffic (Collateral Damage).
*   **Verdict:** Necessary for containment, but high maintenance (decay rate is high).

### 3. The Pivot: Network & Host Artifacts
*   **The Shift:** Here we move from "what they use" to "what they leave behind."
*   **Network:** Distinctive User-Agent strings, specific SSL certificate serial numbers (JARM fingerprinting), non-standard beacon intervals (jitter).
*   **Host:** Registry keys created for persistence, mutex names, specific file paths `C:\ProgramData\Updater\bad.exe`.
*   **Verdict:** High operational value. Forces the attacker to change their configuration.

### 4. The Apex: Tools & TTPs (Tactics, Techniques, Procedures)
*   **Tools:** Mimikatz, Cobalt Strike, BloodHound. Even if they change the Hash, the *functionality* remains (e.g., injecting into `lsass.exe`).
*   **TTPs:** The *behavior*. "Spearphishing with Link" -> "PowerShell Execution" -> "C2 Beacon".
*   **Detection:** "Process A launching Process B with Arguments C".
    *   *Example:* Word (`winword.exe`) spawning PowerShell (`powershell.exe`). This is a **behavior**. It doesn't matter what IP they use, what hash the doc has, or what the domain is. The *behavior* is malicious.
*   **Verdict:** Defense in Depth. Catching the TTP breaks the entire campaign, regardless of the disposable infrastructure.

---

## 3. Advanced Concepts: Indicator Lifecycle

### The Half-Life of Intelligence
Indicators rot. An IP address used by APT29 today might be released back to the ISP pool and assigned to a coffee shop tomorrow.

**IOC Scoring Model (Example):**
1.  **Confidence:** How sure are we? (High/Med/Low)
2.  **Severity:** What is the impact? (Critical/High/Med)
3.  **Expiry:** When does this die?
    *   *IPs:* 24-48 hours defaults.
    *   *Domains:* 30 days.
    *   *Hashes:* Perpetual (but limited value).

**Pro Tip:** Never ingest a "Feed" directly into a Blocklist without an **Age-Out Policy**. You will break the network.

---

## 4. Lab: Deconstructing a Campaign

### Scenario: The "Invoice" Campaign
**Intel Report:** "Actor sends phishing emails with `Invoice.zip`. Inside is `Invoice.exe` (Hancitor). It beacons to `badgit[.]com` and downloads Cobalt Strike."

### Task: Extract & Classify
Map the extracted intelligence to the Pyramid layers.

| Indicator | Extracted Data | Layer | Durability |
| :--- | :--- | :--- | :--- |
| **Hash** | `a1b2...9f` (The .exe file) | Base | **None.** New build every hour. |
| **Domain** | `badgit[.]com` | Level 3 | **Low.** They will register `badgit2[.]com`. |
| **Artifact** | URI Pattern `/api/submit.php?id=` | Level 4 | **Med.** Hardcoded in the C2 config. |
| **Tool** | Cobalt Strike (Beacon payload) | Level 5 | **High.** Detecting the beacon's memory structure. |
| **TTP** | Phishing -> Zip -> Exe Execution | Top | **Max.** Detecting `.zip` files containing `.exe`. |

### Reflection
If you only blocked the Hash, you stopped **one user** from opening **one file**.
If you blocked `*.zip` attachments containing `.exe` files (TTP), you stopped **the entire campaign** globally.

---

## 5. Analyst Tradecraft

### How to write "High Value" Intel
Don't just dump a CSV of IPs. Contextualize.

**Bad Intel:**
> "Block these 500 IPs. They are malicious."

**Good Intel:**
> "We are tracking a campaign targeting Finance. They use a specific URI pattern (`/admin/login.php`) on compromised WordPress sites.
> **Immediate Action:** Block the URI pattern (Artifact).
> **Secondary Action:** Hunt for `winword.exe` spawning `powershell.exe` (TTP).
> **Reference:** Attached list of 500 IPs (Low confidence, rapid decay)."

---

## 6. Completion Criteria & Self-Assessment
1.  **Can you explain** why a TTP is harder to change than a Domain? (Requires new skills/procedure vs just money).
2.  **Can you define** "IOC Decay"?
3.  **Differentiation:** Why is JARM fingerprinting (TLS) considered an Artifact, while the IP address is just atomic? (JARM relies on the server configuration).

---

## 7. Further Research
*   **Read:** "The Pyramid of Pain" - David Bianco (Original Blog Post).
*   **Tool:** Look up **JARM** fingerprinting on GitHub.
*   **Practice:** Take a public malware sandbox report (e.g., Any.Run) and strip out the IOCs into layers.
