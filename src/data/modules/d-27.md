# Writing Detection Rules (Sigma, YARA)

## 1. Orientation

### What this module covers
This module teaches you to write the logic that triggers alerts. We cover **Sigma** (Log rules) and **YARA** (File rules).

### Fit in the Learning Path
A SIEM without rules is just a library. Rules turn it into a burglar alarm.

### Learning Objectives
By the end of this module, you should understand:
*   **Sigma**: The universal format for log queries.
*   **YARA**: Pattern matching for files.
*   **IoC** (Indicator of Compromise).

---

## 2. Core Content

### Sigma
"Write once, deploy everywhere."
*   You write a rule in YAML.
*   Sigma converts it to Splunk SPL, Elastic DSL, or QRadar AQL.
*   *Example*: "Detect Process Creation of `whoami.exe` by `SYSTEM` user."

### YARA
"Regex on steroids for files."
*   Used to scan disk/memory for malware patterns (strings, hex bytes).
*   *Example*: "Find any file containing the hex string `E2 34 A1` AND the string `hack_the_planet`."

---

## 3. Guided Practice

### Anatomy of a Sigma Rule
```yaml
title: Whoami Execution
status: experimental
logsource:
    category: process_creation
    product: windows
detection:
    selection:
        Image|endswith: '\whoami.exe'
    condition: selection
```
**Translation**:
If a process is created AND the name ends with `whoami.exe` -> ALERT.

---

## 4. Reflection Check

1.  **Sharing**: Why is Sigma revolutionary? (It allows the community to share detections on GitHub regardless of what SIEM they use).
2.  **Specificity**: Why is `Image=whoami.exe` weaker than `Hash=...`? (Because I can rename `whoami.exe`).
3.  **Tuning**: Why mark rules as "Experimental"? (To test them without waking up the SOC at 3am with false positives).

---

## 5. Completion Criteria

This module is complete when:
1.  You understand that **Sigma** is for Logs, **YARA** is for Files.
2.  You can read a YAML Sigma rule.
3.  You participate in the "Detection as Code" mindset.
