# Detecting Suspicious Network Activity

## 1. Unit Brief: Hunting Anomalies
Applying the previous concepts to spot actual attacks: Scans, Beacons, and Exfiltration.

## 2. Real-World Relevance
Catching the "Scan" gives you hours of warning before the "Exploit". Catching the "Beacon" stops the "Ransomware".

## 3. Core Concepts

### Scan Detection
*   **Vertical Scan**: One IP, Many Ports. (Mapping a server).
*   **Horizontal Scan**: One Port, Many IPs. (Finding all SQL servers).
*   **Detection**: Single source IP connecting to > 10 distinct hosts in 1 minute.

### Beacon Detection (C2)
*   **Jitter**: Malware adds randomness to sleep times (Sleep 60s +/- 10%).
*   **Long Connections**: "Why has this TCP session been open for 4 days?"

### User-Agent Analysis
*   **Normal**: `Mozilla/5.0 ... Chrome/90.0`
*   **Suspicious**: `Python-urllib/2.7` or `curl/7.6` coming from a User Laptop. (Users don't use curl).

## 4. Practical Examples

### JA3 Fingerprinting
A method to fingerprint the SSL Client Hello packet.
*   Even if traffic is encrypted, the *way* the client initiates the handshake is unique.
*   **Malware**: Has a specific JA3 hash.
*   **Action**: Block JA3 hash at firewall.

### DNS Tunneling
Encapsulating data inside DNS requests.
*   `query: secret-password-part1.attacker.com`
*   `query: secret-password-part2.attacker.com`
*   **Detection**: High volume of long subdomains to a rarely seen domain.

## 5. Common Mistakes Beginners Make
*   **Ignoring DNS**: DNS is often allowed through the firewall unfiltered. Hackers love it.
*   **Trusting Port 443**: "It's HTTPS, it's safe." Malware uses HTTPS too.

## 6. Key Takeaways
*   **Look at the Meta-Data**: You don't need to decrypt the packet to know it's evil. Size, Timing, and Frequency tell the story.
