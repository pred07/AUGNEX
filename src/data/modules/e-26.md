# File Upload and File Inclusion Vulnerabilities

## 1. Unit Brief: Uploading a Shell
If a site lets you upload a profile picture, can you upload a PHP script? If yes, you own the server (RCE). File Inclusion (LFI/RFI) allows you to trick the web app into running files it shouldn't.

## 2. Real-World Relevance
*   **Upload**: Getting a Web Shell (`c99.php`).
*   **LFI**: Reading `/etc/passwd` or configuration keys.
*   **RFI**: Hosting a shell on your server and telling the victim server to execute it.

## 3. Core Concepts

### Content-Type Spoofing
Server checks: "Is the Content-Type `image/jpeg`?"
*   **Attack**: Upload `shell.php`. Intercept in Burp. Change `Content-Type: application/php` to `image/jpeg`.
*   **Result**: Bypass.

### Path Traversal (LFI)
The app loads a language file: `include($_GET['lang'] + '.php')`
*   Input: `../../../../etc/passwd%00`
*   Result: The server climbs up the directory tree and reads the password file.

## 4. Practical Examples

### The Double Extension
Server blocks `.php`.
*   Try: `shell.php.jpg` (Apache sometimes executes the first known extension).
*   Try: `shell.php5`, `shell.phtml`.

### Log Poisoning to RCE (LFI)
1.  You have LFI but can only read files.
2.  Send a User-Agent: `<?php system($_GET['c']); ?>`.
3.  This string is saved in `/var/log/apache2/access.log`.
4.  Use LFI to include the log file: `?page=../../var/log/apache2/access.log`.
5.  **Result**: Your PHP code in the log file executes.

## 5. Common Mistakes Beginners Make
*   **Not finding the upload path**: You uploaded the shell, but where is it? You need to fuzz the `/uploads` directory or check the image URL.
*   **LFI wrapper confusion**: Using `php://filter` to read source code vs executing it.

## 6. Key Takeaways
*   **Uploads are dangerous**: The server is literally writing user input to the disk.
*   **RCE is the Goal**: Turning file access into command execution.
