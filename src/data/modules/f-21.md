# IP Addressing, Ports, and Protocols

## 1. Orientation

### What this module covers
This module covers the addressing fundamentals of networking—IP addresses identify machines, ports identify services, and protocols define how they communicate. This knowledge is essential for reconnaissance, scanning, and understanding network traffic.

### Fit in the Learning Path
Every network security activity involves IP addresses and ports. Nmap scans target IPs and ports. Firewalls filter by IP and port. Understanding this addressing system is the foundation of network security.

### Learning Objectives
By the end of this module, you will:
*   Understand IPv4 and IPv6 addressing
*   Calculate subnet masks and CIDR notation
*   Identify common ports and their services
*   Differentiate between TCP and UDP

---

## 2. Core Content

### Mental Model: The House Analogy

**How professionals think about this:**
An IP address is like a street address—it gets you to the right building. A port is like an apartment number—it gets you to the right service inside that building. The protocol is the language you speak when someone answers the door.

```
ADDRESSING ANALOGY:

IP Address = Street Address
"123 Main Street" = "192.168.1.100"
Gets you to the right building (machine)

Port = Apartment Number
"Apt 22" = "Port 22"
Gets you to the right service (SSH)

Protocol = Language
"English" = "TCP"
How you communicate

FULL ADDRESS:
192.168.1.100:22 (TCP)
"Machine at 192.168.1.100, service listening on port 22, speaking TCP"
```

### IPv4 Addressing

**32-bit addressing scheme:**

```
IPv4 STRUCTURE:

Written: 192.168.1.100
Binary:  11000000.10101000.00000001.01100100
         └─ 8 bits ─┘└─ 8 bits ─┘└─ 8 bits ─┘└─ 8 bits ─┘
         
Each octet: 0-255 (2^8 = 256 values)
Total addresses: 2^32 = ~4.3 billion

SPECIAL ADDRESSES:
─────────────────────────────
0.0.0.0        All interfaces / Default route
127.0.0.1      Localhost (loopback)
255.255.255.255 Broadcast (all hosts)
*.*.*.0        Network address (first in subnet)
*.*.*.255      Broadcast address (last in subnet, for /24)
```

**Private vs Public addresses:**

| Type | Range | Usage |
|------|-------|-------|
| **Private Class A** | 10.0.0.0 - 10.255.255.255 | Large enterprises |
| **Private Class B** | 172.16.0.0 - 172.31.255.255 | Medium networks |
| **Private Class C** | 192.168.0.0 - 192.168.255.255 | Home/small office |
| **Public** | All other routable addresses | Internet-accessible |
| **APIPA** | 169.254.0.0 - 169.254.255.255 | Auto-configured (no DHCP) |

### Subnetting and CIDR

**Dividing networks:**

```
SUBNET MASK CONCEPT:

IP: 192.168.1.100
Mask: 255.255.255.0 (or /24)

Network portion: 192.168.1.___  (first 24 bits)
Host portion:    ___.___.___.100 (last 8 bits)

CIDR NOTATION:
192.168.1.0/24
└── /24 means first 24 bits are network

COMMON SUBNET MASKS:
─────────────────────────────
/8   = 255.0.0.0       = 16,777,214 hosts
/16  = 255.255.0.0     = 65,534 hosts
/24  = 255.255.255.0   = 254 hosts
/25  = 255.255.255.128 = 126 hosts
/26  = 255.255.255.192 = 62 hosts
/27  = 255.255.255.224 = 30 hosts
/28  = 255.255.255.240 = 14 hosts
/29  = 255.255.255.248 = 6 hosts
/30  = 255.255.255.252 = 2 hosts (point-to-point)
/32  = 255.255.255.255 = 1 host (single IP)

SECURITY APPLICATION:
─────────────────────────────
Firewall rule: Allow 10.0.0.0/8
Means: Allow any IP starting with 10.*.*.*
```

### IPv6 Addressing

**128-bit addressing:**

```
IPv6 STRUCTURE:

Written: 2001:0db8:85a3:0000:0000:8a2e:0370:7334
         └─────┘:└───┘:└───┘:└───┘:└───┘:└───┘:└───┘:└───┘
         8 groups of 16 bits (4 hex digits each)

SHORTHAND:
2001:0db8:0000:0000:0000:0000:0000:0001
→ 2001:db8:0:0:0:0:0:1
→ 2001:db8::1

SPECIAL ADDRESSES:
─────────────────────────────
::1            Localhost (like 127.0.0.1)
::             All zeros
fe80::/10      Link-local (like APIPA)
fc00::/7       Unique local (like private)
ff00::/8       Multicast

SECURITY NOTE:
─────────────────────────────
IPv6 often enabled by default
May bypass IPv4-only firewalls
"Dual-stack" environments need protection for both
```

### Ports

**Application-level addressing:**

```
PORT RANGES:

0-1023:       Well-Known Ports (require root/admin)
1024-49151:   Registered Ports
49152-65535:  Dynamic/Ephemeral Ports (client-side)

CONNECTION EXAMPLE:
─────────────────────────────
Client: 192.168.1.50:54321 → Server: 93.184.216.34:443
        (Ephemeral port)              (Well-known HTTPS)
```

**Critical ports to know:**

| Port | Service | Protocol | Security Notes |
|------|---------|----------|----------------|
| 21 | FTP | TCP | Cleartext credentials |
| 22 | SSH | TCP | Secure remote access |
| 23 | Telnet | TCP | Cleartext, avoid |
| 25 | SMTP | TCP | Email sending |
| 53 | DNS | UDP/TCP | Name resolution |
| 80 | HTTP | TCP | Unencrypted web |
| 110 | POP3 | TCP | Email retrieval |
| 135 | RPC | TCP | Windows services |
| 139 | NetBIOS | TCP | Windows file sharing |
| 143 | IMAP | TCP | Email access |
| 443 | HTTPS | TCP | Encrypted web |
| 445 | SMB | TCP | Windows file sharing |
| 3306 | MySQL | TCP | Database |
| 3389 | RDP | TCP | Windows remote desktop |
| 5432 | PostgreSQL | TCP | Database |
| 5900 | VNC | TCP | Remote desktop |
| 8080 | HTTP-Alt | TCP | Common proxy/dev |

### TCP vs UDP

**Transport protocol comparison:**

```
TCP (Transmission Control Protocol):
─────────────────────────────
- Connection-oriented (handshake)
- Reliable (acknowledgments, retransmission)
- Ordered (packets arrive in sequence)
- Error-checked (checksums)
- Slower (overhead for reliability)

Use cases: Web, email, file transfer, SSH
Anything where data integrity matters

UDP (User Datagram Protocol):
─────────────────────────────
- Connectionless (no handshake)
- Unreliable (no acknowledgments)
- Unordered (packets may arrive out of order)
- Error-checked but no retransmission
- Faster (less overhead)

Use cases: Streaming, gaming, DNS, VoIP
Anything where speed matters more than perfection
```

**Security implications:**

| Aspect | TCP | UDP |
|--------|-----|-----|
| **Scanning** | SYN scan, connection scan | Harder (no response ≠ closed) |
| **Spoofing** | Harder (requires sequence) | Easier (no connection state) |
| **DoS** | SYN flood | UDP flood, amplification |
| **Firewall** | Stateful tracking works | Stateless often required |

### NAT (Network Address Translation)

**Address translation:**

```
NAT CONCEPT:

Private Network                          Internet
─────────────────                        ─────────
192.168.1.50 ─┐                          
192.168.1.51 ─┼── [NAT Router] ─── 203.0.113.5 ─── Internet
192.168.1.52 ─┘   72.16.1.1
                  
TRANSLATION:
192.168.1.50:54321 → 203.0.113.5:54321 → Internet
192.168.1.51:54322 → 203.0.113.5:54322 → Internet

NAT TYPES:
─────────────────────────────
SNAT: Source NAT (outbound, changes source)
DNAT: Destination NAT (inbound, port forwarding)
PAT:  Port Address Translation (many-to-one)

SECURITY IMPLICATIONS:
─────────────────────────────
- NAT provides weak security (not a firewall)
- Internal IPs hidden from internet
- Inbound connections need explicit forwarding
- NAT traversal techniques can bypass
```

---

## 3. Guided Practice

### Exercise 1: Port Identification

Match the port to the service:

| Port | Service |
|------|---------|
| 22 | ___ |
| 80 | ___ |
| 443 | ___ |
| 3389 | ___ |
| 25 | ___ |

### Exercise 2: Netstat Analysis

Run `netstat -an` and answer:

1. How many ports are LISTENING? ___
2. What port is your web browser using as source? ___
3. Is port 445 open? ___

### Exercise 3: Subnet Calculation

Given network 10.0.0.0/24:
1. How many host addresses? ___
2. Network address? ___
3. Broadcast address? ___
4. First usable host? ___
5. Last usable host? ___

---

## 4. Reflection Check

### Addressing Understanding
1. Two machines have same IP 192.168.1.50. Problem?

2. Server listens on 0.0.0.0:80. What does this mean?

3. Port 80 blocked but port 8080 open. Web still accessible?

### Protocol Understanding
1. Why does DNS use UDP primarily?

2. FTP uses port 21. Is FTP data also on port 21?

3. Source port 443, destination port 54321. Who is the server?

---

## 5. Key Misconceptions

**MYTH: "Private IPs are secure"**
REALITY: Private IPs are non-routable on internet, but accessible on local network. Not a security control.

**MYTH: "If port is closed, service doesn't exist"**
REALITY: Firewalls may block the port while service runs. Check from different locations.

**MYTH: "High ports are less important"**
REALITY: Any open port is attack surface. Malware often uses high ports to avoid detection.

**MYTH: "TCP is always better than UDP"**
REALITY: Each has trade-offs. UDP is appropriate for real-time applications.

**MYTH: "NAT provides security"**
REALITY: NAT is for address conservation. It provides some obscurity but is not a security control.

---

## 6. Completion Criteria

This module is complete when you can:

1. **Identify** public vs private IP ranges
2. **Calculate** subnet information from CIDR
3. **Match** common ports to services
4. **Explain** TCP vs UDP differences
5. **Analyze** netstat output for open ports

---

## 7. Further Depth (Optional)

*   **Practice:** Use Nmap to scan your local network
*   **Tool:** Explore Wireshark to see TCP handshakes
*   **Calculate:** Practice subnetting with online tools
*   **Lab:** Set up port forwarding on your router
