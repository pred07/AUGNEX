# Windows Internals for Pentesters

## 1. Unit Brief: Under the Hood of the Beast
To hack Windows, you must understand how it works. It's not just a GUI; it's a complex set of APIs, processes, and memory structures.

## 2. Real-World Relevance
*   **Malware**: Malware hides by injecting itself into legitimate processes (`svchost.exe`).
*   **Privilege Escalation**: Exploiting a driver requires understanding Kernel vs User mode.

## 3. Core Concepts

### Processes and Threads
*   **Process**: A container for resources.
*   **Thread**: The unit of execution.
*   **PID**: Process ID.
*   **Critical Processes**: `lsass.exe` (Handles auth), `svchost.exe` (Hosts services), `explorer.exe` ( The Desktop).

### The Registry
The database of configuration.
*   **HKLM**: Local Machine (System-wide).
*   **HKCU**: Current User (Per-user).
*   **Run Keys**: `HKCU\Software\Microsoft\Windows\CurrentVersion\Run`. Anything here starts at boot (Persistence).

### Permissions (ACLs)
*   **DACL**: Discretionary Access Control List (Who can access?).
*   **SACL**: System Access Control List (Audit logging).
*   **Tokens**: When you login, you get an Access Token. It contains your SIDs (Groups).

## 4. Practical Examples

### Service Binary Inspection
You see a service "Updater".
1.  Query Registry: `reg query HKLM\SYSTEM\CurrentControlSet\Services\Updater`
2.  Result: `ImagePath = C:\Program Files\Updater\upd.exe`
3.  Check Permissions: `icacls "C:\Program Files\Updater\upd.exe"`
4.  Result: `BUILTIN\Users: (F)` (Full Control).
5.  **Attack**: Replace `upd.exe` with a virus. Reboot. You are System.

## 5. Common Mistakes Beginners Make
*   **Killing LSASS**: If you kill `lsass.exe`, the computer reboots immediately. Be careful dumping memory.
*   **Ignoring PowerShell**: PowerShell gives you direct access to the .NET framework and Windows API. It is the most powerful tool on the OS.

## 6. Key Takeaways
*   **Everything is an Object**: Windows manages permissions via Security Descriptors.
*   **Admin != System**: SYSTEM is the kernel's user. It is higher than Admin.
