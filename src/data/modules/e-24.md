# Authentication Attacks and Logic Flaws

## 1. Orientation

### What this module covers
This module covers flaws in the *design* of authentication, not just the code. We look at **Logic Flaws** and **Race Conditions**.

### Fit in the Learning Path
Automated scanners suck at finding Logic Flaws. This is where the human hacker provides value.

### Learning Objectives
By the end of this module, you should understand:
*   **Business Logic Errors**.
*   **Race Conditions** (TOCTOU).
*   **2FA Bypass** via logic.

---

## 2. Core Content

### Logic Flaws
The code works "as written", but the logic is wrong.
*   **Example**: An e-commerce site.
    1.  Add item to cart ($100).
    2.  Go to checkout.
    3.  Open new tab, remove item from cart.
    4.  Click "Pay" on old tab.
    5.  Result: You pay $0 but the order processes.

### Race Conditions
Time-of-Check to Time-of-Use.
*   **Scenario**: Transfer Money.
    1.  Check Balance > $10.
    2.  Deduct $10.
    3.  Send $10.
*   **Attack**: Send 5 requests *simultaneously*.
    *   The threads all pass the "Check Balance" before the "Deduct" happens.
    *   Result: You send $50 while only having $10.

---

## 3. Guided Practice

### Identifying Logic Gaps
**Scenario**: Password Reset.
Flow:
1.  User enters Email.
2.  Server sends 4-digit code to Email.
3.  User enters code.
4.  User sets new password.

**Attack**:
At Step 3, Brute Force the 4-digit code (0000-9999).
*   *Defect*: If the server doesn't limit attempts, you can hijack any account in 10,000 requests.

### Coupon Code Logic
**Scenario**: "Use code NEWUSER for 10% off".
**Attack**: Apply the code. Remove the code. Apply the code again. Does it stack? Can I get 100% off?

---

## 4. Reflection Check

1.  **Multi-Threading**: Why is Burp Suite Intruder "Turbo" mode useful for Race Conditions? (It sends requests in parallel).
2.  **Assumption**: Developers assume users follow the steps 1-2-3. What do hackers do? (Step 1, Step 3, Step 2. Or Step 10 directly).
3.  **Complexity**: Why are logic bugs harder to fix? (Because they require rewriting the workflow, not just patching a line of code).

---

## 5. Completion Criteria

This module is complete when:
1.  You stop thinking in "Functions" and start thinking in "Flows".
2.  You understand that correct syntax does not mean correct security.
3.  You can describe a Race Condition example.
