# Authorization Attacks (IDOR and Access Control)

## 1. Unit Brief: You are Logged In, But Are You Allowed?
Authentication says "You are User A". Authorization says "User A can accessing Document B". When this check fails, you get Insecure Direct Object References (IDOR) or Broken Access Control.

## 2. Real-World Relevance
IDOR is the most common high-impact bug in modern APIs.
*   **Driver's License Leak**: `GET /api/license/12345`. Change to `12346`. View stranger's license.

## 3. Core Concepts

### IDOR (Insecure Direct Object Reference)
The server trusts the user input (ID) without checking ownership.
*   Object: The file/record (ID=100).
*   Direct: You ask for it by ID.
*   Insecure: No check.

### Vertical vs Horizontal Escalation
*   **Horizontal**: Accessing data of a peer (User A -> User B).
*   **Vertical**: Accessing data of a superior (User -> Admin).

## 4. Practical Examples

### The UUID Myth
Developers think "I use UUIDs (e.g., `550e8400...`), so IDOR is impossible because you can't guess them."
*   **Counter**: If the UUID leaks elsewhere (e.g., in a public profile URL), I can copy it and use it in the sensitive endpoint.

### Method Swap
*   `GET /admin/users` -> 403 Forbidden.
*   **Attack**: `POST /admin/users` or `HEAD /admin/users`.
*   Some frameworks apply access control only to specific HTTP methods.

## 5. Common Mistakes Beginners Make
*   **Testing with one account**: You need TWO accounts to test IDOR.
    1.  Log in as User A. Get ID of Resource A.
    2.  Log in as User B. Try to access Resource A.
*   **Assuming 403 is final**: Try header injection (`X-Original-URL`) to bypass.

## 6. Key Takeaways
*   **Test Every ID**: User ID, Order ID, Invoice ID, File ID.
*   **Always have 2 Users**: The "Attacker" and the "Victim".
