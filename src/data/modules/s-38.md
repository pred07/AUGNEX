# SOAR for CTI: Automating Action

## 1. Orientation

### What this module covers
Collecting Intel is useless if you don't act on it. SOAR (Security Orchestration, Automation, and Response) connects your TIP (MISP) to your Defenses (Firewall). This module covers **Playbooks** and **APIs**.

### Learning Objectives
*   Design a **Phishing Triage Playbook**.
*   Automate **IOC Blocking**.
*   Understand the "Human in the Loop" requirement.

---

## 2. Core Content

### The Workflow
1.  **Trigger:** New Event in MISP (Tag: `High Confidence`).
2.  **Action 1 (Enrich):** Query VirusTotal. Score > 5?
3.  **Action 2 (Ticket):** Create Jira Ticket for Analyst.
4.  **Action 3 (Block):** Push IP to Palo Alto Firewall Group.

### Playbook Logic
*   **Decision:** Is the IP internal or external? (Don't block internal IPs!).
*   **Decision:** Is the domain in the Alexa Top 1000? (Don't block Google.com!).

### Human in the Loop
For high-impact actions (Quarantining a Server), always require a "Button Press" approval. For low-impact (Blocking a known bad URL), automate fully.

---

## 3. Lab: The Auto-Blocker

### Scenario
Design the logic.

**Input:** New URL from Phishing Feed.
**Logic:**
1.  Check Allow-list (Is it our own domain?). If Yes -> Stop.
2.  Check Reputation (VirusTotal). If < 3 positives -> Stop.
3.  Check Active Status (UrlScan). If down -> Stop.
4.  **Update Firewall Object Group.**
5.  **Notify Slack Channel.**

---

## 4. Reflection
1.  What is the risk of a "Feedback Loop"? (Your SOAR blocks an IP. Your SIEM sees the block. Your SOAR sees the SIEM alert and tries to block it again. Infinite loop of tickets).
2.  Why do we check "Active Status"? (Firewall lists have limits. Don't fill limits with dead C2 servers).
