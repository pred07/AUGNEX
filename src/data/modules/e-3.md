# Legal Authorization, Scope, and Rules of Engagement

## 1. Orientation

### What this module covers
This module protects you from prison. We cover the legal framework that separates authorized security testing from criminal hacking—authorization documentation, scope definition, rules of engagement, and the professional practices that keep penetration testers out of courtrooms.

### Fit in the Learning Path
You are learning to use powerful tools. Without legal authorization, using these tools is federal crime in most jurisdictions. This module must be internalized before you touch any system you don't own.

### Learning Objectives
By the end of this module, you will:
*   Understand the legal requirements for authorized security testing
*   Define and respect scope boundaries
*   Identify common scope violations and how to avoid them
*   Apply rules of engagement throughout an assessment

---

## 2. Core Content

### Mental Model: The Permission Boundary

**How professionals think about this:**
There is no technical difference between a penetration test and a crime—only a legal one. That difference is written permission. Professional pentesters treat authorization documents like protective armor: you do not enter battle without them.

```
THE CRITICAL DISTINCTION:

┌─────────────────────────────────────────────────────────────────────┐
│                         SAME ACTIONS                                │
│  • Port scanning                                                   │
│  • Vulnerability exploitation                                      │
│  • Credential cracking                                             │
│  • Data exfiltration                                               │
│  • Privilege escalation                                            │
└─────────────────────────────────────────────────────────────────────┘
                              │
          ┌───────────────────┴───────────────────┐
          │                                       │
          ▼                                       ▼
┌───────────────────────┐           ┌───────────────────────┐
│     WITH PERMISSION   │           │   WITHOUT PERMISSION  │
│                       │           │                       │
│  • Penetration test   │           │  • Computer fraud     │
│  • Security assessment│           │  • Unauthorized access│
│  • Professional work  │           │  • Criminal charges   │
│  • Invoice and report │           │  • Prison time        │
└───────────────────────┘           └───────────────────────┘
```

### Legal Frameworks

**United States:**
- **CFAA (Computer Fraud and Abuse Act):** Primary federal law. Unauthorized access is criminal.
- **State laws:** Additional computer crime statutes vary by state.
- **Maximum penalties:** Fines and up to 20 years imprisonment for severe cases.

**Key legal concepts:**

| Term | Meaning |
|------|---------|
| **Authorization** | Explicit permission to access systems |
| **Scope** | Boundaries of what's permitted |
| **Unauthorized access** | Accessing systems without permission |
| **Exceeding authorization** | Going beyond permitted scope |

**Both unauthorized access AND exceeding authorization are crimes.**

### The Authorization Document

**Essential elements of a proper authorization:**

```
AUTHORIZATION LETTER/CONTRACT MUST CONTAIN:

1. PARTIES
   - Who is authorizing (client name, authority to authorize)
   - Who is testing (company, individuals)

2. SCOPE DEFINITION
   - Specific IP addresses/ranges
   - Specific domains/URLs
   - Specific applications
   - Physical locations (if applicable)

3. TIME BOUNDARIES
   - Start date/time
   - End date/time
   - Allowed testing hours

4. EXCLUDED TARGETS
   - Third-party systems
   - Production restrictions
   - Specific hosts to avoid

5. RULES OF ENGAGEMENT
   - Permitted attack types
   - Prohibited actions
   - Social engineering boundaries
   - Data handling requirements

6. EMERGENCY CONTACTS
   - Technical contact
   - Management contact
   - After-hours contact
   - Escalation procedures

7. SIGNATURES
   - Client signature (authorized representative)
   - Date
   - Tester acknowledgment
```

### Scope: The Boundary You Cannot Cross

**Scope violations are crimes, even by accident:**

```
SCOPE CHECK SCENARIO:

Authorized: 192.168.1.1 - 192.168.1.10

You're testing 192.168.1.5 (IN SCOPE)
You discover it connects to database at 192.168.1.50

Can you test 192.168.1.50?

┌─────────────────────────────────────────────────────────────────────┐
│  ANSWER: NO                                                        │
│                                                                     │
│  192.168.1.50 is NOT in the authorized range.                      │
│  Even if the client owns it.                                       │
│  Even if it's "obviously related."                                 │
│  Even if testing it would complete your assessment.                │
│                                                                     │
│  You must STOP and get additional written authorization.           │
└─────────────────────────────────────────────────────────────────────┘
```

**Common scope traps:**

| Scenario | Risk | Correct Action |
|----------|------|----------------|
| Found third-party cloud service | Testing AWS/Azure/Cloudflare is attacking them | Stop, document, seek authorization |
| Client's partner company linked | Partner isn't your client | Stop, document, seek authorization |
| Subdomain not in scope | May be different team/purpose | Stop, document, seek authorization |
| Production vs. staging confusion | Production access may be excluded | Verify before accessing |
| Physical scope vs. network scope | Physical testing needs separate auth | Clarify explicitly |

### Rules of Engagement

**What you CAN and CANNOT do:**

**Testing types requiring explicit permission:**

| Activity | Typical Default | Must Confirm |
|----------|----------------|--------------|
| Port scanning | Usually allowed | Timing restrictions |
| Exploitation | Usually allowed | Destructive potential |
| DoS/DDoS testing | Usually prohibited | Almost never allowed in prod |
| Social engineering | Must be explicit | Who is targetable |
| Physical testing | Must be explicit | Which facilities |
| Malware deployment | Must be explicit | Custom tools |
| Data exfiltration | Usually limited | Proof of access vs. actual data |
| Credential cracking | Usually allowed | Password policy testing |

**Data handling rules:**
- Do you keep copies of discovered data? (Usually no)
- How do you prove access without taking real data? (Screenshots, file listings)
- What if you discover illegal content? (Usually requires stopping and reporting)

**Destructive testing:**
- Can you crash systems to prove DoS? (Rarely, usually simulated)
- Can you delete or modify files? (Almost never without specific permission)
- What if exploitation crashes the target? (Document immediately, contact emergency contact)

### Third-Party Complications

**Cloud services and CDNs:**
```
YOUR CLIENT: example.com
HOSTED ON: AWS, behind Cloudflare

PROBLEM: Attacking example.com might mean attacking:
- Cloudflare's CDN infrastructure
- AWS EC2 instances
- Shared hosting environments

These third parties have NOT authorized your testing.
Testing may violate THEIR terms of service.
Testing may trigger THEIR security responses (blocks, reports).
```

**Best practice:**
- Identify all third parties in scope
- Document what infrastructure you'll be testing
- Consider whether testing is even possible without third-party impact
- Some cloud providers have testing authorization processes

### Emergency Procedures

**When something goes wrong:**

```
INCIDENT RESPONSE FOR TESTERS:

1. STOP IMMEDIATELY
   - Do not try to "fix" what you broke
   - Do not continue testing
   - Do not delete evidence

2. DOCUMENT
   - What action caused the problem
   - What symptoms you observe
   - Exact time
   - Screenshots if possible

3. CONTACT
   - Call emergency contact immediately
   - Be honest and specific
   - "I ran X command, and the server became unresponsive"

4. COOPERATE
   - Support remediation efforts
   - Provide all relevant logs
   - Never deny or minimize

5. DOCUMENT AGAIN
   - Full incident report
   - Include in final deliverable
```

### Evidence and Documentation

**Protect yourself with documentation:**

Every action should be logged:
- Commands executed
- Timestamps
- Outputs and responses
- Screenshots of critical findings
- Scope verification before each target

**Tool logging:**
```bash
# Script your entire session
script -a pentest_$(date +%Y%m%d).log

# Log MSF framework sessions
setg SessionLogging true

# Screenshot critical findings
screencapture or screenshot tools
```

### Professional Ethics

**Beyond legal requirements:**

| Situation | Unethical Response | Ethical Response |
|-----------|-------------------|------------------|
| Client asks to test competitor | Accept the work | Refuse immediately |
| You find client breaking law | Ignore it | Consult legal counsel |
| You could access more than authorized | Take the access | Stay in scope |
| Vulnerability is embarrassingly simple | Mock the client | Professional documentation |
| Data discovered could be valuable | Keep copies | Destroy after engagement |

---

## 3. Guided Practice

### Exercise 1: Scope Verification

**Authorized scope:**
- IP Range: 10.0.0.1 - 10.0.0.50
- Domain: vulnerable-app.example.com
- Time: Monday-Friday, 09:00-17:00 EST
- Excluded: 10.0.0.45 (production database)

Determine if each action is permitted:

| Action | Permitted? | Why? |
|--------|-----------|------|
| Scan 10.0.0.25 on Tuesday at 10:00 | ___ | ___ |
| Scan 10.0.0.75 | ___ | ___ |
| Scan 10.0.0.25 on Saturday | ___ | ___ |
| Scan 10.0.0.45 | ___ | ___ |
| Scan vulnerable-app.example.com's AWS CDN | ___ | ___ |

### Exercise 2: RoE Analysis

**Rules of Engagement state:**
- No denial of service testing
- Social engineering limited to email phishing
- No physical access testing
- Credential cracking permitted
- No data exfiltration (proof of access sufficient)

Determine if each action is permitted:

| Action | Permitted? |
|--------|-----------|
| Sending phishing emails to targets | ___ |
| Calling IT helpdesk pretending to be employee | ___ |
| Running Hashcat on captured password hashes | ___ |
| Downloading full customer database as proof | ___ |
| Flood testing login page with requests | ___ |

### Exercise 3: Emergency Scenario

You're running a SQL injection test and the target web server becomes unresponsive.

Write your immediate action plan:
1. ___
2. ___
3. ___
4. ___
5. ___

---

## 4. Reflection Check

### Legal Understanding
1. What's the difference between "unauthorized access" and "exceeding authorization"? Why are both criminal?

2. You have a verbal agreement with a client to test their system. Your laptop is seized by investigators. What happens?

3. Your scope says "test the web application." Does this include the database behind it?

### Professional Judgment
1. During testing, you accidentally discover evidence that the client is committing fraud. What do you do?

2. A client says "do whatever it takes to get in—we want a real test." Why is this insufficient authorization?

3. You're testing a subsidiary of your client. The subsidiary's IT team didn't know about the test. They call the police. Your position?

---

## 5. Key Misconceptions

**MYTH: "If I don't cause damage, it's not a crime"**
REALITY: Unauthorized access alone is criminal under CFAA, regardless of intent or damage.

**MYTH: "The client owns it, so I can test anything they own"**
REALITY: Authorization must be specific. Company ownership doesn't equal testing permission.

**MYTH: "Bug bounty scope covers everything on the domain"**
REALITY: Bug bounty programs have specific scope. Out-of-scope findings may still be crimes.

**MYTH: "I'm getting paid, so I'm protected"**
REALITY: A contract without proper authorization terms doesn't provide legal protection.

**MYTH: "Educational/research purposes are exceptions"**
REALITY: There is no educational exception to computer crime laws. Test on systems you own or have permission for.

---

## 6. Completion Criteria

This module is complete when you can:

1. **Identify** the essential elements of a proper authorization document
2. **Recognize** scope boundaries and common scope creep scenarios
3. **Apply** rules of engagement throughout an assessment
4. **Execute** proper emergency procedures when things go wrong
5. **Distinguish** between legal testing and criminal hacking

---

## 7. Further Depth (Optional)

*   **Reading:** Computer Fraud and Abuse Act (18 U.S.C. § 1030)
*   **Framework:** Review PTES for engagement documentation standards
*   **Practice:** Draft an authorization template for a fictional engagement
*   **Research:** Study significant CFAA cases and their outcomes
