# Infrastructure as Code (IaC) Fundamentals

## 1. Orientation

### What this module covers
Infrastructure as Code (IaC) removes the "ClickOps" manual process of setting up servers. It treats infrastructure provisioning (Networks, VMs, Load Balancers) as software. This module defines the core principles: Declarative vs. Imperative, Idempotency, and Mutable vs. Immutable infrastructure.

### Learning Objectives
*   Contrast **Declarative** (Terraform) vs **Imperative** (Ansible/Bash) approaches.
*   Define **Idempotency** and why it prevents configuration drift.
*   Explain the security benefits of **Immutable Infrastructure** (Cattle vs. Pets).

---

## 2. Core Content

### Declarative vs. Imperative
*   **Imperative (How):** "Connect to server. Install Nginx. Start Service." (e.g., Bash script). *Risk:* If you run it twice, it might break.
*   **Declarative (What):** "I want a server with Nginx running." (e.g., Terraform, K8s). *Benefit:* The tool figures out how to get there. If it's already there, it does nothing.

### Idempotency
A mathematical property where `f(f(x)) = f(x)`. In DevOps: **Running the same script 100 times should result in the same state as running it once.**
*   *Bash is rarely idempotent* (e.g., `mkdir folder` fails the second time).
*   *Ansible/Terraform are designed to be idempotent.*

### Pets vs. Cattle (Immutable)
*   **Pets:** Servers we name (e.g., "Zeus"), patch manually, and nurse back to health when sick. *Drift is inevitable.*
*   **Cattle:** Servers with IDs (e.g., `i-0a1b2c`), created from a master image. If one is sick, we terminate it and spawn a new one. *Consistency is guaranteed.*

---

## 3. Lab: The Drift Test

### Scenario
You have a script `setup.sh`:
```bash
echo "dev" >> /etc/env
apt-get install -y nginx
```

1.  **Run 1:** Works. `/etc/env` contains "dev".
2.  **Run 2:** `/etc/env` now contains "dev\ndev". **Drift has occurred.**
3.  **The Ansible Fix:**
    ```yaml
    - name: Set Environment
      lineinfile:
         path: /etc/env
         line: "dev"
    ```
    *Result:* Ansible checks if the line exists first. Run 2 does nothing.

---

## 4. Reflection
1.  Why is manual "ClickOps" in AWS Console considered a security risk? (No audit trail, no rigorous review, easy to make misconfigurations).
2.  How does IaC enable Disaster Recovery? (You can rebuild your entire datacenter in a new region with one command).
