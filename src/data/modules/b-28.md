# Container Security Scanning

## 1. Orientation

### What this module covers
Your application code might be secure, but what about the OS libraries inside your container? Module b-28 covers **Static Analysis for Containers** (SCA). We will use tools like **Trivy**, **Grype**, and **Clair**.

### Learning Objectives
*   Scan an image for CVEs.
*   Understand **Distroless** images.
*   Implement "Golden Image" pipelines.

---

## 2. Core Content

### The Dependency Tree
`Your App` -> depends on `Node.js` -> depends on `OpenSSL` -> depends on `libc`.
A vulnerability in `OpenSSL` is a vulnerability in your Container.

### Scanning with Trivy
Trivy is a comprehensive scanner.
*   **Command:** `trivy image myapp:latest`
*   **Output:** List of CVEs (Critical, High, Medium) and "Fixed Version".

### The Fix: Distroless
Google's "Distroless" images contain *only* your application and its runtime dependencies. They do not contain package managers, shells, or standard linux tools.
*   *Why?* If an attacker breaks in, they can't run `ls`, `curl`, or `apt-get`.
*   *Base:* `gcr.io/distroless/nodejs`.

### Golden Images
Don't pull `node:latest` in every build. 
1.  Security Team pulls `node:lts`, scans it, hardens it.
2.  Push to private registry as `company/node:18-secure`.
3.  Devs use `FROM company/node:18-secure`.

---

## 3. Lab: Scanning & Patcing

### Task
1.  **Pull:** `docker pull python:3.4-alpine` (Very old).
2.  **Scan:** `trivy image python:3.4-alpine`.
3.  **Result:** 50+ Vulnerabilities. Some Critical.

**Remediation:**
1.  Change Dockerfile to `FROM python:3.11-alpine`.
2.  **Scan:** 0 Vulnerabilities.
3.  **Lesson:** Simply updating the base image eliminates 90% of container risks.

---

## 4. Reflection
1.  What is the different between OS Vulnerabilities and App Vulnerabilities? (OS = `libc`, `bash`. App = `pip` packages, `npm` modules. You must scan both).
2.  Can you patch a running container? (No. Containers are immutable. You patch the *image* and redeploy a new container).
