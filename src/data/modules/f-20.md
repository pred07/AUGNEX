# Networking Fundamentals (OSI & TCP/IP)

## 1. Orientation

### What this module covers
This module covers the foundation of how computers communicate—the OSI and TCP/IP models. Understanding network layers is essential for analyzing attacks, designing defenses, and troubleshooting connectivity.

### Fit in the Learning Path
Network attacks exploit specific layers—ARP spoofing targets Layer 2, IP spoofing targets Layer 3, SYN floods target Layer 4. A mental map of the network stack helps you understand where attacks occur and how to defend.

### Learning Objectives
By the end of this module, you will:
*   Explain the OSI and TCP/IP models
*   Understand encapsulation and decapsulation
*   Identify which layer various devices operate at
*   Recognize layer-specific attacks

---

## 2. Core Content

### Mental Model: Layers of an Envelope

**How professionals think about this:**
Sending data is like sending a letter. The message is wrapped in an envelope (transport), addressed (network), and handed to a courier (physical). Each layer adds its information to the packet, creating nested envelopes.

```
ENCAPSULATION VISUALIZATION:

Application creates data:
┌──────────────────────────────────────────────────────┐
│  DATA: "Hello, this is a web request"               │
└──────────────────────────────────────────────────────┘

Transport layer adds headers:
┌───────────┬──────────────────────────────────────────┐
│ TCP HDR   │  DATA                                    │
│ Port 443  │                                          │
└───────────┴──────────────────────────────────────────┘

Network layer adds headers:
┌───────────┬───────────┬──────────────────────────────┐
│  IP HDR   │ TCP HDR   │  DATA                        │
│ Src/Dst IP│           │                              │
└───────────┴───────────┴──────────────────────────────┘

Data Link layer adds headers AND trailer:
┌───────────┬───────────┬───────────┬──────────────────┬─────────┐
│ ETH HDR   │  IP HDR   │ TCP HDR   │  DATA            │ ETH FCS │
│ Src/Dst   │           │           │                  │ (CRC)   │
│ MAC       │           │           │                  │         │
└───────────┴───────────┴───────────┴──────────────────┴─────────┘

Physical layer: Convert to electrical/optical/radio signals
```

### The OSI Model (7 Layers)

**Reference model for networking:**

```
OSI MODEL:

Layer 7: APPLICATION
─────────────────────────────
What: User-facing protocols
Examples: HTTP, HTTPS, FTP, SMTP, DNS
PDU: Data
Device: Application/Proxy
Security: WAF, application firewall

Layer 6: PRESENTATION
─────────────────────────────
What: Data formatting, encryption
Examples: SSL/TLS, JPEG, ASCII, compression
PDU: Data
Security: Encryption protocols

Layer 5: SESSION
─────────────────────────────
What: Session establishment/teardown
Examples: NetBIOS, RPC, SQL sessions
PDU: Data
Security: Session management

Layer 4: TRANSPORT
─────────────────────────────
What: End-to-end communication
Examples: TCP (reliable), UDP (fast)
PDU: Segment (TCP) / Datagram (UDP)
Device: Load balancer (L4)
Security: Firewall (stateful)

Layer 3: NETWORK
─────────────────────────────
What: Routing between networks
Examples: IP, ICMP, IPSec
PDU: Packet
Device: Router, L3 switch
Security: Firewall (packet filter), ACL

Layer 2: DATA LINK
─────────────────────────────
What: Local network delivery
Examples: Ethernet, Wi-Fi (802.11), ARP
PDU: Frame
Device: Switch, Bridge
Security: Port security, 802.1X

Layer 1: PHYSICAL
─────────────────────────────
What: Physical transmission
Examples: Cables, fiber, radio waves
PDU: Bits
Device: Hub, repeater, cables
Security: Physical access control
```

### TCP/IP Model (4 Layers)

**Practical networking model:**

```
TCP/IP vs OSI:

OSI (7 Layers)        TCP/IP (4 Layers)
─────────────────     ─────────────────
Application           Application
Presentation          (Merged)
Session               (Merged)
─────────────────     ─────────────────
Transport             Transport
─────────────────     ─────────────────
Network               Internet
─────────────────     ─────────────────
Data Link             Network Access
Physical              (Merged)
─────────────────     ─────────────────

TCP/IP LAYERS:

4. APPLICATION
   HTTP, HTTPS, DNS, FTP, SMTP
   
3. TRANSPORT
   TCP (reliable, connection-oriented)
   UDP (unreliable, connectionless)
   
2. INTERNET
   IP, ICMP, ARP
   
1. NETWORK ACCESS
   Ethernet, Wi-Fi, physical media
```

### Key Protocols by Layer

**Protocol mapping:**

| Layer | Protocol | Purpose | Port/Type |
|-------|----------|---------|-----------|
| **L7** | HTTP | Web (unencrypted) | TCP 80 |
| **L7** | HTTPS | Web (encrypted) | TCP 443 |
| **L7** | DNS | Name resolution | UDP/TCP 53 |
| **L7** | SSH | Secure shell | TCP 22 |
| **L7** | FTP | File transfer | TCP 21 |
| **L7** | SMTP | Email sending | TCP 25 |
| **L4** | TCP | Reliable transport | - |
| **L4** | UDP | Fast transport | - |
| **L3** | IP | Addressing/Routing | - |
| **L3** | ICMP | Network diagnostics | Type/Code |
| **L2** | ARP | IP to MAC resolution | - |
| **L2** | Ethernet | LAN framing | - |

### TCP Three-Way Handshake

**Connection establishment:**

```
TCP CONNECTION ESTABLISHMENT:

Client                                  Server
   │                                       │
   │ ──────── SYN (seq=100) ─────────────► │
   │         "I want to connect"           │
   │                                       │
   │ ◄────── SYN-ACK (seq=300,ack=101) ─── │
   │         "OK, I acknowledge"           │
   │                                       │
   │ ──────── ACK (seq=101,ack=301) ─────► │
   │         "Connection established"      │
   │                                       │
   │ ◄═══════════ DATA ═══════════════════►│
   │                                       │

SECURITY IMPLICATIONS:
─────────────────────────────
SYN Flood: Send many SYNs, never complete handshake
           Server exhausts resources tracking half-open
           
SYN Cookies: Defense - don't allocate until ACK received

Sequence number prediction: Historical attack
           Predict sequence to inject packets
```

### IP Addressing

**Network layer addressing:**

```
IP ADDRESS STRUCTURE:

IPv4: 32 bits (4 octets)
192.168.1.100 = 11000000.10101000.00000001.01100100

CIDR Notation:
192.168.1.0/24
└── First 24 bits = Network
    Last 8 bits = Host (256 addresses)

PRIVATE IP RANGES:
─────────────────────────────
10.0.0.0/8      (10.0.0.0 - 10.255.255.255)
172.16.0.0/12   (172.16.0.0 - 172.31.255.255)
192.168.0.0/16  (192.168.0.0 - 192.168.255.255)

SPECIAL ADDRESSES:
─────────────────────────────
127.0.0.1       Localhost (loopback)
0.0.0.0         All interfaces / default route
255.255.255.255 Broadcast

IPv6: 128 bits
2001:0db8:85a3:0000:0000:8a2e:0370:7334
```

### MAC Addresses and ARP

**Layer 2 addressing:**

```
MAC ADDRESS:
─────────────────────────────
48 bits (6 bytes): AA:BB:CC:DD:EE:FF
First 3 bytes: OUI (Manufacturer)
Last 3 bytes: Device unique

ARP (Address Resolution Protocol):
─────────────────────────────
Purpose: IP → MAC resolution

ARP Request (Broadcast):
"Who has 192.168.1.1? Tell 192.168.1.100"

ARP Reply (Unicast):
"192.168.1.1 is at AA:BB:CC:DD:EE:FF"

ARP SPOOFING ATTACK:
─────────────────────────────
Attacker sends fake ARP reply:
"192.168.1.1 (gateway) is at ATTACKER_MAC"

Victim now sends traffic to attacker
Man-in-the-Middle achieved

Defense: Static ARP, ARP inspection
```

### Network Devices by Layer

**What operates where:**

```
DEVICE LAYER MAPPING:

Layer 1 (Physical):
├── Hub: Repeats to all ports
├── Cable/Fiber
└── Repeater

Layer 2 (Data Link):
├── Switch: Forwards based on MAC
├── Bridge: Connects segments
├── WAP: Wireless access point
└── NIC: Network interface card

Layer 3 (Network):
├── Router: Routes between networks
├── L3 Switch: Routing + switching
└── Firewall: Packet filtering

Layer 4 (Transport):
├── Load balancer: Distributes connections
└── Stateful firewall

Layer 7 (Application):
├── Proxy: Application-level gateway
├── WAF: Web application firewall
├── IDS/IPS: Deep packet inspection
└── Application firewall
```

### Layer-Specific Attacks

**Attack mapping:**

| Layer | Attack | Description |
|-------|--------|-------------|
| **L1** | Cable cutting | Physical DoS |
| **L1** | Signal jamming | Wireless disruption |
| **L2** | ARP spoofing | MITM via fake ARP |
| **L2** | MAC flooding | Overwhelm switch CAM table |
| **L2** | VLAN hopping | Escape VLAN isolation |
| **L3** | IP spoofing | Forge source IP |
| **L3** | ICMP redirect | Route manipulation |
| **L4** | SYN flood | TCP resource exhaustion |
| **L4** | Port scanning | Service discovery |
| **L7** | SQLi, XSS | Application attacks |
| **L7** | DNS poisoning | Name resolution manipulation |

---

## 3. Guided Practice

### Exercise 1: Layer Identification

For each scenario, identify the layer:

| Scenario | Layer |
|----------|-------|
| Router forwards packet based on IP | ___ |
| Switch forwards frame based on MAC | ___ |
| Browser makes HTTPS request | ___ |
| Firewall blocks port 23 | ___ |
| Attacker changes their MAC address | ___ |

### Exercise 2: Packet Analysis

A packet contains:
- Ethernet header (MAC addresses)
- IP header (IP addresses)
- TCP header (ports)
- HTTP data (GET request)

1. At which layer is the source MAC address used? ___
2. At which layer is the destination IP used? ___
3. At which layer is the port 80 relevant? ___
4. At which layer is the GET request parsed? ___

### Exercise 3: Attack Classification

Classify these attacks by layer:

| Attack | Layer |
|--------|-------|
| SYN flood | ___ |
| ARP spoofing | ___ |
| SQL injection | ___ |
| IP spoofing | ___ |
| Cable cutting | ___ |

---

## 4. Reflection Check

### Model Understanding
1. Why does a router not care about MAC addresses?

2. Data leaves your laptop as bits. Arrives at server as HTTP. What happened?

3. Why can't a hub be used for network security segmentation?

### Protocol Understanding
1. Why use TCP for HTTP but UDP for DNS?

2. ARP has no authentication. Why is this dangerous?

3. What happens if a switch's MAC table overflows?

---

## 5. Key Misconceptions

**MYTH: "OSI is how networks actually work"**
REALITY: OSI is a reference model. Real networks use TCP/IP. OSI helps learning and discussion.

**MYTH: "All 7 layers are used in every communication"**
REALITY: Layers 5-6 are often not distinct in practice. TCP/IP merges them into Application.

**MYTH: "Switches operate at Layer 3"**
REALITY: Basic switches are Layer 2 (MAC). L3 switches add routing capabilities.

**MYTH: "IP addresses are permanent identifiers"**
REALITY: IPs can be dynamic (DHCP), spoofed, or NAT'd. MACs can also be changed.

**MYTH: "Encryption happens at one layer"**
REALITY: Encryption can happen at L2 (MACsec), L3 (IPSec), L4 (TLS), or L7 (Application).

---

## 6. Completion Criteria

This module is complete when you can:

1. **List** OSI and TCP/IP layers with examples
2. **Explain** encapsulation and decapsulation
3. **Identify** which layer devices operate at
4. **Match** attacks to their target layer
5. **Describe** the TCP three-way handshake

---

## 7. Further Depth (Optional)

*   **Tool:** Capture and analyze packets with Wireshark
*   **Practice:** Set up network with GNS3 or Packet Tracer
*   **Reading:** TCP/IP Illustrated (Stevens)
*   **Lab:** Perform ARP spoofing in isolated lab
