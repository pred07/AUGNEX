# Logging Requirements from an Attacker's View

## 1. Orientation

### What this module covers
This module inverts the defensive perspective—instead of asking "What should we log?", we ask "What does the attacker hope we don't log?" Understanding attacker anti-forensics priorities reveals what logging is truly critical.

### Fit in the Learning Path
Attackers thrive in darkness. They know your logging gaps and exploit them. By thinking like an attacker about logs and forensics, you can prioritize the logging that matters most and protect your investigative capabilities.

### Learning Objectives
By the end of this module, you will:
*   Identify critical logging gaps from an attacker perspective
*   Protect logs from tampering
*   Configure logging that attackers fear
*   Balance logging volume with visibility

---

## 2. Core Content

### Mental Model: The Attacker's Fear

**How professionals think about this:**
Attackers fear logs. Every action potentially leaves evidence. Understanding what attackers hope isn't logged reveals what you must prioritize logging.

```
THE ATTACKER'S LOGGING QUESTIONS:

┌─────────────────────────────────────────────────────────────────────┐
│                                                                     │
│  Before executing technique, attacker asks:                        │
│                                                                     │
│  1. "Is this even logged?"                                         │
│      If no → Safe to proceed                                       │
│      If yes → Next question                                        │
│                                                                     │
│  2. "Where are logs stored?"                                       │
│      Local only → Can be cleared                                   │
│      Remote → Harder to tamper                                     │
│                                                                     │
│  3. "How much detail is logged?"                                   │
│      Just "event happened" → Useless for investigation             │
│      Full command line → Can identify attack                       │
│                                                                     │
│  4. "How long are logs retained?"                                  │
│      Short retention → Wait it out                                 │
│      Long retention → More careful, faster exit                    │
│                                                                     │
│  5. "Is anyone watching?"                                          │
│      No real-time monitoring → Proceed freely                      │
│      Active SOC → Be stealthy                                      │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### The Attacker's Logging Checklist

**What attackers hope you don't have:**

```
ATTACKER'S ANTI-FORENSICS CHECKLIST:

Category          | Attacker's Hope                | Defender's Counter
──────────────────┼────────────────────────────────┼────────────────────────
Command Lines     | Logs say "powershell.exe"      | Full command line logging
                  | not "powershell.exe -enc..."   | (Sysmon, Script Block)
                  |                                |
Process Relations | Unknown what spawned what      | Parent/child tracking
                  |                                | (Sysmon Event 1)
                  |                                |
Script Content    | Just "script ran"              | Script Block Logging
                  |                                | (PowerShell 4104)
                  |                                |
Network Detail    | "Connection to port 443"       | DNS logs, proxy logs
                  | not "to malicious.com"         | TLS inspection
                  |                                |
Credential Use    | "Login successful"             | Logon type, source IP
                  | not "from unusual location"    | authentication method
                  |                                |
File Operations   | No file access logging         | File integrity monitoring
                  |                                | (Sysmon 11, 23)
                  |                                |
Log Retention     | Logs deleted after 7 days      | Long retention (1 year+)
                  |                                | Immutable storage (WORM)
```

### Critical Logging Configurations

**What attackers fear most:**

```
HIGH-VALUE LOGGING (Attacker's Nightmare):

1. SYSMON
   ─────────────────────────────
   Event 1:  Process Creation (with command line!)
   Event 3:  Network Connection
   Event 7:  Image Loaded (DLL loading)
   Event 8:  CreateRemoteThread (injection)
   Event 10: Process Access (credential dumping)
   Event 11: File Create
   Event 22: DNS Query
   Event 23: File Delete
   Event 25: Process Tampering

2. POWERSHELL
   ─────────────────────────────
   Module Logging:         What modules loaded
   Script Block Logging:   Actual script content (4104)
   Transcription:          Full I/O capture

3. WINDOWS SECURITY
   ─────────────────────────────
   4624/4625: Logon success/failure
   4648:      Explicit credential use
   4672:      Special privileges
   4688:      Process creation (with command line)
   4698-4702: Scheduled task events
   4768-4769: Kerberos ticket events
   1102:      Log cleared (critical alert!)

4. NETWORK
   ─────────────────────────────
   DNS queries (passive DNS)
   Proxy logs (full URL)
   Firewall (connection logs)
   NetFlow (traffic patterns)
```

### Log Tampering Attacks

**How attackers destroy evidence:**

```
LOG TAMPERING TECHNIQUES:

1. LOG CLEARING
   ─────────────────────────────
   wevtutil cl Security
   wevtutil cl System
   Clear-EventLog -LogName Security
   
   DETECTION: Event ID 1102 (audit log cleared)
              Windows event logs should NEVER be cleared
              THIS IS ALWAYS AN INCIDENT

2. SELECTIVE DELETION
   ─────────────────────────────
   Tools: MimiPenguin, Invoke-Phant0m
   Select and delete specific entries
   
   DETECTION: Gap analysis in timestamps
              Event ID monitoring for deletion tools

3. LOG FLOODING
   ─────────────────────────────
   Generate millions of benign events
   Overwhelm SIEM/storage
   Evidence gets rotated out
   
   DETECTION: Rate limiting on collection
              Anomalous event volume alerts

4. TIMESTOMPING
   ─────────────────────────────
   Modify file timestamps
   Confuse timeline analysis
   
   DETECTION: $STANDARD_INFORMATION vs $FILE_NAME
              NTFS stores multiple timestamps

5. LIVING OFF THE LAND
   ─────────────────────────────
   Use system binaries (less suspicious logs)
   "powershell.exe" not "malware.exe"
   
   DETECTION: Command line content analysis
              Behavioral detection
```

### Protecting Log Integrity

**Making logs tamper-resistant:**

```
LOG PROTECTION STRATEGIES:

1. CENTRALIZED COLLECTION
   ─────────────────────────────
   Ship logs off-system as fast as possible
   
   Endpoint → Agent → Central SIEM
   
   The "Golden Hour": Time between event and collection
   Shorter = Better (real-time preferred)

2. WRITE-ONCE STORAGE (WORM)
   ─────────────────────────────
   Logs cannot be modified after write
   
   S3 Object Lock (AWS)
   Azure immutable blob storage
   Physical WORM media

3. LOG SIGNING
   ─────────────────────────────
   Cryptographic signature on log entries
   Detect tampering after the fact
   
   Chain of custody for legal proceedings

4. REDUNDANCY
   ─────────────────────────────
   Multiple collection paths
   Agent + agentless
   Endpoint + network-based

5. PRIVILEGE SEPARATION
   ─────────────────────────────
   Log systems: Different admin accounts
   Attackers with domain admin
   shouldn't automatically have log admin
```

### Coverage Assessment

**Do you log what matters?**

```
LOGGING COVERAGE AUDIT:

For each critical action, ask:

ACTION                    LOGGED?   DETAIL?   PROTECTED?   ALERTED?
──────────────────────────────────────────────────────────────────────
PowerShell execution        □         □          □            □
Process creation            □         □          □            □
Command lines               □         □          □            □
Network connections         □         □          □            □
DNS queries                 □         □          □            □
Authentication              □         □          □            □
Privilege escalation        □         □          □            □
File access (sensitive)     □         □          □            □
Scheduled task creation     □         □          □            □
Registry modifications      □         □          □            □
Log clearing                □         □          □            □
Service installation        □         □          □            □

☑ Good   □ Gap   ⚠ Partial

All gaps are attacker opportunities
```

### The Purple Team Validation

**Testing your logging:**

```
PURPLE TEAM LOG VALIDATION:

1. EXECUTE TECHNIQUE
   ─────────────────────────────
   Red team: Run Mimikatz for credential dump
   
2. CHECK TELEMETRY
   ─────────────────────────────
   Blue team: What logs exist?
   
3. ANSWER QUESTIONS
   ─────────────────────────────
   □ Did the event log?              Yes / No
   □ Where did it log?               Endpoint / SIEM
   □ What detail is captured?        Summary / Full
   □ How long until it reached SIEM? ____ seconds
   □ Would you notice it in noise?   Yes / No
   
4. GAP REMEDIATION
   ─────────────────────────────
   If gap found:
   - Enable logging
   - Forward to SIEM
   - Create detection rule
   - Re-test

5. DOCUMENT
   ─────────────────────────────
   Technique | Logged | Detection | Gap Status
```

---

## 3. Guided Practice

### Exercise 1: Attacker Perspective

For each technique, what would you hope isn't logged as an attacker?

| Technique | Attacker's Hope | Defender's Counter |
|-----------|-----------------|-------------------|
| PowerShell download | ___ | ___ |
| LSASS dump | ___ | ___ |
| Scheduled task creation | ___ | ___ |
| Lateral movement via RDP | ___ | ___ |

### Exercise 2: Log Gap Assessment

Audit your environment:

| Log Source | Collected | Detail Level | Protected | Gap? |
|------------|-----------|--------------|-----------|------|
| Windows Security | ___ | ___ | ___ | ___ |
| PowerShell | ___ | ___ | ___ | ___ |
| Sysmon | ___ | ___ | ___ | ___ |
| DNS | ___ | ___ | ___ | ___ |

### Exercise 3: Log Clearing Detection

Create a detection for log clearing:

Event ID to monitor: ___
Alert priority: ___
Response action: ___

---

## 4. Reflection Check

### Logging Understanding
1. Logs say "PowerShell ran." Is this useful for investigation?

2. Attacker has Domain Admin. Your SIEM is on the domain. Problem?

3. Log retention is 30 days. Average dwell time is 200 days. Issue?

### Strategic Thinking
1. All logging enabled. Storage costs triple. Prioritization?

2. Sysmon on 90% of endpoints. 10% are legacy. Risk?

3. Real-time forwarding adds 5% CPU overhead. Worth it?

---

## 5. Key Misconceptions

**MYTH: "We log everything"**
REALITY: Logging something ≠ logging it with useful detail ≠ protecting it ≠ alerting on it.

**MYTH: "Attackers can't delete logs once shipped"**
REALITY: Time between event and shipping is a window. Minimize it.

**MYTH: "Event logs are sufficient"**
REALITY: Windows default logging misses critical details. Sysmon + Script Block Logging required.

**MYTH: "More logging is always better"**
REALITY: Volume without analysis is noise. Strategic logging > comprehensive logging.

**MYTH: "Log clearing only happens after attacks"**
REALITY: Sophisticated attackers clear logs throughout to hide their trail.

---

## 6. Completion Criteria

This module is complete when you can:

1. **Identify** logging gaps from attacker perspective
2. **Configure** high-value logging sources
3. **Protect** logs from tampering
4. **Validate** logging coverage through testing
5. **Balance** logging volume with visibility needs

---

## 7. Further Depth (Optional)

*   **Tool:** Sysmon configuration (SwiftOnSecurity baseline)
*   **Practice:** Purple team log validation exercise
*   **Resource:** MITRE ATT&CK Data Sources
*   **Reading:** Forensic investigation case studies
