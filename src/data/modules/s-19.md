# Automated Sandboxing (Cuckoo/CAPE)

## 1. Orientation

### What this module covers
Manual analysis is slow. In an enterprise with 1,000 alerts a day, you need automation. **Automated Malware Sandboxes** (like Cuckoo, CAPE, or commercial FireEye/Palo Alto Wildfire) automatically detonate files and produce a report.

### Learning Objectives
*   Understand the architecture of an Automated Sandbox.
*   Interpret a Sandbox Report (Score, Screenshots, Network).
*   Recognize the limitations of Automation.

---

## 2. Core Content

### How it Works
1.  **Submission:** Analyst uploads `bad.pdf` via Web UI or API.
2.  **Orchestration:** The Sandbox spins up a clean VM (Windows 10).
3.  **Detonation:** It injects the file, opens it, and simulates user activity (moving mouse).
4.  **Hooking:** The Sandbox injects probes into the kernel/API to record all calls.
5.  **Reporting:** It kills the VM and generates a JSON/HTML report.

### Interpreting the Score
Most sandboxes give a "Maliciousness Score" (0-10 or 0-100).
*   **High Risk:** Network traffic to known bad IPs, modifying system files, injecting code.
*   **False Positives:** Installers, strange but legitimate software.

### CAPE Sandbox (Config And Payload Extraction)
A fork of Cuckoo designed to extract the payload from packed malware. It can automatically dump the memory of a process once it unpacks itself.

---

## 3. Lab: Reading the Report

### Task
You receive a Cuckoo Report.
*   **Screenshots:** Show a ransom note background.
*   **Network:** requests to `api.ipify.org` (Check IP) and `c2.attacker.com`.
*   **Dropped Files:** `crypt.exe` in `%TEMP%`.
*   **Signatures Triggered:** "Ransomware behavior detected", "Shadow Copies deleted".

**Verdict:** Ransomware. Isolate affected machines immediately.

---

## 4. Reflection
1.  Can a Sandbox replace a Human Analyst? (No. Determining *impact* and *intent* often requires human context. Also, Sandboxes can be evaded).
2.  What is "Sleep evasion"? (Malware waits 20 minutes before acting. Sandboxes usually only run for 2-5 minutes, so they miss the behavior).
