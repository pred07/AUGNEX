# Baseline Network Behavior

## 1. Orientation

### What this module covers
This module covers network baselining—establishing what "normal" looks like so you can identify "abnormal." Anomaly detection depends on understanding baseline behavior.

### Fit in the Learning Path
Signature-based detection catches known attacks. Baseline analysis catches the unknown—insider threats, zero-days, and novel attack techniques. You cannot find evil without knowing good.

### Learning Objectives
By the end of this module, you will:
*   Establish network baselines across multiple dimensions
*   Identify meaningful deviations
*   Apply contextual analysis
*   Build anomaly detection strategies

---

## 2. Core Content

### Mental Model: The Unusual

**How professionals think about this:**
Security analysts are detectives of the unusual. A user who normally downloads 10MB per day suddenly downloads 50GB. A server that never initiates outbound connections suddenly reaches out to the internet. These deviations are the signals that matter.

```
BASELINE CONCEPT:

NORMAL PATTERN:
┌─────────────────────────────────────────────────────────────────────┐
│                                                                     │
│  Monday through Friday:                                            │
│  ┌────────────────────────────────────────────────────────────┐    │
│  │                    ████████                                │    │
│  │                 ███        ███                             │    │
│  │              ███              ███                          │    │
│  │           ███                    ███                       │    │
│  │        ███                          ███                    │    │
│  │     ███                                ███                 │    │
│  └────────────────────────────────────────────────────────────┘    │
│     6am  8am  10am  12pm  2pm  4pm  6pm  8pm                      │
│                                                                     │
│  Traffic peaks during business hours                               │
│  This is the BASELINE                                              │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘

ANOMALY:
┌─────────────────────────────────────────────────────────────────────┐
│                                                                     │
│  Same pattern, but:                                                │
│  ┌────────────────────────────────────────────────────────────┐    │
│  │                    ████████                     █████████  │    │
│  │                 ███        ███                             │    │
│  │              ███              ███                          │    │
│  │           ███                    ███                       │    │
│  │        ███                          ███                    │    │
│  │     ███                                ███                 │    │
│  └────────────────────────────────────────────────────────────┘    │
│     6am  8am  10am  12pm  2pm  4pm  6pm  8pm  2am                  │
│                                              ↑                     │
│                                              Unusual 2AM spike     │
│                                              INVESTIGATE           │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### Baseline Dimensions

**What to measure:**

```
BASELINE DIMENSIONS:

1. VOLUME
   ─────────────────────────────
   Bytes/packets per time period
   Per user, per server, per zone
   
   Normal: User downloads 50MB/day
   Anomaly: User downloads 5GB in 10 minutes
   
   Detection: Data exfiltration, malware download

2. TIMING
   ─────────────────────────────
   When activity occurs
   
   Normal: User active 9am-6pm
   Anomaly: User active at 3am Sunday
   
   Detection: Compromised credentials, insider threat

3. CONNECTIONS
   ─────────────────────────────
   Who talks to whom
   
   Normal: Server A only talks to Server B
   Anomaly: Server A suddenly talks to 50 new IPs
   
   Detection: Lateral movement, scanning

4. PROTOCOLS
   ─────────────────────────────
   What traffic is expected
   
   Normal: Server uses HTTP, MySQL
   Anomaly: Server suddenly using DNS heavily
   
   Detection: DNS tunneling, C2

5. GEOGRAPHY
   ─────────────────────────────
   Where traffic comes from
   
   Normal: Users in US, UK, India
   Anomaly: Login from North Korea
   
   Detection: Credential theft, VPN abuse

6. BEHAVIOR
   ─────────────────────────────
   What users/systems do
   
   Normal: User accesses 5 systems
   Anomaly: User accesses 500 systems
   
   Detection: Credential abuse, reconnaissance
```

### Establishing Baselines

**Building normal profiles:**

```
BASELINE COLLECTION PROCESS:

STEP 1: DATA COLLECTION (2-4 weeks minimum)
─────────────────────────────────────────
Collect:
- NetFlow/traffic metadata
- Authentication logs
- Application access logs
- DNS queries
- Firewall logs

STEP 2: AGGREGATION
─────────────────────────────────────────
Aggregate by:
- User identity
- Source IP / System
- Destination / Service
- Time window (hourly, daily, weekly)

STEP 3: STATISTICAL ANALYSIS
─────────────────────────────────────────
Calculate:
- Mean (average)
- Median
- Standard deviation
- Percentiles (90th, 95th, 99th)

Example:
User X daily download:
  Mean: 45MB
  Std Dev: 15MB
  99th percentile: 120MB

STEP 4: THRESHOLD SETTING
─────────────────────────────────────────
Alert when:
- Value > Mean + 3*StdDev
- Value > 99th percentile
- First-time behavior observed
```

### Anomaly Categories

**Types of deviations:**

| Anomaly Type | Example | Detection Method |
|--------------|---------|------------------|
| **Volume spike** | 10x normal data transfer | Threshold on bytes/packets |
| **Time anomaly** | Weekend admin login | Time-based rules |
| **New connection** | First time to new IP | Connection graph analysis |
| **Protocol change** | DNS instead of HTTPS | Protocol analysis |
| **Geo anomaly** | Login from new country | IP geolocation |
| **Behavioral** | Access to unusual systems | User/entity behavior analytics |

### Contextual Analysis

**Not all anomalies are bad:**

```
CONTEXT MATTERS:

ANOMALY: 10x normal traffic on Friday
─────────────────────────────────────────
Context 1: Black Friday sale
→ Normal business surge

Context 2: Random Tuesday in March
→ Possible exfiltration, investigate

ANOMALY: CEO logs in from China
─────────────────────────────────────────
Context 1: CEO is traveling in China
→ Normal

Context 2: CEO is in the office
→ Credential compromise

ANOMALY: New server-to-server connection
─────────────────────────────────────────
Context 1: Deployment of new application
→ Normal (check change request)

Context 2: No change record
→ Possible lateral movement

CONTEXTUAL DATA SOURCES:
─────────────────────────────────────────
- Travel schedules
- Change management records
- Business calendar (holidays, events)
- Helpdesk tickets
- HR data (new hires, departures)
```

### User and Entity Behavior Analytics (UEBA)

**ML-powered baselines:**

```
UEBA CONCEPT:

Traditional: Static thresholds
"Alert if downloads > 100MB"

UEBA: Dynamic, per-entity baselines
"Alert if THIS USER downloads more than
 THEIR normal amount by THEIR standard deviation"

UEBA CAPABILITIES:
─────────────────────────────────────────
1. Per-entity baselines
   Each user/system has own profile
   
2. Peer comparison
   "User A is different from other users in same role"
   
3. Behavior chains
   Login → Access files → Email → Upload
   (Normal for HR, abnormal for developer)
   
4. Risk scoring
   Aggregate multiple anomalies into overall risk

EXAMPLE UEBA DETECTION:
─────────────────────────────────────────
User John:
- Logged in at unusual time (+10 risk)
- From unusual location (+20 risk)
- Accessed unusual files (+15 risk)
- Downloaded large volume (+25 risk)
- Total risk score: 70 (Threshold: 50)
→ ALERT: Potential insider threat
```

### Beaconing Detection

**Finding C2 communication:**

```
BEACONING PATTERN:

Malware calls home at regular intervals:
┌─────────────────────────────────────────────────────────────────────┐
│                                                                     │
│  ↑     ↑     ↑     ↑     ↑     ↑     ↑     ↑     ↑     ↑          │
│  │     │     │     │     │     │     │     │     │     │          │
│  └─60s─┴─60s─┴─60s─┴─60s─┴─60s─┴─60s─┴─60s─┴─60s─┴─60s─┴          │
│                                                                     │
│  Regular timing = Beaconing indicator                              │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘

DETECTION APPROACH:
─────────────────────────────────────────
1. Find connections with consistent timing
2. Calculate jitter (variation in timing)
   - Low jitter (< 5%) = Likely automated/C2
   - High jitter = Normal human behavior

3. Other beacon indicators:
   - Similar payload sizes each time
   - Same destination (IP or domain)
   - Happens 24/7 (not just business hours)
   - Unusual protocol for destination
```

### Data Exfiltration Detection

**Finding theft:**

```
EXFILTRATION INDICATORS:

1. VOLUME ANOMALY
   ─────────────────────────────
   User: 50MB/day normal → 5GB sudden upload
   Server: 0 outbound → Large outbound transfer
   
2. DESTINATION ANOMALY
   ─────────────────────────────
   Upload to personal cloud storage
   Upload to foreign IP
   Upload to newly registered domain
   
3. PROTOCOL ANOMALY
   ─────────────────────────────
   Large DNS queries (DNS exfil)
   ICMP with data (ICMP tunneling)
   HTTP POST to public pastebin
   
4. TIMING ANOMALY
   ─────────────────────────────
   After-hours large transfers
   Just before resignation
   After security incident
   
BASELINE REQUIREMENT:
Know normal egress volume per user/system
Know normal egress destinations
Know normal protocols for each system
```

---

## 3. Guided Practice

### Exercise 1: Baseline Identification

For a web server, define baseline metrics:

| Metric | Normal Range | Anomaly Threshold |
|--------|--------------|-------------------|
| Daily traffic volume | ___ | ___ |
| Connections per hour | ___ | ___ |
| Unique IPs per day | ___ | ___ |
| Outbound traffic | ___ | ___ |

### Exercise 2: Anomaly Analysis

You observe:
- User normally downloads 50MB/day
- Today user downloaded 10GB in 30 minutes
- It's 11pm on a Saturday
- The destination is a cloud storage provider

Is this an attack? What would you investigate?

1. ___
2. ___
3. ___

### Exercise 3: Beaconing Detection

Traffic log shows:
```
10:00:00 - Host A → 8.8.8.8:443 (500 bytes)
10:01:00 - Host A → 8.8.8.8:443 (500 bytes)
10:02:00 - Host A → 8.8.8.8:443 (500 bytes)
10:03:00 - Host A → 8.8.8.8:443 (500 bytes)
...continues for 24 hours
```

1. Is this beaconing? ___
2. What makes you think so? ___
3. Next investigation steps? ___

---

## 4. Reflection Check

### Understanding Baselines
1. How long should you collect data before setting thresholds?

2. A user's behavior changed because they got promoted. How does this affect their baseline?

3. Black Friday traffic is 10x normal. Attack or business?

### Detection Thinking
1. DNS exfiltration uses port 53 (allowed). How do you detect it?

2. Attacker exfiltrates slowly (1MB/day for 3 months). How would you catch this?

3. Beaconing malware adds random jitter to timing. Still detectable?

---

## 5. Key Misconceptions

**MYTH: "One week of data is enough for a baseline"**
REALITY: Weekly and monthly patterns take longer to capture. 2-4 weeks minimum, ideally longer.

**MYTH: "All anomalies are attacks"**
REALITY: Most anomalies are benign. Context and investigation distinguish attacks from noise.

**MYTH: "Static thresholds work for everyone"**
REALITY: Thresholds must be per-entity. CFO downloads more than intern—different baselines.

**MYTH: "Baselines are set and forget"**
REALITY: Business changes, users change, systems change. Baselines need periodic recalibration.

**MYTH: "Baselining requires AI"**
REALITY: Simple statistical analysis works well. AI/ML adds capability but isn't required.

---

## 6. Completion Criteria

This module is complete when you can:

1. **Establish** baselines across multiple dimensions
2. **Identify** anomalies using statistical methods
3. **Apply** context to reduce false positives
4. **Detect** beaconing and exfiltration patterns
5. **Explain** UEBA concepts

---

## 7. Further Depth (Optional)

*   **Tools:** Explore UEBA platforms (Exabeam, Securonix)
*   **Statistics:** Learn about standard deviation, percentiles
*   **Practice:** Build baseline dashboards in SIEM
*   **Research:** Academic papers on network anomaly detection
