# Network Security Monitoring (Zeek)

## 1. Orientation

### What this module covers
Network logs are the source of truth. You can delete logs on a host, but you can't delete the packets you sent. This module covers **Zeek (formerly Bro)** and analyzing network metadata.

### Learning Objectives
*   Differentiate between **PCAP** (Full Packet) and **Flow Data** (Metadata).
*   Analyze `conn.log`, `dns.log`, and `http.log`.
*   Detect **Beaconing** and **Data Exfiltration** via DNS.

---

## 2. Core Content

### PCAP vs Flow
*   **PCAP:** Every byte. (Huge storage. Encrypted payloads are unreadable). 100% fidelity.
*   **Zeek Logs:** Compact metadata. "IP A talked to IP B on Port 80 for 5 seconds, sent 500 bytes, GET /index.html". (Small storage, high value).

### Key Zeek Logs
*   **conn.log:** The handshake. Duration. Byte count. (Detects port scans, long connections).
*   **dns.log:** Queries. (Detects DGA domains, tunneling).
*   **http.log:** User Agents, URIs. (Detects unencrypted C2, weird User Agents).
*   **ssl.log:** Certificate details. (Detects self-signed certs used by malware).

### JA3 Fingerprinting
A way to fingerprint the SSL Client Hello packet. Even if traffic is encrypted, the *way* the client initiates the handshake (ciphers, extensions) is unique. 
*   *Use Case:* Identify specific malware families (like Trickbot) based on their JA3 hash, regardless of IP.

---

## 3. Lab: DNS Tunneling

### Scenario
An internal host is querying `dominion-updates.com` thousands of times.

**Log Analysis (dns.log):**
*   QTYPE: `TXT` (Rare for normal traffic).
*   Query: `a8f93...base64...dominion-updates.com`.
*   Answer: `x9d1...`.

**Conclusion:** The attacker is encoding data in the DNS queries and receiving commands in the DNS responses. This builds a C2 channel that bypasses firewalls (which usually allow DNS).

---

## 4. Reflection
1.  Why not just record full PCAP for everything? (Cost. Storing 10Gbps of traffic requires Petabytes. Zeek logs are 1/1000th the size).
2.  Can Zeek see inside HTTPS? (No. But it logs the SNI (Server Name Indication) and Certificate metadata, which is often enough to identify the destination).
