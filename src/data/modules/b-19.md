# Secrets Management in IaC (Vault)

## 1. Orientation

### What this module covers
Hardcoding passwords in code (GitHub) is the #1 cause of cloud breaches. This module covers strategies to externalize secrets using tools like HashiCorp Vault, AWS Secrets Manager, and environment variables.

### Learning Objectives
*   Identify the risk of "Secret Sprawl."
*   Implement **Environment Variables** for basic protection.
*   Understand the workflow of **HashiCorp Vault** (Dynamic Secrets).

---

## 2. Core Content

### The Problem: Hardcoded Credentials
```python
# BAD
db_pass = "SuperSecret123" 
conn = connect(db_pass)
```
If this file is pushed to Git, the password is compromised forever (even if you delete it in the next commit, it's in history).

### Level 1: Environment Variables
```python
# BETTER
import os
db_pass = os.getenv('DB_PASSWORD')
```
*   *Pros:* Secret is not in code.
*   *Cons:* Secret is visible in `ps aux` or logs if not careful.

### Level 2: Secrets Management Platform (Vault)
Centralized storage. The App authenticates to Vault (via Token/IAM) and asks for the secret.
*   **Dynamic Secrets:** Vault can create a *temporary* database user for the app that expires in 1 hour. Even if stolen, the credence is short-lived.

### Git Scanning
Use tools like `trufflehog` or `gitleaks` in your CI/CD pipeline to block commits that look like keys.

---

## 3. Lab: Vault Workflow

### Workflow
1.  **Admin:** Writes secret `foo=bar` to Vault path `secret/app`.
2.  **App:** Authenticates to Vault.
3.  **App:** Requests `secret/app`.
4.  **Vault:** Returns `{foo: bar}`.
5.  **App:** Uses `bar` to connect.

*   **Result:** The secret only exists in Memory of the App and Storage of Vault. It never touches the disk or Git.

---

## 4. Reflection
1.  What is the "Secret Zero" problem? (You need a secret [token] to authenticate to Vault to get secrets. How do you protect the first token?).
2.  Why are Dynamic Secrets superior to Static Passwords? (They enforce rotation and limits the blast radius of a leak automatically).
