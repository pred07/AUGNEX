# HTTP, HTTPS, and Web Architecture

## 1. Orientation

### What this module covers
This module covers HTTP—the protocol that powers the web. Understanding HTTP request/response structure, methods, headers, and status codes is essential for web application security.

### Fit in the Learning Path
Web application security is the largest domain in cybersecurity. Nearly every attack involves manipulating HTTP requests or responses. This module provides the foundation for understanding web attacks.

### Learning Objectives
By the end of this module, you will:
*   Understand HTTP request and response structure
*   Use different HTTP methods appropriately
*   Interpret status codes and headers
*   Recognize security implications of HTTP

---

## 2. Core Content

### Mental Model: The Conversation

**How professionals think about this:**
HTTP is a text-based conversation. The client asks for something (request), and the server replies (response). Every interaction follows this simple pattern—even the most complex web applications.

```
HTTP CONVERSATION:

CLIENT (Browser):
┌─────────────────────────────────────────────────────────────────────┐
│ GET /products/123 HTTP/1.1                    ← Request Line       │
│ Host: www.example.com                         ← Headers            │
│ User-Agent: Mozilla/5.0...                                         │
│ Accept: text/html,application/json                                 │
│ Cookie: session=abc123                                             │
│ Authorization: Bearer eyJhbG...                                    │
│                                               ← Blank Line         │
│ (No body for GET)                             ← Body (optional)    │
└─────────────────────────────────────────────────────────────────────┘
                              ↓
SERVER:
┌─────────────────────────────────────────────────────────────────────┐
│ HTTP/1.1 200 OK                               ← Status Line        │
│ Content-Type: application/json                ← Headers            │
│ Content-Length: 256                                                │
│ Set-Cookie: session=xyz789; HttpOnly; Secure                       │
│ X-Frame-Options: DENY                                              │
│                                               ← Blank Line         │
│ {"id": 123, "name": "Widget", "price": 29.99} ← Body              │
└─────────────────────────────────────────────────────────────────────┘
```

### URL Structure

**Anatomy of a URL:**

```
URL COMPONENTS:

https://user:pass@www.example.com:443/path/page?query=value#fragment
└──┬─┘ └───┬────┘ └─────┬───────┘└─┘└────┬────┘└────┬─────┘└───┬───┘
Scheme  Userinfo       Host     Port   Path      Query    Fragment

BREAKDOWN:
─────────────────────────────
Scheme:   Protocol (http, https, ftp)
Userinfo: Authentication (deprecated for http)
Host:     Domain or IP
Port:     TCP port (443 default for HTTPS)
Path:     Resource location
Query:    Parameters (?key=value&key2=value2)
Fragment: Client-side anchor (#section)

SECURITY NOTES:
─────────────────────────────
- Query parameters visible in logs
- Fragment (#) never sent to server
- Userinfo in URL is insecure
- Encoded characters (%XX) may bypass filters
```

### HTTP Methods

**Request types:**

| Method | Purpose | Has Body | Idempotent | Safe |
|--------|---------|----------|------------|------|
| **GET** | Retrieve data | No | Yes | Yes |
| **POST** | Submit data | Yes | No | No |
| **PUT** | Replace resource | Yes | Yes | No |
| **PATCH** | Partial update | Yes | No | No |
| **DELETE** | Remove resource | Optional | Yes | No |
| **HEAD** | GET without body | No | Yes | Yes |
| **OPTIONS** | Query allowed methods | No | Yes | Yes |
| **TRACE** | Echo request (debug) | No | Yes | Yes |

```
METHOD SECURITY IMPLICATIONS:

GET:
- Parameters in URL (visible in logs, history)
- Should never modify state
- Often cached

POST:
- Parameters in body (not visible in URL)
- Used for sensitive data
- Not cached

PUT/DELETE:
- If exposed without auth = unauthorized modification
- Check for proper access control

OPTIONS:
- Reveals allowed methods
- Used in CORS preflight
- Information disclosure

TRACE:
- Echoes headers including cookies
- Cross-Site Tracing (XST) attack
- Should be disabled
```

### HTTP Status Codes

**Response categories:**

```
STATUS CODE CATEGORIES:

1xx: INFORMATIONAL
─────────────────────────────
100 Continue - Proceed with request
101 Switching Protocols - Changing to WebSocket

2xx: SUCCESS
─────────────────────────────
200 OK - Standard success
201 Created - Resource created
204 No Content - Success, no body

3xx: REDIRECTION
─────────────────────────────
301 Moved Permanently - Use new URL always
302 Found - Temporary redirect
304 Not Modified - Use cached version

4xx: CLIENT ERROR
─────────────────────────────
400 Bad Request - Malformed syntax
401 Unauthorized - Authentication required
403 Forbidden - Authenticated but not allowed
404 Not Found - Resource doesn't exist
405 Method Not Allowed - Wrong HTTP method
429 Too Many Requests - Rate limited

5xx: SERVER ERROR
─────────────────────────────
500 Internal Server Error - Generic error
502 Bad Gateway - Upstream failure
503 Service Unavailable - Server overloaded
504 Gateway Timeout - Upstream timeout
```

**Security-relevant status codes:**

| Code | Security Implication |
|------|---------------------|
| 401 | Valid endpoint, needs auth |
| 403 | Valid endpoint, wrong permissions |
| 405 | Endpoint exists, try different method |
| 500 | Possible vulnerability (error disclosure) |

### HTTP Headers

**Important headers:**

```
REQUEST HEADERS:
─────────────────────────────
Host: www.example.com           # Required in HTTP/1.1
User-Agent: Mozilla/5.0...      # Browser identification
Accept: text/html,              # Acceptable content types
Accept-Language: en-US          # Preferred language
Accept-Encoding: gzip, deflate  # Compression support
Cookie: session=abc123          # Session/auth cookies
Authorization: Bearer token     # API authentication
Referer: https://google.com     # Previous page
Origin: https://app.example.com # Request origin (CORS)
Content-Type: application/json  # Body format (POST/PUT)

RESPONSE HEADERS:
─────────────────────────────
Content-Type: text/html         # Body format
Content-Length: 1234            # Body size
Set-Cookie: session=xyz         # Set browser cookie
Cache-Control: no-store         # Caching policy
Location: /new-url              # Redirect target
```

**Security headers:**

```
SECURITY HEADERS:
─────────────────────────────
Strict-Transport-Security: max-age=31536000; includeSubDomains
→ Force HTTPS (HSTS)

X-Content-Type-Options: nosniff
→ Prevent MIME sniffing

X-Frame-Options: DENY
→ Prevent clickjacking

X-XSS-Protection: 1; mode=block
→ Enable XSS filter (deprecated)

Content-Security-Policy: default-src 'self'
→ Control resource loading (XSS defense)

Referrer-Policy: strict-origin-when-cross-origin
→ Control referrer information

Permissions-Policy: geolocation=()
→ Restrict browser features

MISSING HEADERS = VULNERABILITY:
Each missing security header is a finding in pentests
```

### HTTP vs HTTPS

**Security comparison:**

```
HTTP (Port 80):
─────────────────────────────
┌─────────┐     CLEARTEXT      ┌─────────┐
│ Browser │ ←─────────────────→│ Server  │
└─────────┘                    └─────────┘
          ↑
     Attacker can:
     - Read passwords
     - Read session cookies
     - Modify requests
     - Inject content

HTTPS (Port 443):
─────────────────────────────
┌─────────┐   TLS ENCRYPTED    ┌─────────┐
│ Browser │ ←═════════════════→│ Server  │
└─────────┘                    └─────────┘
          ↑
     Attacker can only see:
     - Destination IP
     - Domain (SNI)
     - Connection timing
     
     Cannot see:
     - URL path
     - Headers
     - Body (passwords, data)

TLS HANDSHAKE:
─────────────────────────────
1. Client Hello (supported ciphers)
2. Server Hello (chosen cipher, certificate)
3. Client verifies certificate
4. Key exchange
5. Encrypted communication begins
```

### Cookies

**Session and state management:**

```
COOKIE MECHANICS:
─────────────────────────────
Server sets cookie:
Set-Cookie: session=abc123; Secure; HttpOnly; SameSite=Strict

Browser automatically sends with subsequent requests:
Cookie: session=abc123

COOKIE ATTRIBUTES:
─────────────────────────────
Name=Value       The actual cookie data
Domain           Which domain receives cookie
Path             URL path scope
Expires/Max-Age  When cookie expires
Secure           Only send over HTTPS
HttpOnly         JavaScript cannot access
SameSite         Cross-site request policy
                 Strict: Same-site only
                 Lax: Some cross-site allowed
                 None: Always send (requires Secure)

SECURITY IMPLICATIONS:
─────────────────────────────
Missing Secure → Cookie sent over HTTP (credential theft)
Missing HttpOnly → XSS can steal session
Missing SameSite → CSRF attacks possible
```

### Modern Web Architecture

**How applications work:**

```
WEB APPLICATION ARCHITECTURE:

TRADITIONAL (Server-Side):
─────────────────────────────
Browser → Request → Server renders HTML → Response
Every click = full page reload

MODERN (SPA - Single Page Application):
─────────────────────────────
Browser → Initial request → Loads JavaScript app
Subsequent requests are AJAX/fetch to API
Page updates without reload

API PATTERNS:
─────────────────────────────
REST: GET /users/123
GraphQL: POST /graphql { query: "{ user(id: 123) }" }

SECURITY DIFFERENCES:
─────────────────────────────
- SPAs: JavaScript handles auth state
- APIs: Need proper CORS configuration
- GraphQL: Complex query parsing, DoS risks
- Websockets: Persistent connections, different auth
```

---

## 3. Guided Practice

### Exercise 1: Browser Network Tab

Open DevTools (F12) → Network tab → Refresh this page:

1. What is the request method for the page? ___
2. What is the status code? ___
3. What Content-Type is returned? ___
4. List 3 security headers present: ___

### Exercise 2: Header Analysis

For a request to POST /login:
```
POST /login HTTP/1.1
Host: example.com
Content-Type: application/x-www-form-urlencoded
Cookie: session=old123

username=admin&password=secret
```

1. Where is the password sent? ___
2. What cookie is being sent? ___
3. What format is the body? ___

### Exercise 3: Status Code Interpretation

What do these responses tell an attacker?

| Response | Implication |
|----------|-------------|
| 401 on /admin/dashboard | ___ |
| 403 on /users/admin/profile | ___ |
| 404 on /api/v2/users | ___ |
| 500 on /search?q=' | ___ |

---

## 4. Reflection Check

### Protocol Understanding
1. GET vs POST for login. Which is better? Why?

2. Status 200 returned but operation failed. How?

3. Cookie sent to HTTP url. Why is this dangerous?

### Security Thinking
1. You see 403 instead of 404 on sensitive path. Information?

2. Response has no Content-Type. Risk?

3. HSTS header present. What happens if cert expires?

---

## 5. Key Misconceptions

**MYTH: "HTTPS means the site is safe"**
REALITY: HTTPS encrypts transport. The site can still be malicious or have vulnerabilities.

**MYTH: "POST hides data from attackers"**
REALITY: POST body is encrypted in HTTPS but visible on the server and in logs.

**MYTH: "2xx means success"**
REALITY: 200 is HTTP success. Application may return 200 with error in body.

**MYTH: "Headers are hidden from users"**
REALITY: DevTools shows all headers. Sensitive data in headers is visible.

**MYTH: "Cookies are automatically secure"**
REALITY: Cookies require Secure, HttpOnly, SameSite flags for protection.

---

## 6. Completion Criteria

This module is complete when you can:

1. **Construct** HTTP requests with proper structure
2. **Interpret** status codes and their implications
3. **Identify** security headers and their purposes
4. **Explain** HTTP vs HTTPS security differences
5. **Analyze** web traffic using browser DevTools

---

## 7. Further Depth (Optional)

*   **Tool:** Use Burp Suite to intercept and modify requests
*   **Practice:** Complete PortSwigger Web Security Academy labs
*   **Reference:** Mozilla Developer Network (MDN) HTTP documentation
*   **Deep Dive:** HTTP/2 and HTTP/3 protocol differences
