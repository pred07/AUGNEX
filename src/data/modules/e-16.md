# Session Management and Token Handling

## 1. Orientation

### What this module covers
This module focuses on **maintaining access**. Once logged in, how does the server track you? We analyze Cookies, JWTs (JSON Web Tokens), and Session fixation.

### Fit in the Learning Path
Stealing a session token is often easier than stealing a password. It bypasses 2FA instantly.

### Learning Objectives
By the end of this module, you should understand:
*   **Session ID Entropy** (Randomness).
*   **JWT Structure** (Header.Payload.Signature).
*   **Session Fixation** attacks.

---

## 2. Core Content

### The Session Token
It must be **Random, Unpredictable, and Long**.
*   *Bad*: `sess_id=100`, `sess_id=101`. (Predictable => Enumeration).
*   *Good*: `sess_id=73827482374823...`.

### JSON Web Tokens (JWT)
A stateless token.
1.  **Header**: Algorithm (`HS256`).
2.  **Payload**: Data (`user_id: 5`, `role: admin`).
3.  **Signature**: Hash of Header+Payload using a Secret Key.
*   **Attack**: Change `role: user` to `role: admin`.
    *   *Defense*: server checks Signature. If you changed data, signature fails.
    *   *Vuln*: "None Algorithm" attack (telling server to ignore signature).

### Session Fixation
Attacker sends Victim a link: `bank.com/login?session_id=EVIL123`.
Victim logs in.
Server accepts `EVIL123` as the valid ID.
Attacker (who knows `EVIL123`) accesses the account.

---

## 3. Guided Practice

### JWT Inspection
**Step 1**: Go to [jwt.io](https://jwt.io).
**Step 2**: Look at the distinct color coding.
**Step 3**: Try changing the Payload "name": "John Doe" to "Admin".
*   **Observation**: Watch the **Signature** (Blue part) change.
*   **Lesson**: You cannot tamper with the token unless you know the Server's Secret Key.

### Brute Forcing Secrets
If the Secret Key is weak (e.g., "secret123"), tools like `hashcat` can crack the signature. Once cracked, you can forge your own ADMIN tokens.

---

## 4. Reflection Check

1.  **Lifetime**: Why shouldn't a session token last forever? (If stolen, the attacker has access forever. Expiration forces a re-login).
2.  **Storage**: Where is safer to store a token: `localStorage` or `HttpOnly Cookie`? (Cookie. `localStorage` is accessible by XSS).
3.  **Logout**: Does deleting the JWT on the client log you out? (No. The token is still valid on the server until it expires. True logout requires a Blacklist on the server).

---

## 5. Completion Criteria

This module is complete when:
1.  You can decode a Base64 JWT.
2.  You understand why Sequential Session IDs are a Critical Vulnerability.
3.  You know the "None Algorithm" JWT vulnerability.
