# Session Management and Token Handling

## 1. Unit Brief: Maintaining the State
After you authenticate, the server needs to remember you. It gives you a "Session ID" or a "Token". Possession of this token is legally equivalent to knowing the password. If you steal the token (Session Hijacking), you are the user.

## 2. Real-World Relevance
*   **XSS to Session Hijacking**: If I can run JavaScript on your browser, I can read your cookies (`document.cookie`) and send them to my server. Then I paste them into my browser and I am you.

## 3. Core Concepts

### Cookies (Session IDs)
Server stores data in a database and gives you an ID (e.g., `PHPSESSID=xyz`).
*   **Secure Flag**: Cookie only sent over HTTPS.
*   **HttpOnly Flag**: JavaScript cannot read the cookie (Protects against XSS theft).

### JWT (JSON Web Tokens)
Stateless. The data is inside the token itself, signed cryptographically.
*   `header.payload.signature`
*   *Weakness*: "None" algorithm attack (telling server to skip signature check), or weak signing secrets.

### LocalStorage
Often used to store JWTs.
*   *Risk*: Accessible by JavaScript. Always vulnerable to XSS theft.

## 4. Practical Examples

### The JWT "None" Algorithm
1.  Capture JWT: `eyJhbGciOiJIUzI1NiJ9.eyJ1c2VyIjoidXNlciJ9.SIGNATURE`
2.  Change Header: `{"alg": "none"}`
3.  Change Payload: `{"user": "admin"}`
4.  Remove Signature.
5.  Send to server.
6.  **Result**: Server parses "none", skips verification, reads "admin", and logs you in.

### Session Fixation
1.  Attacker gets a valid session ID: `SESS=123`
2.  Attacker sends Victim a link: `site.com/login?SESS=123`
3.  Victim logs in. Server reuses `SESS=123` for the authenticated user.
4.  Attacker uses `SESS=123` to access the victim's account.

## 5. Common Mistakes Beginners Make
*   **Decoding != Decrypting**: JWTs are Base64 encoded, not encrypted. You can read the contents at `jwt.io`.
*   **Not checking Expiration**: A token that never expires gives an attacker infinite time to use it if stolen.

## 6. Key Takeaways
*   **Tokens are Keys**: Treat them with the same security as passwords.
*   **HttpOnly is Mandatory**: For sensitive cookies.
*   **JWTs**: Convenient but dangerous if implemented poorly.
