[
    {
        "id": "b-21",
        "content": "# Cloud Architecture & Shared Responsibility\n\n## 1. Orientation\n\n### What this module covers\nThe Cloud is not a magic box; it is someone else's computer (usually Amazon's, Microsoft's, or Google's). This module defines the foundational model of Cloud Security: **The Shared Responsibility Model**. Getting this wrong is the cause of 99% of cloud breaches.\n\n### Learning Objectives\n*   Differentiate between **IaaS, PaaS, and SaaS** service models.\n*   Clearly define where the CSP's (Cloud Service Provider) job ends and yours begins.\n*   Understand the **Well-Architected Framework** security pillar.\n\n---\n\n## 2. Core Content\n\n### IaaS vs PaaS vs SaaS\nThe level of control (and responsibility) changes based on the service type.\n\n| Model | Example | You Manage | CSP Manages |\n| :--- | :--- | :--- | :--- |\n| **IaaS** | AWS EC2 (VM) | OS, Apps, Data, **Patches**, Firewall | Hardware, Network Cables, Power |\n| **PaaS** | AWS RDS (DB) | App Code, Data Schema | OS Patching, Hardware, Backups |\n| **SaaS** | Gmail / Salesforce | Access Policy, Data Content | EVERYTHING (Code, DB, OS, HW) |\n\n### The Shared Responsibility Model\nAmazon's Rule: \"AWS is responsible for security **OF** the cloud. You are responsible for security **IN** the cloud.\"\n*   **Example:** If an AWS Data Center burns down, it's AWS's fault.\n*   **Example:** If you leave an S3 bucket with customer data open to the public (`0.0.0.0/0`), it is **YOUR** fault.\n\n### Cloud Native Design\nDon't \"Lift and Shift\" (copying on-prem servers to EC2). Use Cloud Native patterns (Lambda, DynamoDB) to offload patching responsibility to the vendor. \n\n---\n\n## 3. Lab: The Liability Line\n\n### Scenario\nYour company uses AWS RDS (Relational Database Service).\n\n1.  **Event 1:** The underlying MySQL version has a critical vulnerability. \n    *   *Who patches it?* **AWS** (It's PaaS).\n2.  **Event 2:** A developer sets the database password to \"password123\".\n    *   *Who is liable for the breach?* **YOU** (Identity & Access is always the customer).\n3.  **Event 3:** The physical disk drive fails in the AWS Data Center.\n    *   *Who replaces it?* **AWS**.\n\n---\n\n## 4. Reflection\n1.  Why is SaaS commonly called \"Shadow IT\"? (Because employees can sign up for Dropbox/Slack without IT knowing, creating unmanaged data silos).\n2.  Does using AWS/Azure make you compliant with HIPAA/PCI automatically? (No. It gives you a compliant *foundation*, but you can still build a non-compliant app on top of it).\n"
    },
    {
        "id": "b-22",
        "content": "# IAM: The Perimeter of the Cloud\n\n## 1. Orientation\n\n### What this module covers\nIn the Cloud, the network perimeter (Firewall) is secondary. Examples: S3 buckets and Lambda functions don't sit behind firewalls; they are protected by **Identity**. IAM (Identity and Access Management) is the primary defense.\n\n### Learning Objectives\n*   Understand the Structure of an IAM Policy (Principal, Action, Resource, Condition).\n*   Implement **Least Privilege** with Role-Based Access Control (RBAC).\n*   Master the concept of **AssumeRole** (Temporary Credentials).\n\n---\n\n## 2. Core Content\n\n### Principals: Users vs. Roles\n*   **IAM User:** A person. Has long-term keys (Access Key / Secret Key). *Avoid using these if possible.*\n*   **IAM Role:** A hat. Anyone (User, EC2 Instance, Lambda) can put on the hat to get permissions. Has *temporary* keys (Session Token).\n\n### Anatomy of a Policy (JSON)\n```json\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": \"s3:GetObject\",\n      \"Resource\": \"arn:aws:s3:::my-secret-bucket/*\"\n    }\n  ]\n}\n```\n*   **Effect:** Allow or Deny (Deny always wins).\n*   **Action:** What can they do? (`s3:*` is dangerous).\n*   **Resource:** Where can they do it?\n\n### The Danger of `*`\n`Action: \"*\"` and `Resource: \"*\"` is Administrative Access. Giving this to a Developer means they can delete the entire company.\n\n---\n\n## 3. Lab: Privilege Escalation\n\n### Scenario\nYou find a Policy with this permission:\n```json\n{\n  \"Effect\": \"Allow\",\n  \"Action\": \"iam:CreatePolicyVersion\",\n  \"Resource\": \"*\"\n}\n```\n**The Attack:**\n1.  The attacker has limited rights.\n2.  They define a *new version* of their own policy that grants `*` (AdministratorAccess).\n3.  They become Admin. \n\n**Lesson:** Never grant write access to IAM policies unless the user is a trusted Admin.\n\n---\n\n## 4. Reflection\n1.  Why should EC2 instances use Roles instead of hardcoded keys? (Roles rotate credentials automatically. Hardcoded keys in code lead to GitHub leaks).\n2.  What is MFA Delete? (A requirement that a human must enter a 2FA code to delete an object. Protects against rogue automation).\n"
    },
    {
        "id": "b-23",
        "content": "# Infrastructure Security (VPC & Security Groups)\n\n## 1. Orientation\n\n### What this module covers\nEven in the cloud, we need networks. The Virtual Private Cloud (VPC) is your private slice of the internet. This module covers isolating resources using Subnets, NACLs, and Security Groups.\n\n### Learning Objectives\n*   Design a **3-Tier VPC Architecture** (Public vs. Private Subnets).\n*   Differentiate between **Security Groups** (Stateful) and **NACLs** (Stateless).\n*   Understand **VPC Peering** and **PrivateLink** risks.\n\n---\n\n## 2. Core Content\n\n### The 3-Tier Architecture (Cloud Edition)\n1.  **Public Subnet:** Has an Internet Gateway (IGW). Contains Load Balancers (ALB) and NAT Gateways. **NO SERVERS HERE.**\n2.  **Private Subnet (App):** No direct internet access. Contains EC2 App Servers / Containers.\n3.  **Private Subnet (Data):** No internet routes at all. Contains RDS Databases.\n\n### Security Groups vs NACLs\n*   **Security Group (SG):** The Firewall *for the Instance*. \n    *   *Feature:* **Stateful**. If you allow OUTBOUND traffic to port 80, the return traffic is automatically allowed.\n*   **Network ACL (NACL):** The Firewall *for the Subnet*.\n    *   *Feature:* **Stateless**. You must explicitly allow both Inbound and Outbound rules (including Ephemeral ports 1024-65535).\n\n### Flow Logs\nVPC Flow Logs record the metadata of network traffic (Source IP, Dest IP, Port, Action). They are the \"Packet Capture\" lite of the cloud.\n\n---\n\n## 3. Lab: The Leaky Bucket\n\n### Scenario\nAn EC2 instance in a Private Subnet is compromised. The attacker wants to download tools.\n\n1.  **Route Table Check:** Does the Private Subnet have a route to a **NAT Gateway**? \n    *   *Yes:* The instance can reach the internet (outbound). Attacker succeeds.\n    *   *No:* The instance is truly air-gapped. Attacker fails.\n\n**Defense:** Use **VPC Endpoints** (PrivateLink) to allow access to S3/DynamoDB without traversing the public internet.\n\n---\n\n## 4. Reflection\n1.  Why is `0.0.0.0/0` on SSH (Port 22) a critical finding? (It allows the entire world to brute force your SSH. Use VPN or SSM Session Manager instead).\n2.  What is a \"Bastion Host\"? (A jump box in the public subnet used to SSH into private instances. Modern approach: Replace Bastions with SSM).\n"
    },
    {
        "id": "b-24",
        "content": "# Data Protection: KMS & Encryption\n\n## 1. Orientation\n\n### What this module covers\nIn the cloud, you don't control the physical hard drives. You must rely on Encryption. This module covers **KMS (Key Management Service)**, Server-Side Encryption (SSE), and Protecting S3 buckets.\n\n### Learning Objectives\n*   Understand **Envelope Encryption**.\n*   Differentiate between **Customer Managed Keys (CMK)** and AWS Managed Keys.\n*   Secure S3 Buckets against public leaks.\n\n---\n\n## 2. Core Content\n\n### Key Management Service (KMS)\nKMS creates and manages the Root Keys. \n*   **AWS Managed Key:** Free, easy. You don't control the policy.\n*   **Symmetric CMK:** You control the rotation and policy. Used for EBS/S3.\n\n### Envelope Encryption\nKMS does not encrypt your 1TB database. It's too slow. \n1.  KMS generates a **Data Key**. \n2.  The Data Key encrypts the Database.\n3.  KMS encrypts the Data Key with the Root Key.\n4.  The Encrypted Data Key is stored *with* the database.\n\n### S3 Security\nS3 leaks are the most common cloud vulnerability.\n*   **Block Public Access (BPA):** A global setting on the bucket. Turn this ON.\n*   **Bucket Policy:** JSON policy similar to IAM.\n*   **Encryption:** SSE-S3 (AWS Keys) or SSE-KMS (Your Keys).\n\n---\n\n## 3. Lab: Encrypting the World\n\n### Task\nYou have a requirement: \"If a drive is pulled from the rack in the data center, the data must be unreadable.\"\n\n**Solution: EBS Encryption.**\n*   When creating an EC2 instance, check \"Encrypt EBS Volume\".\n*   Choose a KMS Key.\n*   *Result:* The data is encrypted at rest. AWS handles the decryption transparently when the instance reads from the disk **IF** the instance role has permissions to use the Key.\n\n---\n\n## 4. Reflection\n1.  If you confuse the KMS Key Policy, can you lock yourself out of your own data? (Yes. Key Policies are the only way to control access to the key. Even Root can be locked out if the policy denies it).\n2.  What is \"Crypto-shredding\"? (Deleting the Key effectively deletes the data, because the data can never be decrypted again. Useful for GDPR 'Right to be Forgotten').\n"
    },
    {
        "id": "b-25",
        "content": "# Cloud Monitoring: CloudTrail & GuardDuty\n\n## 1. Orientation\n\n### What this module covers\nVisibility is everything. In AWS, **CloudTrail** logs every API call (Who did what), and **GuardDuty** is the Intelligent IDS (Intrusion Detection System). This module covers how to monitor and respond to cloud threats.\n\n### Learning Objectives\n*   Analyze **CloudTrail Logs** for forensic investigation.\n*   Understand **GuardDuty** finding types (Cryptomining, Tor usage).\n*   Automate responses using **EventBridge**.\n\n---\n\n## 2. Core Content\n\n### CloudTrail: The Flight Recorder\nEvery time you click a button in the console or run a CLI command, it is an API call.\n*   **Log Entry:** `Identity: Alice`, `Event: RunInstances`, `Source IP: 1.2.3.4`, `Time: 12:00`.\n*   **Security:** Ensure CloudTrail is ON, logging to a separate \"Log Archive\" account, with integrity validation enabled.\n\n### GuardDuty: The AI Watchdog\nAnalyzes CloudTrail, VPC Flow Logs, and DNS Logs. \n*   **Detects:** \n    *   *Recon:* Port scanning.\n    *   *Compromise:* EC2 instance mining bitcoin.\n    *   *IAM:* Unusual Root login locations.\n\n### EventBridge (CloudWatch Events)\nThe glue for automation. \n*   *Trigger:* GuardDuty finds \"High Severity Trojan\".\n*   *Action:* Trigger Lambda Function -> Isolate the EC2 Instance (Change Security Group).\n\n---\n\n## 3. Lab: Forensic Timeline\n\n### Scenario\nGuardDuty alerts: \"UnauthorizedAccess:IAMUser/TorIPCaller\".\n\n**Investigation in CloudTrail:**\n1.  Filter by `AccessKeyId` from the alert.\n2.  **Findings:**\n    *   10:00 AM: `ConsoleLogin` from IP (Tor Exit Node).\n    *   10:05 AM: `CreateUser` \"Backdoor Admin\".\n    *   10:06 AM: `AttachUserPolicy` \"AdministratorAccess\".\n    *   10:10 AM: `RunInstances` (Bitcoin Miner).\n\n**Response:** Revoke Key, Terminate Instances, Delete User.\n\n---\n\n## 4. Reflection\n1.  Why must CloudTrail logs be stored in a *different* AWS account? (If higherpriv attackers compromise the Prod account, they will try to delete the logs to cover their tracks. Write-Only access to a Log Archive account prevents this).\n2.  What does \"Regional\" mean for CloudTrail? (You need to enable it in ALL regions, even ones you don't use. Hackers love to hide in `sa-east-1` if you only monitor `us-east-1`).\n"
    }
]